define('tour_amd/jquery.gallery',['jquery'],function($){$.fn.adGallery=$.fn.gyGallery=function(options){var defaults={loader_image:'http://img3.tuniucdn.com/site/file/tn-gallery/img/loader.gif',start_at_index:0,description_wrapper:false,thumb_opacity:0.7,animate_first_image:false,animation_speed:400,width:false,height:false,display_next_and_prev:true,display_back_and_forward:true,scroll_jump:0,slideshow:{enable:true,autostart:false,speed:5000,start_label:'Start',stop_label:'Stop',stop_on_scroll:true,countdown_prefix:'(',countdown_sufix:')',onStart:false,onStop:false},effect:'slide-hori',enable_keyboard_move:true,cycle:true,callbacks:{init:false,afterImageVisible:false,beforeImageVisible:false}};var settings=$.extend(false,defaults,options);if(options&&options.slideshow){settings.slideshow=$.extend(false,defaults.slideshow,options.slideshow);};if(!settings.slideshow.enable){settings.slideshow.autostart=false;};var galleries=[];$(this).each(function(){var gallery=new AdGallery(this,settings);galleries[galleries.length]=gallery;});return galleries;};$("head")&&$("head").append('<link href="http://img2.tuniucdn.com/f/201508052000/tn-gallery/gallery.0724.css" rel="stylesheet">');function VerticalSlideAnimation(img_container,direction,desc){var current_top=parseInt(img_container.css('top'),10);if(direction=='left'){var old_image_top='-'+this.image_wrapper_height+'px';img_container.css('top',this.image_wrapper_height+'px');}else{var old_image_top=this.image_wrapper_height+'px';img_container.css('top','-'+this.image_wrapper_height+'px');};if(desc){desc.css('bottom','-'+desc[0].offsetHeight+'px');desc.animate({bottom:0},this.settings.animation_speed*2);};if(this.current_description){this.current_description.animate({bottom:'-'+this.current_description[0].offsetHeight+'px'},this.settings.animation_speed*2);};return{old_image:{top:old_image_top},new_image:{top:current_top}};};function HorizontalSlideAnimation(img_container,direction,desc){var current_left=parseInt(img_container.css('left'),10);if(direction=='left'){var old_image_left='-'+this.image_wrapper_width+'px';img_container.css('left',this.image_wrapper_width+'px');}else{var old_image_left=this.image_wrapper_width+'px';img_container.css('left','-'+this.image_wrapper_width+'px');};if(desc){desc.css('bottom','-'+desc[0].offsetHeight+'px');desc.animate({bottom:0},this.settings.animation_speed*2);};if(this.current_description){this.current_description.animate({bottom:'-'+this.current_description[0].offsetHeight+'px'},this.settings.animation_speed*2);};return{old_image:{left:old_image_left},new_image:{left:current_left}};};function ResizeAnimation(img_container,direction,desc){var image_width=img_container.width();var image_height=img_container.height();var current_left=parseInt(img_container.css('left'),10);var current_top=parseInt(img_container.css('top'),10);img_container.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2});return{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:image_width,height:image_height,top:current_top,left:current_left}};};function FadeAnimation(img_container,direction,desc){img_container.css('opacity',0);return{old_image:{opacity:0},new_image:{opacity:1}};};function NoneAnimation(img_container,direction,desc){img_container.css('opacity',0);return{old_image:{opacity:0},new_image:{opacity:1},speed:0};};function AdGallery(wrapper,settings){this.init(wrapper,settings);};AdGallery.prototype={wrapper:false,image_wrapper:false,gallery_info:false,nav:false,loader:false,preloads:false,thumbs_wrapper:false,scroll_back:false,scroll_forward:false,next_link:false,prev_link:false,slideshow:false,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:false,current_description:false,nav_display_width:0,settings:false,images:false,in_transition:false,animations:false,init:function(wrapper,settings){var context=this;this.wrapper=$(wrapper);this.settings=settings;this.setupElements();this.setupAnimations();if(this.settings.width){this.image_wrapper_width=this.settings.width;this.image_wrapper.width(this.settings.width);this.wrapper.width(this.settings.width);}else{this.image_wrapper_width=this.image_wrapper.width();};if(this.settings.height){this.image_wrapper_height=this.settings.height;this.image_wrapper.height(this.settings.height);}else{this.image_wrapper_height=this.image_wrapper.height();};this.nav_display_width=this.nav.width();this.current_index=0;this.current_image=false;this.current_description=false;this.in_transition=false;this.findImages();if(this.settings.display_next_and_prev){this.initNextAndPrev();};var nextimage_callback=function(callback){return context.nextImage(callback);};this.slideshow=new AdGallerySlideshow(nextimage_callback,this.settings.slideshow);this.controls.append(this.slideshow.create());if(this.settings.slideshow.enable){this.slideshow.enable();}else{this.slideshow.disable();};if(this.settings.display_back_and_forward){this.initBackAndForward();};if(this.settings.enable_keyboard_move){this.initKeyEvents();};var start_at=parseInt(this.settings.start_at_index,10);if(window.location.hash&&window.location.hash.indexOf('#gy-image')===0){start_at=window.location.hash.replace(/[^0-9]+/g,'');if((start_at*1)!=start_at){start_at=this.settings.start_at_index;};};this.loading(true);this.showImage(start_at,function(){if(context.settings.slideshow.autostart){context.preloadImage(start_at+1);context.slideshow.start();};});this.fireCallback(this.settings.callbacks.init);},setupAnimations:function(){this.animations={'slide-vert':VerticalSlideAnimation,'slide-hori':HorizontalSlideAnimation,'resize':ResizeAnimation,'fade':FadeAnimation,'none':NoneAnimation};},setupElements:function(){this.controls=this.wrapper.find('.gy-controls');this.gallery_info=$('<p class="gy-info"></p>');this.controls.append(this.gallery_info);this.image_wrapper=this.wrapper.find('.gy-image-wrapper');this.image_wrapper.empty();this.nav=this.wrapper.find('.gy-nav');this.thumbs_wrapper=this.nav.find('.gy-thumbs');this.preloads=$('<div class="gy-preloads"></div>');this.loader=$('<img class="gy-loader" src="'+this.settings.loader_image+'">');this.image_wrapper.append(this.loader);this.loader.hide();$(document.body).append(this.preloads);},loading:function(bool){if(bool){this.loader.show();}else{this.loader.hide();};},addAnimation:function(name,fn){if($.isFunction(fn)){this.animations[name]=fn;};},findImages:function(){var context=this;this.images=[];var thumb_wrapper_width=0;var thumbs_loaded=0;var thumbs=this.thumbs_wrapper.find('a');var thumb_count=thumbs.length;if(this.settings.thumb_opacity<1){thumbs.find('img').css('opacity',this.settings.thumb_opacity);};thumbs.each(function(i){var link=$(this);var image_src=link.attr('href');var thumb=link.find('img');if(!context.isImageLoaded(thumb[0])){thumb.load(function(){thumb_wrapper_width+=this.parentNode.parentNode.offsetWidth;thumbs_loaded++;});}else{thumb_wrapper_width+=thumb[0].parentNode.parentNode.offsetWidth;thumbs_loaded++;};link.addClass('gy-thumb'+i);link.click(function(){context.showImage(i);context.slideshow.stop();return false;}).hover(function(){if(!$(this).is('.gy-active')&&context.settings.thumb_opacity<1){$(this).find('img').fadeTo(300,1);};context.preloadImage(i);},function(){if(!$(this).is('.gy-active')&&context.settings.thumb_opacity<1){$(this).find('img').fadeTo(300,context.settings.thumb_opacity);};});var link=false;if(thumb.data('gy-link')){link=thumb.data('gy-link');}else if(thumb.attr('longdesc')&&thumb.attr('longdesc').length){link=thumb.attr('longdesc');};var desc=false;if(thumb.data('gy-desc')){desc=thumb.data('gy-desc');}else if(thumb.attr('alt')&&thumb.attr('alt').length){desc=thumb.attr('alt');};var title=false;if(thumb.data('gy-title')){title=thumb.data('gy-title');}else if(thumb.attr('title')&&thumb.attr('title').length){title=thumb.attr('title');};context.images[i]={thumb:thumb.attr('src'),image:image_src,error:false,preloaded:false,desc:desc,title:title,size:false,link:link};});var inter=setInterval(function(){if(thumb_count==thumbs_loaded){thumb_wrapper_width-=70;var list=context.nav.find('.gy-thumb-list');list.css('width',thumb_wrapper_width+'px');var i=1;var last_height=list.height();while(i<201){list.css('width',(thumb_wrapper_width+i)+'px');if(last_height!=list.height()){break;}
last_height=list.height();i++;}
clearInterval(inter);};},100);},initKeyEvents:function(){var context=this;$(document).keydown(function(e){if(e.keyCode==39){context.nextImage();context.slideshow.stop();}else if(e.keyCode==37){context.prevImage();context.slideshow.stop();};});},initNextAndPrev:function(){this.next_link=$('<div class="gy-next"><div class="gy-next-image"></div></div>');this.prev_link=$('<div class="gy-prev"><div class="gy-prev-image"></div></div>');this.image_wrapper.append(this.next_link);this.image_wrapper.append(this.prev_link);var context=this;this.prev_link.add(this.next_link).mouseover(function(e){$(this).css('height',context.image_wrapper_height);$(this).find('div').show();}).mouseout(function(e){$(this).find('div').hide();}).click(function(){if($(this).is('.gy-next')){context.nextImage();context.slideshow.stop();}else{context.prevImage();context.slideshow.stop();};}).find('div').css('opacity',0.7);},initBackAndForward:function(){var context=this;this.scroll_forward=$('<div class="gy-forward"></div>');this.scroll_back=$('<div class="gy-back"></div>');this.nav.append(this.scroll_forward);this.nav.prepend(this.scroll_back);var has_scrolled=0;var thumbs_scroll_interval=false;$(this.scroll_back).add(this.scroll_forward).click(function(){var width=context.nav_display_width-50;if(context.settings.scroll_jump>0){var width=context.settings.scroll_jump;};if($(this).is('.gy-forward')){var left=context.thumbs_wrapper.scrollLeft()+width;}else{var left=context.thumbs_wrapper.scrollLeft()-width;};if(context.settings.slideshow.stop_on_scroll){context.slideshow.stop();};context.thumbs_wrapper.animate({scrollLeft:left+'px'});return false;}).css('opacity',0.6).hover(function(){var direction='left';if($(this).is('.gy-forward')){direction='right';};thumbs_scroll_interval=setInterval(function(){has_scrolled++;if(has_scrolled>30&&context.settings.slideshow.stop_on_scroll){context.slideshow.stop();};var left=context.thumbs_wrapper.scrollLeft()+1;if(direction=='left'){left=context.thumbs_wrapper.scrollLeft()-1;};context.thumbs_wrapper.scrollLeft(left);},10);$(this).css('opacity',1);},function(){has_scrolled=0;clearInterval(thumbs_scroll_interval);$(this).css('opacity',0.6);});},_afterShow:function(){this.gallery_info.html((this.current_index+1)+' / '+this.images.length);if(!this.settings.cycle){this.prev_link.show().css('height',this.image_wrapper_height);this.next_link.show().css('height',this.image_wrapper_height);if(this.current_index==(this.images.length-1)){this.next_link.hide();};if(this.current_index==0){this.prev_link.hide();};};this.fireCallback(this.settings.callbacks.afterImageVisible);},_getContainedImageSize:function(image_width,image_height){if(image_height>this.image_wrapper_height){var ratio=image_width/image_height;image_height=this.image_wrapper_height;image_width=this.image_wrapper_height*ratio;};if(image_width>this.image_wrapper_width){var ratio=image_height/image_width;image_width=this.image_wrapper_width;image_height=this.image_wrapper_width*ratio;};return{width:image_width,height:image_height};},_centerImage:function(img_container,image_width,image_height){img_container.css('top','0px');if(image_height<this.image_wrapper_height){var dif=this.image_wrapper_height-image_height;img_container.css('top',(dif/2)+'px');};img_container.css('left','0px');},_getDescription:function(image){var desc=false;if(image.desc.length||image.title.length){var title='';if(image.title.length){title='<strong class="gy-description-title">'+image.title+'</strong>';};var desc='';if(image.desc.length){desc='<span>'+image.desc+'</span>';};desc=$('<p class="gy-image-description">'+title+desc+'</p>');};return desc;},showImage:function(index,callback){if(this.images[index]&&!this.in_transition){var context=this;var image=this.images[index];this.in_transition=true;if(!image.preloaded){this.loading(true);this.preloadImage(index,function(){context.loading(false);context._showWhenLoaded(index,callback);});}else{this._showWhenLoaded(index,callback);};};},_showWhenLoaded:function(index,callback){if(this.images[index]){var context=this;var flag=$(".gallery_con .gy-nav").children().find('img:eq('+index+')').data('flag');var video_url=$(".gallery_con .gy-nav").children().find('img:eq('+index+')').data('vurl');if(flag=='vedio'){var image=this.images[index];var img_container=$(document.createElement('div')).addClass('gy-image');var img=$(new Image()).attr('src',image.image);if(image.link){var link=$('<a href="'+image.link+'" target="_blank"></a>');link.append(img);img_container.append(link);}else{img_container.append(img);}
var id=$(".gallery_con .gy-nav").children().find('img:eq('+index+')').data('id');var LANDH=$(".gallery_con .gy-nav").children().find('img:eq('+index+')').data('landh');var v_btn='<div class="gy_v_btn_bg  an_mo" data-vurl="'+video_url+'" liwithhan="'+LANDH+'"><textarea hidden class="TomJerry">{"system":"WAC","adlist":['+id+']}</textarea><div class="gy_v_btn"></div><a></a></div>';img_container.append(v_btn);this.image_wrapper.prepend(img_container);var size=this._getContainedImageSize(image.size.width,image.size.height);img.attr('width','500px');img.attr('height','280px');img_container.css({width:'500px',height:'280px'});this._centerImage(img_container,size.width,size.height);var desc=this._getDescription(image,img_container);if(desc){if(!this.settings.description_wrapper){img_container.append(desc);var width=size.width-parseInt(desc.css('padding-left'),10)-parseInt(desc.css('padding-right'),10);desc.css('width',width+'px');}else{this.settings.description_wrapper.append(desc);}};this.highLightThumb(this.nav.find('.gy-thumb'+index));var direction='right';if(this.current_index<index){direction='left';};this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var animation_speed=this.settings.animation_speed;var easing='swing';var animation=this.animations[this.settings.effect].call(this,img_container,direction,desc);if(typeof animation.speed!='undefined'){animation_speed=animation.speed;};if(typeof animation.easing!='undefined'){easing=animation.easing;};if(this.current_image){var old_image=this.current_image;var old_description=this.current_description;old_image.animate(animation.old_image,animation_speed,easing,function(){old_image.remove();if(old_description)old_description.remove();});};img_container.animate(animation.new_image,animation_speed,easing,function(){context.current_index=index;context.current_image=img_container;context.current_description=desc;context.in_transition=false;context._afterShow();context.fireCallback(callback);});}else{this.current_index=index;this.current_image=img_container;context.current_description=desc;this.in_transition=false;context._afterShow();this.fireCallback(callback);};}else{var image=this.images[index];var img_container=$(document.createElement('div')).addClass('gy-image');var img=$(new Image()).attr('src',image.image);if(image.link){var link=$('<a href="'+image.link+'" target="_blank"></a>');link.append(img);img_container.append(link);}else{img_container.append(img);}
this.image_wrapper.prepend(img_container);var size=this._getContainedImageSize(image.size.width,image.size.height);img.attr('width','500px');img.attr('height','280px');img_container.css({width:'500px',height:'280px'});this._centerImage(img_container,size.width,size.height);var desc=this._getDescription(image,img_container);if(desc){if(!this.settings.description_wrapper){img_container.append(desc);var width=size.width-parseInt(desc.css('padding-left'),10)-parseInt(desc.css('padding-right'),10);desc.css('width',width+'px');}else{this.settings.description_wrapper.append(desc);}};this.highLightThumb(this.nav.find('.gy-thumb'+index));var direction='right';if(this.current_index<index){direction='left';};this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var animation_speed=this.settings.animation_speed;var easing='swing';var animation=this.animations[this.settings.effect].call(this,img_container,direction,desc);if(typeof animation.speed!='undefined'){animation_speed=animation.speed;};if(typeof animation.easing!='undefined'){easing=animation.easing;};if(this.current_image){var old_image=this.current_image;var old_description=this.current_description;old_image.animate(animation.old_image,animation_speed,easing,function(){old_image.remove();if(old_description)old_description.remove();});};img_container.animate(animation.new_image,animation_speed,easing,function(){context.current_index=index;context.current_image=img_container;context.current_description=desc;context.in_transition=false;context._afterShow();context.fireCallback(callback);});}else{this.current_index=index;this.current_image=img_container;context.current_description=desc;this.in_transition=false;context._afterShow();this.fireCallback(callback);};}};},nextIndex:function(){if(this.current_index==(this.images.length-1)){if(!this.settings.cycle){return false;};var next=0;}else{var next=this.current_index+1;};return next;},nextImage:function(callback){var next=this.nextIndex();if(next===false)return false;this.preloadImage(next+1);this.showImage(next,callback);return true;},prevIndex:function(){if(this.current_index==0){if(!this.settings.cycle){return false;};var prev=this.images.length-1;}else{var prev=this.current_index-1;};return prev;},prevImage:function(callback){var prev=this.prevIndex();if(prev===false)return false;this.preloadImage(prev-1);this.showImage(prev,callback);return true;},preloadAll:function(){var context=this;var i=0;function preloadNext(){if(i<context.images.length){i++;context.preloadImage(i,preloadNext);};};context.preloadImage(i,preloadNext);},preloadImage:function(index,callback){if(this.images[index]){var image=this.images[index];if(!this.images[index].preloaded){var img=$(new Image());img.attr('src',image.image);if(!this.isImageLoaded(img[0])){this.preloads.append(img);var context=this;img.load(function(){image.preloaded=true;image.size={width:this.width,height:this.height};context.fireCallback(callback);}).error(function(){image.error=true;image.preloaded=false;image.size=false;});}else{image.preloaded=true;image.size={width:img[0].width,height:img[0].height};this.fireCallback(callback);};}else{this.fireCallback(callback);};};},isImageLoaded:function(img){if(typeof img.complete!='undefined'&&!img.complete){return false;};if(typeof img.naturalWidth!='undefined'&&img.naturalWidth==0){return false;};return true;},highLightThumb:function(thumb){this.thumbs_wrapper.find('.gy-active').removeClass('gy-active');thumb.addClass('gy-active');if(this.settings.thumb_opacity<1){this.thumbs_wrapper.find('a:not(.gy-active) img').fadeTo(300,this.settings.thumb_opacity);thumb.find('img').fadeTo(300,1);};var left=thumb[0].parentNode.offsetLeft;left-=(this.nav_display_width/2)-(thumb[0].offsetWidth/2);this.thumbs_wrapper.animate({scrollLeft:left+'px'});},fireCallback:function(fn){if($.isFunction(fn)){fn.call(this);};}};function AdGallerySlideshow(nextimage_callback,settings){this.init(nextimage_callback,settings);};AdGallerySlideshow.prototype={start_link:false,stop_link:false,countdown:false,controls:false,settings:false,nextimage_callback:false,enabled:false,running:false,countdown_interval:false,init:function(nextimage_callback,settings){var context=this;this.nextimage_callback=nextimage_callback;this.settings=settings;},create:function(){this.start_link=$('<span class="gy-slideshow-start">'+this.settings.start_label+'</span>');this.stop_link=$('<span class="gy-slideshow-stop">'+this.settings.stop_label+'</span>');this.countdown=$('<span class="gy-slideshow-countdown"></span>');this.controls=$('<div class="gy-slideshow-controls"></div>');this.controls.append(this.start_link).append(this.stop_link).append(this.countdown);this.countdown.hide();var context=this;this.start_link.click(function(){context.start();});this.stop_link.click(function(){context.stop();});$(document).keydown(function(e){if(e.keyCode==83){if(context.running){context.stop();}else{context.start();};};});return this.controls;},disable:function(){this.enabled=false;this.stop();this.controls.hide();},enable:function(){this.enabled=true;this.controls.show();},toggle:function(){if(this.enabled){this.disable();}else{this.enable();};},start:function(){if(this.running||!this.enabled)return false;var context=this;this.running=true;this.controls.addClass('gy-slideshow-running');this._next();this.fireCallback(this.settings.onStart);return true;},stop:function(){if(!this.running)return false;this.running=false;this.countdown.hide();this.controls.removeClass('gy-slideshow-running');clearInterval(this.countdown_interval);this.fireCallback(this.settings.onStop);return true;},_next:function(){var context=this;var pre=this.settings.countdown_prefix;var su=this.settings.countdown_sufix;clearInterval(context.countdown_interval);this.countdown.show().html(pre+(this.settings.speed/1000)+su);var slide_timer=0;this.countdown_interval=setInterval(function(){slide_timer+=1000;if(slide_timer>=context.settings.speed){var whenNextIsShown=function(){if(context.running){context._next();};slide_timer=0;};if(!context.nextimage_callback(whenNextIsShown)){context.stop();};slide_timer=0;};var sec=parseInt(context.countdown.text().replace(/[^0-9]/g,''),10);sec--;if(sec>0){context.countdown.html(pre+sec+su);};},1000);},fireCallback:function(fn){if($.isFunction(fn)){fn.call(this);};}};});;define('tour_amd/ckplayer',['jquery'],function($){function ckcpt(){var cpt='';cpt+='right.swf,2,1,0,0,2,0|';cpt+='share.swf,1,1,-180,-100,3,0|';cpt+='adjustment.swf,1,1,-180,-100,3,0|';return cpt;}
function ckstyle(){var ck={cpath:'',language:'',flashvars:'',setup:'1,1,1,1,1,2,0,1,2,0,0,1,200,0,2,1,0,1,1,1,2,10,3,0,1,2,3000,0,0,0,0,1,1,1,1,1,1,250,0,90',pm_bg:'0x000000,100,230,180',mylogo:'',pm_mylogo:'1,1,-100,-55',logo:'null',pm_logo:'2,0,-100,20',control_rel:'related.swf,ckplayer/related.xml,0',control_pv:'Preview.swf,105,2000',pm_repc:'',pm_spac:'|',pm_fpac:'file->f',pm_advtime:'2,0,-110,10,0,300,0',pm_advstatus:'1,2,2,-200,-40',pm_advjp:'1,1,2,2,-100,-40',pm_padvc:'2,0,-10,-10',pm_advms:'2,2,-46,-56',pm_zip:'1,1,-20,-8,1,0,0',pm_advmarquee:'1,2,50,-60,50,20,0,0x000000,50,0,20,1,30,2000',pm_glowfilter:'1,0x01485d, 100, 6, 3, 10, 1, 0, 0',advmarquee:escape(''),mainfuntion:'',flashplayer:'',calljs:'ckplayer_status,ckadjump,playerstop,ckmarqueeadv',myweb:escape(''),cpt_lights:'1',cpt_share:'ckplayer/share.xml',cpt_list:ckcpt()}
return ck;}
(function(){var CKobject={_K_:function(d){return document.getElementById(d);},_T_:false,_M_:false,_G_:false,_Y_:false,_I_:null,_J_:0,_O_:{},uaMatch:function(u,rMsie,rFirefox,rOpera,rChrome,rSafari,rSafari2,mozilla,mobile){var match=rMsie.exec(u);if(match!=null){return{b:'IE',v:match[2]||'0'}}
match=rFirefox.exec(u);if(match!=null){return{b:match[1]||'',v:match[2]||'0'}}
match=rOpera.exec(u);if(match!=null){return{b:match[1]||'',v:match[2]||'0'}}
match=rChrome.exec(u);if(match!=null){return{b:match[1]||'',v:match[2]||'0'}}
match=rSafari.exec(u);if(match!=null){return{b:match[2]||'',v:match[1]||'0'}}
match=rSafari2.exec(u);if(match!=null){return{b:match[1]||'',v:match[2]||'0'}}
match=mozilla.exec(u);if(match!=null){return{b:match[1]||'',v:match[2]||'0'}}
match=mobile.exec(u);if(match!=null){return{b:match[1]||'',v:match[2]||'0'}}else{return{b:'unknown',v:'0'}}},browser:function(){var u=navigator.userAgent,rMsie=/(msie\s|trident.*rv:)([\w.]+)/,rFirefox=/(firefox)\/([\w.]+)/,rOpera=/(opera).+version\/([\w.]+)/,rChrome=/(chrome)\/([\w.]+)/,rSafari=/version\/([\w.]+).*(safari)/,rSafari2=/(safari)\/([\w.]+)/,mozilla=/(mozilla)\/([\w.]+)/,mobile=/(mobile)\/([\w.]+)/;var c=u.toLowerCase();var d=this.uaMatch(c,rMsie,rFirefox,rOpera,rChrome,rSafari,rSafari2,mozilla,mobile);if(d.b){b=d.b;v=d.v;}
return{B:b,V:v};},Platform:function(){var w='';var u=navigator.userAgent,app=navigator.appVersion;var b={iPhone:u.indexOf('iPhone')>-1||u.indexOf('Mac')>-1,iPad:u.indexOf('iPad')>-1,ios:!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:u.indexOf('Android')>-1||u.indexOf('Linux')>-1,webKit:u.indexOf('AppleWebKit')>-1,trident:u.indexOf('Trident')>-1,gecko:u.indexOf('Gecko')>-1&&u.indexOf('KHTML')==-1,presto:u.indexOf('Presto')>-1,mobile:!!u.match(/AppleWebKit.*Mobile.*/)||!!u.match(/AppleWebKit/),webApp:u.indexOf('Safari')==-1};for(var k in b){if(b[k]){w=k;break;}}
return w;},isHTML5:function(){return!!document.createElement('video').canPlayType;},getType:function(){return this._T_;},getVideo:function(){var v='';var s=this._E_['v'];if(s&&s.length>1){for(var i=0;i<s.length;i++){var a=s[i].split('->');if(a.length>=1&&a[0]!=''){v+='<source src="'+a[0]+'"';}
if(a.length>=2&&a[1]!=''){v+=' type="'+a[1]+'"';}
v+='>';}}
return v;},getVars:function(k){var o=this._A_;if(typeof(o)=='undefined'){return null;}
if(k in o){return o[k];}else{return null;}},getParams:function(){var p='';if(this._A_){if(parseInt(this.getVars('p'))==1){p+=' autoplay="autoplay"';}
if(parseInt(this.getVars('e'))==1){p+=' loop="loop"';}
if(parseInt(this.getVars('p'))==2){p+=' preload="metadata"';}
if(this.getVars('i')){p+=' poster="'+this.getVars('i')+'"';}}
return p;},getpath:function(z){var f='CDEFGHIJKLMNOPQRSTUVWXYZcdefghijklmnopqrstuvwxyz';var w=z.substr(0,1);if(f.indexOf(w)>-1&&(z.substr(0,4)==w+'://'||z.substr(0,4)==w+':\\')){return z;}
var d=unescape(window.location.href).replace('file:///','');var k=parseInt(document.location.port);var u=document.location.protocol+'//'+document.location.hostname;var l='',e='',t='';var s=0;var r=unescape(z).split('//');if(r.length>0){l=r[0]+'//'}
var h='http|https|ftp|rtsp|mms|ftp|rtmp|file';var a=h.split('|');if(k!=80&&k){u+=':'+k;}
for(i=0;i<a.length;i++){if((a[i]+'://')==l){s=1;break;}}
if(s==0){if(z.substr(0,1)=='/'){t=u+z;}else{e=d.substring(0,d.lastIndexOf('/')+1).replace('\\','/');var w=z.replace('../','./');var u=w.split('./');var n=u.length;var r=w.replace('./','');var q=e.split('/');var j=q.length-n;for(i=0;i<j;i++){t+=q[i]+'/';}
t+=r;}}else{t=z;}
return t;},getXhr:function(){var x;try{x=new ActiveXObject('Msxml2.XMLHTTP');}catch(e){try{x=new ActiveXObject('Microsoft.XMLHTTP');}catch(e){x=false;}}
if(!x&&typeof XMLHttpRequest!='undefined'){x=new XMLHttpRequest();}
return x;},getX:function(){var f='ckstyle()';if(this.getVars('x')){f=this.getVars('x')+'()';}
try{if(typeof(eval(f))=='object'){this._X_=eval(f);}}catch(e){try{if(typeof(eval(ckstyle))=='object'){this._X_=ckstyle();}}catch(e){this._X_=ckstyle();}}},getSn:function(s,n){if(n>=0){return this._X_[s].split(',')[n];}else{return this._X_[s];}},getUrl:function(L,B){var b=['get','utf-8'];if(L&&L.length==2){var a=L[0];var c=L[1].split('/');if(c.length>=2){b[0]=c[1];}
if(c.length>=3){b[1]=c[2];}
this.ajax(b[0],b[1],a,function(s){var C=CKobject;if(s&&s!='error'){var d='',e=s;if(s.indexOf('}')>-1){var f=s.split('}');for(var i=0;i<f.length-1;i++){d+=f[i]+'}';var h=f[i].replace('{','').split('->');if(h.length==2){C._A_[h[0]]=h[1];}}
e=f[f.length-1];}
C._E_['v']=e.split(',');if(B){C.showHtml5();}else{C.changeParams(d);C.newAdr();}}});}},getflashvars:function(s){var v='',i=0;if(s){for(var k in s){if(i>0){v+='&';}
if(k=='f'&&s[k]&&!this.getSn('pm_repc',-1)){s[k]=this.getpath(s[k]);if(s[k].indexOf('&')>-1){s[k]=encodeURIComponent(s[k]);}}
if(k=='y'&&s[k]){s[k]=this.getpath(s[k]);}
v+=k+'='+s[k];i++;}}
return v;},getparam:function(s){var w='',v='',o={allowScriptAccess:'always',allowFullScreen:true,quality:'high',bgcolor:'#000'};if(s){for(var k in s){o[k]=s[k];}}
for(var e in o){w+=e+'="'+o[e]+'" ';v+='<param name="'+e+'" value="'+o[e]+'" />';}
w=w.replace('movie=','src=');return{w:w,v:v};},getObjectById:function(s){if(this._T_){return this;}
var X=null,Y=this._K_(s),r='embed';if(Y&&Y.nodeName=='OBJECT'){if(typeof Y.SetVariable!='undefined'){X=Y;}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z;}}}
return X;},ajax:function(b,u,s,f){var x=this.getXhr();var a=[],m='';if(b=='get'){if(s.indexOf('?')>-1){m=s+'&t='+new Date().getTime();}else{m=s+'?t='+new Date().getTime();}
x.open('get',m);}else{a=s.split('?');s=a[0],m=a[1];x.open('post',s,true);}
x.setRequestHeader('Content-Type','application/x-www-form-urlencoded');x.setRequestHeader('charset',u);if(b=='post'){x.send(m);}else{x.send(null);}
x.onreadystatechange=function(){if(x.readyState==4){var g=x.responseText;if(g!=''){f(g);}else{f(null);}}}},addListener:function(e,f){var o=CKobject._V_;if(o.addEventListener){try{o.addEventListener(e,f,false);}catch(e){this.getNot();}}else if(o.attachEvent){try{o.attachEvent('on'+e,f);}catch(e){this.getNot();}}else{o['on'+e]=f;}},removeListener:function(e,f){var o=CKobject._V_;if(o.removeEventListener){try{o.removeEventListener(e,f,false);}catch(e){this.getNot();}}else if(o.detachEvent){try{o.detachEvent('on'+e,f);}catch(e){this.getNot();}}else{o['on'+e]=null;}},Flash:function(){var f=false,v=0;if(document.all||this.browser()['B'].toLowerCase().indexOf('ie')>-1){try{var s=new ActiveXObject('ShockwaveFlash.ShockwaveFlash');f=true;var z=s.GetVariable('$version');v=parseInt(z.split(' ')[1].split(',')[0]);}catch(e){}}else{if(navigator.plugins&&navigator.plugins.length>0){var s=navigator.plugins['Shockwave Flash'];if(s){f=true;var w=s.description.split(' ');for(var i=0;i<w.length;++i){if(isNaN(parseInt(w[i])))continue;v=parseInt(w[i]);}}}}
return{f:f,v:v};},embed:function(f,d,i,w,h,b,v,e,p){var s=['all'];if(b){if(this.isHTML5()){this.embedHTML5(d,i,w,h,e,v,s);}else{this.embedSWF(f,d,i,w,h,v,p);}}else{if(this.Flash()['f']&&parseInt(this.Flash()['v'])>10){this.embedSWF(f,d,i,w,h,v,p);}else if(this.isHTML5()){this.embedHTML5(d,i,w,h,e,v,s);}else{this.embedSWF(f,d,i,w,h,v,p);}}},embedSWF:function(C,D,N,W,H,V,P){if(!N){N='ckplayer_a1'}
if(!P){P={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always',wmode:'transparent'};}
this._A_=V;this.getX();var u='undefined',g=false,j=document,r='http://www.macromedia.com/go/getflashplayer',t='<a href="'+r+'" target="_blank">请点击此处下载安装最新的flash插件</a>',error={w:'您的网页不符合w3c标准，无法显示播放器',f:'您没有安装flash插件，无法播放视频，'+t,v:'您的flash插件版本过低，无法播放视频，'+t},w3c=typeof j.getElementById!=u&&typeof j.getElementsByTagName!=u&&typeof j.createElement!=u,i='id="'+N+'" name="'+N+'" ',s='',l='';P['movie']=C;P['flashvars']=this.getflashvars(V);if(W==-1){d=true;this._K_(D).style.width='100%';W='100%';}
s+='<object pluginspage="http://www.macromedia.com/go/getflashplayer" ';s+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ';s+='codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" ';s+='width="'+W+'" ';s+='height="'+H+'" ';s+=i;s+='align="middle">';s+=this.getparam(P)['v'];s+='<embed ';s+=this.getparam(P)['w'];s+=' width="'+W+'" height="'+H+'" name="'+N+'" id="'+N+'" align="middle" '+i;s+='type="application/x-shockwave-flash" pluginspage="'+r+'" />';s+='</object>';if(!w3c){l=error['w'];g=true;}else{if(!this.Flash()['f']){l=error['f'];g=true;}else{if(this.Flash()['v']<10){l=error['v'];g=true;}else{l=s;this._T_=false;}}}
if(l){this._K_(D).innerHTML=l;}
if(g){this._K_(D).style.color='#0066cc';this._K_(D).style.lineHeight=this._K_(D).style.height;this._K_(D).style.textAlign='center';}},embedHTML5:function(C,P,W,H,V,A,S){this._E_={c:C,p:P,w:W,h:H,v:V,s:S};this._A_=A;this.getX();b=this.browser()['B'],v=this.browser()['V'],x=v.split('.'),t=x[0],m=b+v,n=b+t,w='',s=false,f=this.Flash()['f'],a=false;if(!S){S=['iPad','iPhone','ios'];}
for(var i=0;i<S.length;i++){w=S[i];if(w.toLowerCase()=='all'){s=true;break;}
if(w.toLowerCase()=='all+false'&&!f){s=true;break;}
if(w.indexOf('+')>-1){w=w.split('+')[0];a=true;}else{a=false;}
if(this.Platform()==w||m==w||n==w||b==w){if(a){if(!f){s=true;break;}}else{s=true;break;}}}
if(s){if(V){var l=V[0].split('->');if(l&&l.length==2&&l[1].indexOf('ajax')>-1){this.getUrl(l,true);return;}}
this.showHtml5();}},status:function(){this._H_=parseInt(this.getSn('setup',20));var f='ckplayer_status';if(this.getSn('calljs',0)!=''){f=this.getSn('calljs',0);}
try{if(typeof(eval(f))=='function'){this._L_=eval(f);this._M_=true;return true;}}catch(e){try{if(typeof(eval(ckplayer_status))=='function'){this._L_=ckplayer_status;this._M_=true;return true;}}catch(e){return false;}}
return false;},showHtml5:function(){var C=CKobject;var p=C._E_['p'],a=C._E_['v'],c=C._E_['c'],b=false;var s=this._E_['v'];var w=C._E_['w'],h=C._E_['h'];var d=false;var r='';if(s.length==1){r=' src="'+s[0].split('->')[0]+'"';}
if(w==-1){d=true;C._K_(c).style.width='100%';w='100%';}
if(w.toString().indexOf('%')>-1){w='100%';}
if(h.toString().indexOf('%')>-1){h='100%';}
var v='<video controls'+r+' id="'+p+'" width="'+w+'" height="'+h+'"'+C.getParams()+'>'+C.getVideo()+'</video>';C._K_(c).innerHTML=v;C._K_(c).style.backgroundColor='#000';C._V_=this._K_(p);if(!d){C._K_(c).style.width=this._E_['w'].toString().indexOf('%')>-1?(C._K_(c).offsetWidth*parseInt(this._E_['w'])*0.01)+'px':C._V_.width+'px';C._K_(c).style.height=this._E_['h'].toString().indexOf('%')>-1?(C._K_(c).offsetHeight*parseInt(this._E_['h'])*0.01)+'px':C._V_.height+'px';}
C._P_=false;C._T_=true;if(C.getVars('loaded')!=''){var f=C.getVars('loaded')+'()';try{if(typeof(eval(f))=='function'){eval(f);}}catch(e){try{if(typeof(eval(loadedHandler))=='function'){loadedHandler();}}catch(e){}}}
C.status();C.addListener('play',C.playHandler);C.addListener('pause',C.playHandler);C.addListener('error',C.errorHandler);C.addListener('emptied',C.errorHandler);C.addListener('loadedmetadata',C.loadedMetadataHandler);C.addListener('ended',C.endedHandler);C.addListener('volumechange',C.volumeChangeHandler);},videoPlay:function(){if(this._T_){this._V_.play();}},videoPause:function(){if(this._T_){this._V_.pause();}},playOrPause:function(){if(this._T_){if(this._V_.paused){this._V_.play();}else{this._V_.pause();}}},fastNext:function(){if(this._T_){this._V_['currentTime']=this._V_['currentTime']+10;}},fastBack:function(){if(this._T_){this._V_['currentTime']=this._V_['currentTime']-10;}},changeVolume:function(n){if(this._T_){this._V_['volume']=n*0.01;}},videoSeek:function(t){if(this._T_){this._V_['currentTime']=t;}},newAddress:function(u){var s=[];if(u){s=this.isHtml5New(u);}else{return;}
if(s&&this._T_){this.changeParams(u);var l=s[0].split('->');if(l&&l.length==2&&l[1].indexOf('ajax')>-1){this.getUrl(l,false);return;}
this._E_['v']=s;this.newAdr();}},quitFullScreen:function(){if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}},changeStatus:function(n){this._H_=n;},newAdr:function(){var s=this._E_['v'];this._V_.pause();if(s.length==1){this._V_.src=s[0].split('->')[0];}else{this._V_['innerHTML']=this.getVideo();}
this._V_.load();},isHtml5New:function(s){if(s.indexOf('html5')==-1){return false;}
var a=s.replace(/{/g,'');var b=a.split('}');var c='';for(var i=0;i<b.length;i++){if(b[i].indexOf('html5')>-1){c=b[i].replace('html5->','').split(',');break;}}
return c;},changeParams:function(f){if(f){var a=f.replace(/{/g,'');var b=a.split('}');var c='';for(var i=0;i<b.length;i++){var d=b[i].split('->');if(d.length==2){switch(d[0]){case'p':if(parseInt(d[1])==1){this._V_.autoplay=true;}else if(parseInt(d[1])==2){this._V_.preload='metadata';}else{this._V_.autoplay=false;if(this._I_!=null){clearInterval(this._I_);this._I_=null;}}
break;case'e':if(parseInt(d[1])==1){this._V_.loop=true;}else{this._V_.loop=false;}
break;case'i':this._V_.poster=d[1];break;default:break;}}}}},frontAdPause:function(s){this.getNot();},frontAdUnload:function(){this.getNot();},changeFace:function(s){this.getNot();},plugin:function(a,b,c,d,e,f,g){this.getNot();},videoClear:function(){this.getNot();},videoBrightness:function(s){this.getNot();},videoContrast:function(s){this.getNot();},videoSaturation:function(s){this.getNot();},videoSetHue:function(s){this.getNot();},videoWAndH:function(a,b){this.getNot();},videoWHXY:function(a,b,c,d){this.getNot();},changeFlashvars:function(a){this.getNot();},changeMyObject:function(a,b){this.getNot();},getMyObject:function(a,b){this.getNot();},changeeFace:function(){this.getNot();},changeStyle:function(a,b){this.getNot();},promptLoad:function(){this.getNot();},promptUnload:function(){this.getNot();},marqueeLoad:function(a,b){this.getNot();},marqueeClose:function(s){this.getNot();},getNot:function(){var s='The ckplayer\'s API for HTML5 does not exist';return s;},volumeChangeHandler:function(){var C=CKobject;if(C._V_.muted){C.returnStatus('volumechange:0',1);C._O_['volume']=0;C._O_['mute']=true;}else{C._O_['mute']=false;C._O_['volume']=C._V_['volume']*100;C.returnStatus('volumechange:'+C._V_['volume']*100,1);}},endedHandler:function(){var C=CKobject;var e=parseInt(C.getVars('e'));C.returnStatus('ended',1);if(C._I_){clearInterval(C._I_);C._I_=null;}
if(e!=0&&e!=4&&e!=6){return;}
if(e==6){this.quitFullScreen();}
var f='playerstop()';if(C.getSn('calljs',2)!=''){f=C.getSn('calljs',2)+'()';}
try{if(typeof(eval(f))=='function'){eval(f);return;}}catch(e){try{if(typeof(eval(playerstop))=='function'){playerstop();return;}}catch(e){return;}}},loadedMetadataHandler:function(){var C=CKobject;C.returnStatus('loadedmetadata',1);C._O_['totaltime']=C._V_['duration'];C._O_['width']=C._V_['width'];C._O_['height']=C._V_['height'];C._O_['awidth']=C._V_['videoWidth'];C._O_['aheight']=C._V_['videoHeight'];if(C._V_.defaultMuted){C.returnStatus('volumechange:0',1);C._O_['mute']=true;C._O_['volume']=0;}else{C._O_['mute']=false;C._O_['volume']=C._V_['volume']*100;C.returnStatus('volumechange:'+C._V_['volume']*100,1);}},errorHandler:function(){CKobject.returnStatus('error',1);},playHandler:function(){var C=CKobject;if(C._V_.paused){C.returnStatus('pause',1);C.addO('play',false);if(C._I_!=null){clearInterval(C._I_);C._I_=null;}}else{C.returnStatus('play',1);C.addO('play',true);if(!C._P_){C.returnStatus('play',1);C._P_=true;}
C._I_=setInterval(C.playTime,parseInt(C.getSn('setup',37)));if(!C._G_){C._G_=true;for(var k in C._A_){if(k=='g'&&C._A_[k]){var g=parseInt(C._A_[k]);C.videoSeek(g);}}}
if(!C._Y_){C._Y_=true;for(var k in C._A_){if(k=='j'&&C._A_[k]){var j=parseInt(C._A_[k]);if(j>0){C._J_=j;}else{C._J_=parseInt(C._O_['totaltime'])+j;}}}}}},returnStatus:function(s,j){var h=s;if(this._H_==3){h=this._E_['p']+'->'+h;}
if(this._M_&&j<=this._H_){this._L_(h);}},addO:function(s,z){this._O_[s]=z;},getStatus:function(){return this._O_;},playTime:function(){var C=CKobject;var t=C._V_['currentTime'];C._O_['time']=t;if(C._J_>0&&t>C._J_){C._J_=0;C.videoSeek(C._O_['totaltime']);}
C.returnStatus('time:'+t,1);}}
window.CKobject=CKobject;})();});define('tour_amd/tour_side',['jquery'],function($){var exports={};var proListv3=proListv3||{};proListv3={init:function(){proListv3.showBookingTips();proListv3.floatTab();proListv3.hoverHotLine();},showBookingTips:function(){$('.icon_tip').on({mouseenter:function(){utip=$(this).next('.popTip');if(utip.length){$('.popBox').length>0?tip=$('.popBox'):tip=$('<div class="popBox"></div>').appendTo('body');tip.html(utip.html());tip.show();}},mouseleave:function(){tip=$('.popBox')
if(tip.length){tip.hide();}},mousemove:function(e){tip=$('.popBox')
if(tip.length){var mousex=e.pageX+20;var mousey=e.pageY;var tipWidth=tip.outerWidth();var tipHeight=tip.outerHeight();var tipVisX=$(window).width()-(mousex+tipWidth);var tipVisY=$(window).height()-(mousey+tipHeight);if(tipVisX<20){mousex=e.pageX-tipWidth-20;}
if(tipVisY<0){mousey=e.pageY-tipHeight;}
tip.css({top:mousey,left:mousex});}}})},floatTab:function(){var tab=$('.floattabcontainer'),tabbox=tab.children('.float-tab');if(tab.length==0){return false;}
var isIE6=$.browser.msie&&$.browser.version=="6.0",tab=$('.floattabcontainer'),content=$('.contentbox'),item=content.find('.diytour_new');var _t=tab.offset().top,_top,_bottom;tabbox.find('li').click(function(){$(this).addClass('cur').siblings().removeClass('cur');if(content.find('.diytour_new[tabrel="'+$(this).attr('rel')+'"]').length>0){var pos=content.find('.diytour_new[tabrel="'+$(this).attr('rel')+'"]').offset().top;$('body,html').animate({'scrollTop':pos},200);}});var heightArr=[],timer;$(window).scroll(function(){clearTimeout(timer);timer=setTimeout(function(){act();},30);});function act(){_t=content.offset().top;_bottom=content.offset().top+content.height();_top=$(window).scrollTop();if(!isIE6){if(_top>_t&&_top<_bottom){tab.slideDown(100).css({'position':'fixed','top':0,'left':tab.offset().left-$(window).scrollLeft()});}else{tab.hide().css({'position':'static','top':0});}}
item.each(function(i){heightArr=[];if($(this).offset().top<_top+40){heightArr[i]=$(this).attr('tabrel');tabbox.find('li[rel="'+heightArr.pop()+'"]').addClass('cur').siblings().removeClass('cur');}})}},hoverHotLine:function(){$(".showPic li").live("mouseenter",function(){if($(this).index()!==0){var firstLi=$(this).parent().find("li:first");$(".pic",firstLi).stop(true,true).animate({width:"0px"});$(".des",firstLi).stop(true,true).animate({width:"125px",marginLeft:"25px"});$(firstLi).removeClass("cur");}
$(this).addClass("cur");$(".pic",this).stop(true,true).animate({width:"70px"});$(".des",this).stop(true,true).animate({width:"82px",marginLeft:"8px"});});$(".showPic li").live("mouseleave",function(){var firstLi=$(this).parent().find("li:first");$(firstLi).addClass("cur");$(".pic",firstLi).stop(true,true).animate({width:"70px"});$(".des",firstLi).stop(true,true).animate({width:"82px",marginLeft:"8px"});if($(this).index()!==0){$(".pic",this).stop(true,true).animate({width:"0px"});$(".des",this).stop(true,true).animate({width:"125px",marginLeft:"25px"});$(this).removeClass("cur");}});$('.showPic .c').live('mouseleave',function(){var firstLi=$(this).find("li:first");$(firstLi).addClass("cur");$(".pic",firstLi).stop(true,true).animate({width:"70px"});$(".des",firstLi).stop(true,true).animate({width:"82px",marginLeft:"8px"});});}};exports.init=proListv3.init;return exports;});;define('tour_amd/tabScroll',['jquery','common_amd/tool'],function($,tool){var exports={};var init;function pkgTabScroll(){var bd_li=$("#pkg-detail-tab-bd").children("li");var pkg_tab=$("#pkg-detail-tab-bd").offset().top;var pkg_tab_hand=$(".pkg-detail-tab");var pkg_box=$(".pkg-detail-box");var t_bd_li=$(".t_pkg_detail_tab .t_tab");var t_pkg_box=$(".t_pkg-detail-infor");var t_pkg_tab_hand=$(".t_pkg_detail_tab");var itinerary_span=$(".itinerary_span");if(itinerary_span.length>0){clickEvent(itinerary_span,function(){return $("#xcjs");},30);}
if(t_pkg_tab_hand.length>0){$.each(t_pkg_tab_hand,function(i,item){clickEvent($(item).find("li"),function(){return $("#tripcontent .tripcontent").eq(i).find("div.t_pkg-detail-infor")},40);});}
clickEvent(pkg_tab_hand.find('li'),function(){return $("#general_infor").find("div.pkg-detail-infor")},30);if($.browser.msie&&$.browser.version=="6.0"){return false;}
else{$(window).scroll(tool.event.debounce(function(){var rect=pkg_box[0].getBoundingClientRect();var t_rect=t_pkg_box.not(":hidden");if(t_pkg_box.length>0){var t_rect_f=t_rect[0].getBoundingClientRect();var t_rect_l=t_rect[t_rect.length-1].getBoundingClientRect();if(t_rect_f.top<50&&t_rect_l.bottom>40){pkg_tab_hand.css({"position":"static"});scrollEvent(t_rect,t_bd_li.not(":hidden").find("li"),t_pkg_tab_hand.not(":hidden"),t_pkg_box.not(":hidden"));}else{t_pkg_tab_hand.css({"position":"static"});scrollEvent(rect,bd_li,pkg_tab_hand,pkg_box.find(".pkg-detail-infor"));}}else{scrollEvent(rect,bd_li,pkg_tab_hand,pkg_box.find(".pkg-detail-infor"));}}));}}
function autopos(p_h){if($.browser.msie&&$.browser.version=="6.0"){return false;}else{p_h.css({"position":"fixed","top":0})}}
function clickEvent(cob,sobHandler,pix){cob.click(function(){$(this).stop(true);var index=$(this).index();var sob=sobHandler();var infor=sob.eq(index).offset().top-pix;$('html, body').animate({scrollTop:infor},500);return false;});}
function scrollEvent(rect,bd,tab_hand,box){var pkg_info;var status;if(rect.top>50){status=undefined;tab_hand.css({"position":"static"})}else{$.each(box,function(i,item){if(status===i)return;if(item.getBoundingClientRect().top<50){if(!box[i+1]||box[i+1].getBoundingClientRect().top>50){bd.siblings().removeClass("current");bd.eq(i).addClass("current");var s_top=$(window).scrollTop();autopos(tab_hand);status=i;return false;}}});}}
init=function(){init=function(){};pkgTabScroll();};exports.init=init;return exports;});;define('tour_amd/tour_main',['jquery','common_amd/monitor','tour_amd/jquery.gallery','tour_amd/ckplayer'],function($){var exports={};var init;var tourMain=tourMain||{};var pkg_isIE6=$.browser.msie&&$.browser.version=='6.0';var tagType=$('#tagType').val();tourMain={init:function(){tourMain.simulateSelect(".select_city",".select_list",".select_result");tourMain.simulateSelect(".select_date",".select_list",".select_result");tourMain.simulateSelect(".select_date",".s_list",".s_con");tourMain.simulateSelect(".select_adult",".s_alist",".s_acon");tourMain.simulateSelect(".select_child",".s_list",".s_ccon");tourMain.tipsShow('illustration',true);tourMain.tipsShow('fenqiAbout');tourMain.tipsShow('abhor',true);tourMain.tipsShow('adjutant');tourMain.tipsShow('comment');tourMain.tipsShow('youji',true);tourMain.tipsShow('niudaojia');tourMain.tipsShow('train',true);tourMain.tipsShow('fenqi',true);tourMain.tipsShow('free_wifi',true);tourMain.tipsShow('nWireless',true);tourMain.tipsShow('niuduidui',true);tourMain.tipsShow('duobaobi',true);tourMain.tipsShow('niuxianhua',true);tourMain.tipsShow('firstPay',true);tourMain.tipsShow('cj_icon_pay',true);tourMain.tipsShow('cj_icon_exit',true);tourMain.tipsShow('youhui',true);tourMain.tipsShow('installment',true);tourMain.switchIndex("#youhuiLink","#pkg-detail-tab-bd");tourMain.chuyouNumClick($("#adA-le"),$("#adA-ri"),$("#adultN"),tagType==11?0:1);tourMain.chuyouNumClick($("#adC-le"),$("#adC-ri"),$("#childN"),0);tourMain.expandInfo('recombox-d',$('.phy-book .recombox'),184-$(".recmark").height());tourMain.showMoreTuijian();tourMain.resizeScreen();tourMain.gallery();tourMain.changeTab("#city_menu_nav li","#city_menu_con .city_menu_item","cur","hover");if(tagType==11){var adultList=$('#select_adult_num .s_alist'),childList=$('#select_child_num .s_clist');childList.find('li:contains(0)').remove();adultList.find('li:contains(0)').remove();childList.prepend('<li>0</li>');adultList.prepend('<li>0</li>');}
$(".select_city .select_list a").live("click",function(){var departDate=$("#plan_date").val(),link=$(this).attr('href');if(link&&departDate){link+=(~link.indexOf("?")?"&":"?")+"departDate="+departDate;}
window.location.href=link;return false;});$('.transport').on('click',function(){var i=$.layer({type:1,title:false,fix:true,area:['622px','auto'],page:{dom:'.transport_hover'},success:function(layero){layero.css('top',($(window).height()-layero.height())/2);}});});$('.watch_more').hide();$('.zjdetail').toggle(function(){var $li=$(this).parent('span').parent('li');$li.next('.detailzj').slideDown(300);$li.css('border-bottom-width','0');},function(){var $li=$(this).parent('span').parent('li');$li.next('.detailzj').slideUp(300);$li.css('border-bottom-width','1px');})
var len=$('.yhhd_table').find('li.single').length;if(len>3){$('.yhhd_table').find('li.single:lt(3)').addClass('zj_cur').end().find('li.single:gt(4)').hide();$('.watch_more').show();}
$('.J_showCoupon').on('click',function(){if($('#userIdTmp').val()>0){var $self=$(this);var psId=$self.data('psid');$.ajax({url:'/yii.php',data:{r:'detail/driveV3/ReceiveCoupons',psId:psId},dataType:'json',beforeSend:function(){tourMain.dialog(false,'正在为您请求数据,请稍后');},success:function(res){if(res&&res.success){tourMain.dialog('提示','领取成功');}else{tourMain.dialog('提示','领取失败'+(res.msg?','+res.msg:''));$self.text('已领完');$self.off('click');}},error:function(){tourMain.dialog(true,'领取失败,');}})}else{if(typeof window.needLogin=="undefined"){window.location.href="https://passport.tuniu.com/login?origin=http://www.tuniu.com"+window.location.pathname;}else{tourMain.needLogin();}}});$('.watch_more').click(function(){var $this=$(this);if($this.hasClass('more')){$this.find('span').html('收起更多');$('.yhhd_table').find('li.single:gt(4)').show();$this.removeClass('more');$this.find('.jiantou').css('background-position','-16px -93px');$('.youhuiquan').show();}
else{$this.find('span').html('展开更多');$('.yhhd_table').find('li.single:gt(4)').hide();$this.addClass('more');$this.find('.jiantou').css('background-position','0 -93px');$('.youhuiquan').hide();}})
$('.JMultiRule').on('mouseenter',function(){$(this).addClass('tip-show').find('.yh-multi-tip').show();}).on('mouseleave',function(){$(this).removeClass('tip-show').find('.yh-multi-tip').hide();});},dialog:function(type,text){$.layer({title:type,dialog:{type:3,msg:text},success:function(layero){layero.css('top',($(window).height()-layero.height())/2);}});},needLogin:function(){if($("#new").length==0){$('body').append('<a target="_blank" id="new" href="https://passport.tuniu.com/login?origin=http://www.tuniu.com'+window.location.pathname+'"></a>');}
$("#new")[0].click();},simulateSelect:function(box,list,result){var self=this;$(box).hover(function(){$(this).addClass("select_hover");},function(){$(this).removeClass("select_hover");})
$("li",box).live("click",function(){var _this=$(this);var _parent=_this.parents(box).eq(0);var _result=_parent.find(result);_result.html(_this.html());if(_result.hasClass("grey")){_result.removeClass("grey");}
_parent.removeClass("select_hover");$(window).trigger("orderinfochange");var itinerary_span=$(".itinerary_span");if(itinerary_span.length>0){if(_parent.attr("id")=="selectDepartDate"){var itr_url="/yii.php?r=detail/tourV3/GetMultipleJourneyInfo";var date=_this.attr("id").substr(5,10);var tour_info_json=self.collectTourInfo(date);self.getItineraryByAjax(tour_info_json,itr_url);if($(".itinerary_show").is(":hidden")){$(".itinerary_show").show();}}}});$("li",box).live("click",function(){self.checkPeopleLimit2();});},collectTourInfo:function(date){var departure_date=date,id=$("#route_id").val();return{"routeId":id,"departDate":departure_date};},getItineraryByAjax:function(data,url){$.ajax({url:url,data:data,type:"POST",dataType:"json",timeout:300000,success:function(data){var attr=data.journeyId;var _this=$("#triptags li[option="+attr+"]");var _index=_this.index();$("#use_itinerary").text(data.name+"-"+data.labelName);$("#triptags li").siblings().removeClass("xc_selected");_this.addClass("xc_selected");$("#tripcontent .tripcontent").hide();$("#tripcontent .tripcontent").eq(_index).show();},error:function(data){}});},checkPeopleLimit2:function(){var adultList=$('#select_adult_num .s_alist'),childList=$('#select_child_num .s_clist'),adultNum=parseInt($("#select_adult_num .s_acon").html()),childNum=parseInt($("#select_child_num .s_ccon").html());if($("#transportation_train").length>0&&$("#transportation_train").val()==="1"){if(isNaN(adultNum)){adultNum=0;}
if(isNaN(childNum)){childNum=0;}
if((adultNum+childNum)>5){$("#people_limit_tip2").show();}else{$("#people_limit_tip2").hide();}}},scrollText:function(){if($("#ub_wrap").find("li").length>0){var marquee=new ScrollText("ub_wrap");marquee.LineHeight=30;marquee.Amount=1;marquee.Timeout=1000;marquee.Delay=30;marquee.Start();}},tipsShow:function(handler,holder){var o=$("."+handler),target=$("."+handler+"_hover");var _z=target.find(".z");var _y=target.find(".y");var showing=false,timer;o.hover(function(){showing=true;clearTimeout(timer);var aWidth=$(this).width();var _t=$(this).height()<20?24:$(this).height()+10;var top=$(this).offset().top+_t;var left=$(this).offset().left-(target.width()-$(this).width())/2;if(handler=='adjutant'&&$(window).width()<1200){left=left-49;$('.z,.y').css("left",175);}
target.show().css({'top':top,'left':left,'z-index':5000});_z.css('left',(target.width()-_z.width())/2);_y.css('left',(target.width()-_y.width())/2);if($(this).attr('rel-data')){target.find('p').text($(this).attr('rel-data'));}},function(){showing=false;if(holder){if(!showing){timer=setTimeout(function(){target.hide();},100)}}else{target.hide();}});if(holder){target.hover(function(){showing=true;clearTimeout(timer);},function(){showing=false;if(!showing){timer=setTimeout(function(){target.hide();},200)}})}},switchIndex:function(nav,content){$(nav).click(function(){var $content=$(content);$('html,body').animate({scrollTop:$content.offset().top},1500);})},initStudyTourNumber:function(){var minSum=1,list=[{type:'adult',plus:$('#adA-ri'),minus:$('#adA-le'),input:$('#adultN'),value:parseInt($('#adultN').val(),10),min:0,minusEnabled:true},{type:'child',plus:$('#adC-ri'),minus:$('#adC-le'),input:$('#childN'),value:parseInt($('#childN').val(),10),min:0,minusEnabled:true}];$.each(list,function(index,itemData){itemData.plus.click(function(){itemData.value++;itemData.input.val(itemData.value);checkState();});itemData.minus.click(function(){var value=itemData.value-1;if(itemData.minusEnabled){itemData.value=value;itemData.input.val(value);checkState();}});itemData.input.on('change',function(){var value=parseInt(this.value,10);if(!isNaN(value)&&(getSum()-itemData.value+value>=minSum)&&value>=itemData.min){itemData.value=value;checkState();}else{itemData.input.val(itemData.value);}});});function getSum(){var sum=0;$.each(list,function(index,itemData){sum+=itemData.value;});return sum;}
function checkState(){var sum=getSum(),min=0;if(sum<=minSum){min=1;}
$.each(list,function(index,itemData){if(sum<=minSum||itemData.value<=itemData.min){itemData.minus.removeClass("on");itemData.minusEnabled=false;}else{itemData.minus.addClass("on");itemData.minusEnabled=true;}});}
checkState();},chuyouNumClick:function(minus,plus,_input,num){var self=this;var i=parseInt(_input.val(),10);plus.click(function(){i++;_input.val(i);if(i>num){minus.addClass("on");}else{minus.removeClass("on");}
self.checkPeopleLimit();$(window).trigger("orderinfochange");})
minus.click(function(){if(i<=num){return false;}
i--;_input.val(i);if(i<=num){minus.removeClass("on");}
self.checkPeopleLimit();$(window).trigger("orderinfochange");});_input.on('blur',function(){var value=parseInt(_input.val(),10);if(value<num){_input.val(i);self.checkPeopleLimit();$(window).trigger("orderinfochange");}else{i=value;}
if(i>num){minus.addClass("on");}else{minus.removeClass("on");}});if(i<=num){minus.removeClass("on");}else{minus.addClass("on");}},checkPeopleLimit:function(){if($("#transportation_train").length>0&&$("#transportation_train").val()==="1"){var adultNum=parseInt($("#adultN").val()),childNum=parseInt($("#childN").val());if((adultNum+childNum)>5){$("#people_limit_tip1").show();}else{$("#people_limit_tip1").hide();}}},expandInfo:function(cls,box,h){setTimeout(function(){var outHeight=$("#recombox").height()||0;var innerHeight=$("#recomInnerBox").height()||0;if(innerHeight<outHeight){}
else{$(".showallbtn").show();box.hover(function(){$(this).css({'height':'auto','z-index':100});},function(){$(this).css('height',96);})}},200);box.css('height',96);},showMoreTuijian:function(){var o=$("#tuijian_btn");o.live("click",function(){var _this=$(this);if(!_this.hasClass("show")){_this.addClass("show");_this.next(".hot_line").addClass("on");}else{_this.removeClass("show");_this.next(".hot_line").removeClass("on");}})},gallery:function(){var cityCode=$("#beginCityCode").val();var entity=$("#route_id_tmp").val();var get_url='http://www.tuniu.com/yii.php?r=api/adapi/ads&jsoncallback=?&system=WEB&pageType=route&entity='+entity+'&position=video&cityCode='+cityCode;tourMain.getAdJsonpByAjax(get_url,function(data){if(data&&data.data&&data.data.length!=0){for(var i in data.data){var big_img_url=data.data[i].img_url;var small_img_url=data.data[i].img_url;var video_url=data.data[i].ad_link;var LANDH=data.LANDH;var id=data.data[i].id;$("#galleryCon .gy-thumb-list").eq(0).prepend('<li><a href="'+big_img_url+'" class="gy-active"><img src="'+small_img_url+'" width="90" height="50" alt="" data-flag="vedio" data-vurl="'+video_url+'" data-id="'+id+'" data-landh="'+LANDH+'" style="opacity: 1;"><div class="gy_vs_btn_bg"><div class="gy_vs_btn"></div></div></a></li>');$(".gallery_con").children().eq(0).html($("#galleryCon").children().eq(0).html());}}else{$(".gallery_con").children().eq(0).html($("#galleryCon").children().eq(0).html());}
$('#gallery').gyGallery({"width":500,"height":280});})
$("#gallery").on('click','.gy_v_btn_bg',function(){$.layer({type:1,title:false,border:[0],closeBtn:[0,true],shadeClose:true,area:['780px','550px'],page:{html:'<div id="video" style="width: 780px; height: 550px; background-color: rgb(0, 0, 0);z-index:1;position:relative;"></div>'}});var url=$(this).data('vurl');var firstImg=$(this).prev().attr('src');var flashvars={f:url,c:0,b:1,p:1,i:firstImg};var params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always',wmode:'transparent'};CKobject.embedSWF('http://img3.tuniucdn.com/zt/newplayer/ckplayer.swf','video','ckplayer_a1','780','550',flashvars,params);})
$("#gallery_nav li").click(function(){var $tab=$(this);var tab_index=$tab.index();var $content=$(".gallery_con").children();$("#gallery_nav li").removeClass("on");$tab.addClass("on");$content.empty();$content.eq(tab_index).html($("#galleryCon").children().eq(tab_index).html());$('#gallery').gyGallery({"width":500,"height":280});})},resizeScreen:function(){var index1200=$("#index1200");$("#tuijianRouteMore").css("right",($(window).width()-1000)/2+20);if(!tourMain.isBigThan1280()){index1200.removeClass("index1200").addClass("index1000");}else{index1200.removeClass("index1000").addClass("index1200");}
$(window).resize(function(){var w_wd=$(window).width();$("#tuijianRouteMore").css("right",(w_wd-1000)/2+20);$(window).trigger("scroll");if(!tourMain.isBigThan1280()){if(!index1200.hasClass("index1000")){index1200.removeClass("index1200").addClass("index1000");}}else{if(!index1200.hasClass("index1200")){index1200.removeClass("index1000").addClass("index1200");}}});},isIE6:function(){if($.browser.msie&&$.browser.version==6){return true;}else{return false;}},isBigThan1280:function(){var w_wd=$(window).width();if(w_wd>=1280){return true;}else{return false;}},changeTab:function(nav,con,on,type){$(nav).on(type,function(){var _this=$(this);var _index=_this.index();_this.addClass(on).siblings().removeClass(on);$(con).hide();$(con).eq(_index).show();})},changeCat:function(){var cat_key=0;var bar_width=$(".cat").width();var all_width=0;var length=$(".cat *").length;$(".cat *").each(function(){var this_width=$(this).width();all_width+=this_width+10;cat_key=$(this).index();if(cat_key==length-2&&all_width+$(".cat *:last").width()<bar_width){return false;}else if(all_width+30<bar_width){return true;}else{var index=cat_key-1;$(".cat").append('<span class="close_more page_tip">收起<div class="arrow_box_up"><div class="arrow_box_up1"></div><div class="arrow_box_up2"></div></div></span>');$(".cat >span:gt("+index+")").hide();$(".cat").append('<span class="show_more page_tip">更多<div class="arrow_box_down"><div class="arrow_box_down1"></div><div class="arrow_box_down2"></div></div></span>');$(".show_more").on("click",function(){$(".cat >span").show();$(".show_more").hide();})
$(".close_more").on("click",function(){var index=cat_key-1;$(".cat >span:gt("+index+")").hide();$(".show_more").show();})
return false;}})},getAdJsonpByAjax:function(url,callback){$.ajax({'type':'get','url':url,'dataType':'jsonp','jsonp':'callback',success:function(data){callback(data);},error:function(){callback({});}});}};init=function(){tourMain.init();setTimeout(function(){$("#gallery_nav li.on").trigger("click")},500);tourMain.changeCat();};exports.init=init;return exports;});;define('tour_amd/general_infor',['jquery'],function($){var exports={};var pkgDetailInfor=pkgDetailInfor||{};pkgDetailInfor={init:function(){pkgDetailInfor.autocomp("#now_yuding");},autocomp:function(o){$(o).click(function(){$("html,body").animate({"scrollTop":160},600);})}};function tabScroll(){var sidebarPrv=$("#tripall .sidebarPrv");var ie6=$.browser.msie&&$.browser.version=="6.0";if(!sidebarPrv.length)return;if(ie6)return;var sidebar=sidebarPrv.children(".sidebar");var len=sidebar.children('a').size();var _height=len*35;var _top;var _s=sidebarPrv.offset().top-60;var ydxzTop=$('#xcjs').find(".btcircle").offset().top;var dayHei=ydxzTop-_height;var contentIdList=[];sidebar.find("a").each(function(){contentIdList.push($($(this)[0]).attr("rel"));})
sidebar.find('a').click(function(){$(this).stop(true,true);$(this).addClass('current').siblings().removeClass('current');var $day_li=$(this).index();var d_infor=$("#tripall").find("div.tripdays").eq($day_li).offset().top-44;$('html, body').animate({scrollTop:d_infor},500);return false;});var _status=100;state_=false;function iday(){_top=$(window).scrollTop();if(_s<_top&&dayHei>_top){sidebar.css({'position':'fixed','top':44});state_=false;}
else if(dayHei<_top&&ydxzTop>_top){sidebar.css({'position':'absolute','top':dayHei-_s-60});}
else{sidebar.removeAttr('style');state_=true;}
if(!state_){scrollDay();}}
function scrollDay(){$.each(contentIdList,function(i,list){var topCurr=$("#"+list).offset().top-50;if(i<contentIdList.length-1){var topNext=$("#"+contentIdList[i+1]).offset().top-50;if(_top>=topCurr&&_top<topNext){sidebar.find("a").eq(i).addClass("current").siblings().removeClass("current");return false;}
if(_top<topCurr){sidebar.find("a").eq(0).addClass("current").siblings().removeClass("current");return false;}}else{sidebar.find("a").eq(i).addClass("current").siblings().removeClass("current");}});}
$(window).scroll(iday);}
window.tabScroll=tabScroll;var init=function(){pkgDetailInfor.init();tabScroll();};exports.init=init;return exports;});;define('tour_amd/fullcalendar-min_add',['jquery'],function($){var defaults={defaultView:'month',aspectRatio:1.35,header:{left:'title',center:'',right:'today prev,next'},weekends:true,allDayDefault:true,ignoreTimezone:true,lazyFetching:true,startParam:'start',endParam:'end',titleFormat:{month:'MMMM yyyy',week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:'dddd, MMM d, yyyy'},columnFormat:{month:'ddd',week:'ddd M/d',day:'dddd M/d'},timeFormat:{'':'h(:mm)t'},isRTL:false,firstDay:0,monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],buttonText:{prev:'&nbsp;&#9668;&nbsp;',next:'&nbsp;&#9658;&nbsp;',prevYear:'&nbsp;&lt;&lt;&nbsp;',nextYear:'&nbsp;&gt;&gt;&nbsp;',today:'today',month:'month',week:'week',day:'day'},theme:false,buttonIcons:{prev:'circle-triangle-w',next:'circle-triangle-e'},unselectAuto:true,dropAccept:'*'};var rtlDefaults={header:{left:'next,prev today',center:'',right:'title'},buttonText:{prev:'&nbsp;&#9658;&nbsp;',next:'&nbsp;&#9668;&nbsp;',prevYear:'&nbsp;&gt;&gt;&nbsp;',nextYear:'&nbsp;&lt;&lt;&nbsp;'},buttonIcons:{prev:'circle-triangle-e',next:'circle-triangle-w'}};var fc=$.fullCalendar={version:"1.5.3"};var fcViews=fc.views={};$.fn.fullCalendar=function(options){if(typeof options=='string'){var args=Array.prototype.slice.call(arguments,1);var res;this.each(function(){var calendar=$.data(this,'fullCalendar');if(calendar&&$.isFunction(calendar[options])){var r=calendar[options].apply(calendar,args);if(res===undefined){res=r}
if(options=='destroy'){$.removeData(this,'fullCalendar')}}});if(res!==undefined){return res}
return this}
var eventSources=options.eventSources||[];delete options.eventSources;if(options.events){eventSources.push(options.events);delete options.events}
options=$.extend(true,{},defaults,(options.isRTL||options.isRTL===undefined&&defaults.isRTL)?rtlDefaults:{},options);this.each(function(i,_element){var element=$(_element);var calendar=new Calendar(element,options,eventSources);element.data('fullCalendar',calendar);calendar.render()});return this};function setDefaults(d){$.extend(true,defaults,d)}
function Calendar(element,options,eventSources){var t=this;t.options=options;t.render=render;t.destroy=destroy;t.refetchEvents=refetchEvents;t.reportEvents=reportEvents;t.reportEventChange=reportEventChange;t.rerenderEvents=rerenderEvents;t.changeView=changeView;t.select=select;t.unselect=unselect;t.prev=prev;t.next=next;t.prevYear=prevYear;t.nextYear=nextYear;t.today=today;t.gotoDate=gotoDate;t.incrementDate=incrementDate;t.formatDate=function(format,date){return formatDate(format,date,options)};t.formatDates=function(format,date1,date2){return formatDates(format,date1,date2,options)};t.getDate=getDate;t.getView=getView;t.option=option;t.trigger=trigger;EventManager.call(t,options,eventSources);var isFetchNeeded=t.isFetchNeeded;var fetchEvents=t.fetchEvents;var _element=element[0];var header;var headerElement;var content;var tm;var currentView;var viewInstances={};var elementOuterWidth;var suggestedViewHeight;var absoluteViewElement;var resizeUID=0;var ignoreWindowResize=0;var date=new Date();var events=[];var _dragElement;setYMD(date,options.year,options.month,options.date);function render(inc){if(!content){initialRender()}else{calcSize();markSizesDirty();markEventsDirty();renderView(inc)}}
function initialRender(){tm=options.theme?'ui':'fc';element.addClass('fc');if(options.isRTL){element.addClass('fc-rtl')}
if(options.theme){element.addClass('ui-widget')}
content=$("<div class='fc-content' style='position:relative'/>").prependTo(element);header=new Header(t,options);headerElement=header.render();if(headerElement){element.prepend(headerElement)}
changeView(options.defaultView);$(window).resize(windowResize);if(!bodyVisible()){lateRender()}}
function lateRender(){setTimeout(function(){if(!currentView.start&&bodyVisible()){renderView()}},0)}
function destroy(){$(window).unbind('resize',windowResize);header.destroy();content.remove();element.removeClass('fc fc-rtl ui-widget')}
function elementVisible(){return _element.offsetWidth!==0}
function bodyVisible(){return $('body')[0].offsetWidth!==0}
function changeView(newViewName){if(!currentView||newViewName!=currentView.name){ignoreWindowResize++;unselect();var oldView=currentView;var newViewElement;if(oldView){(oldView.beforeHide||noop)();setMinHeight(content,content.height());oldView.element.hide()}else{setMinHeight(content,1)}
content.css('overflow','hidden');currentView=viewInstances[newViewName];if(currentView){currentView.element.show()}else{currentView=viewInstances[newViewName]=new fcViews[newViewName](newViewElement=absoluteViewElement=$("<div class='fc-view fc-view-"+newViewName+"' style='position:absolute'/>").appendTo(content),t)}if(oldView){header.deactivateButton(oldView.name)}
header.activateButton(newViewName);renderView();content.css('overflow','');if(oldView){setMinHeight(content,1)}
if(!newViewElement){(currentView.afterShow||noop)()}
ignoreWindowResize--}}
function renderView(inc){if(elementVisible()){ignoreWindowResize++;unselect();if(suggestedViewHeight===undefined){calcSize()}
var forceEventRender=false;if(!currentView.start||inc||date<currentView.start||date>=currentView.end){currentView.render(date,inc||0);setSize(true);forceEventRender=true}else if(currentView.sizeDirty){currentView.clearEvents();setSize();forceEventRender=true}else if(currentView.eventsDirty){currentView.clearEvents();forceEventRender=true}
currentView.sizeDirty=false;currentView.eventsDirty=false;updateEvents(forceEventRender);elementOuterWidth=element.outerWidth();header.updateTitle(currentView.title);var today=new Date();if(today>=currentView.start&&today<currentView.end){header.disableButton('today')}else{header.enableButton('today')}
ignoreWindowResize--;currentView.trigger('viewDisplay',_element)}}
function updateSize(){markSizesDirty();if(elementVisible()){calcSize();setSize();unselect();currentView.clearEvents();currentView.renderEvents(events);currentView.sizeDirty=false}}
function markSizesDirty(){$.each(viewInstances,function(i,inst){inst.sizeDirty=true})}
function calcSize(){if(options.contentHeight){suggestedViewHeight=options.contentHeight}else if(options.height){suggestedViewHeight=options.height-(headerElement?headerElement.height():0)-vsides(content)}else{suggestedViewHeight=Math.round(content.width()/Math.max(options.aspectRatio,.5))}}
function setSize(dateChanged){ignoreWindowResize++;currentView.setHeight(suggestedViewHeight,dateChanged);if(absoluteViewElement){absoluteViewElement.css('position','relative');absoluteViewElement=null}
currentView.setWidth(content.width(),dateChanged);ignoreWindowResize--}
function windowResize(){if(!ignoreWindowResize){if(currentView.start){var uid=++resizeUID;setTimeout(function(){if(uid==resizeUID&&!ignoreWindowResize&&elementVisible()){if(elementOuterWidth!=(elementOuterWidth=element.outerWidth())){ignoreWindowResize++;updateSize();currentView.trigger('windowResize',_element);ignoreWindowResize--}}},200)}else{lateRender()}}}
function updateEvents(forceRender){if(!options.lazyFetching||isFetchNeeded(currentView.visStart,currentView.visEnd)){refetchEvents()}else if(forceRender){rerenderEvents()}}
function refetchEvents(){fetchEvents(currentView.visStart,currentView.visEnd)}
function reportEvents(_events){events=_events;rerenderEvents()}
function reportEventChange(eventID){rerenderEvents(eventID)}
function rerenderEvents(modifiedEventID){markEventsDirty();if(elementVisible()){currentView.clearEvents();currentView.renderEvents(events,modifiedEventID);currentView.eventsDirty=false}}
function markEventsDirty(){$.each(viewInstances,function(i,inst){inst.eventsDirty=true})}
function select(start,end,allDay){currentView.select(start,end,allDay===undefined?true:allDay)}
function unselect(){if(currentView){currentView.unselect()}}
function prev(){renderView(-1)}
function next(){renderView(1)}
function prevYear(){addYears(date,-1);renderView()}
function nextYear(){addYears(date,1);renderView()}
function today(){date=new Date();renderView()}
function gotoDate(year,month,dateOfMonth){if(year instanceof Date){date=cloneDate(year)}else{setYMD(date,year,month,dateOfMonth)}
renderView()}
function incrementDate(years,months,days){if(years!==undefined){addYears(date,years)}
if(months!==undefined){addMonths(date,months)}
if(days!==undefined){addDays(date,days)}
renderView()}
function getDate(){return cloneDate(date)}
function getView(){return currentView}
function option(name,value){if(value===undefined){return options[name]}
if(name=='height'||name=='contentHeight'||name=='aspectRatio'){options[name]=value;updateSize()}}
function trigger(name,thisObj){if(options[name]){return options[name].apply(thisObj||_element,Array.prototype.slice.call(arguments,2))}}
if(options.droppable){$(document).bind('dragstart',function(ev,ui){var _e=ev.target;var e=$(_e);if(!e.parents('.fc').length){var accept=options.dropAccept;if($.isFunction(accept)?accept.call(_e,e):e.is(accept)){_dragElement=_e;currentView.dragStart(_dragElement,ev,ui)}}}).bind('dragstop',function(ev,ui){if(_dragElement){currentView.dragStop(_dragElement,ev,ui);_dragElement=null}})}}
function Header(calendar,options){var t=this;t.render=render;t.destroy=destroy;t.updateTitle=updateTitle;t.activateButton=activateButton;t.deactivateButton=deactivateButton;t.disableButton=disableButton;t.enableButton=enableButton;var element=$([]);var tm;function render(){tm=options.theme?'ui':'fc';var sections=options.header;if(sections){element=$("<table class='fc-header' style='width:100%'/>").append($("<tr/>").append(renderSection('left')).append(renderSection('center')).append(renderSection('right')));return element}}
function destroy(){element.remove()}
function renderSection(position){var e=$("<td class='fc-header-"+position+"'/>");var buttonStr=options.header[position];if(buttonStr){$.each(buttonStr.split(' '),function(i){if(i>0){e.append("<span class='fc-header-space'/>")}
var prevButton;$.each(this.split(','),function(j,buttonName){if(buttonName=='title'){e.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>");if(prevButton){prevButton.addClass(tm+'-corner-right')}
prevButton=null}else{var buttonClick;if(calendar[buttonName]){buttonClick=calendar[buttonName]}else if(fcViews[buttonName]){buttonClick=function(){button.removeClass(tm+'-state-hover');calendar.changeView(buttonName)}}
if(buttonClick){var icon=options.theme?smartProperty(options.buttonIcons,buttonName):null;var text=smartProperty(options.buttonText,buttonName);var button=$("<span class='fc-button fc-button-"+buttonName+" "+tm+"-state-default'><span class='fc-button-inner'><span class='fc-button-content'>"+(icon?"<span class='fc-icon-wrap'><span class='ui-icon ui-icon-"+icon+"'/></span>":text)+"</span><span class='fc-button-effect'><span></span></span></span></span>");if(button){button.click(function(){if(!button.hasClass(tm+'-state-disabled')){buttonClick()}}).mousedown(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-down')}).mouseup(function(){button.removeClass(tm+'-state-down')}).hover(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-hover')},function(){button.removeClass(tm+'-state-hover').removeClass(tm+'-state-down')}).appendTo(e);if(!prevButton){button.addClass(tm+'-corner-left')}
prevButton=button}}}});if(prevButton){prevButton.addClass(tm+'-corner-right')}})}
return e}
function updateTitle(html){element.find('h2').html(reSpellDate(html));}
function reSpellDate(tn_date){return tn_date.replace(/\s+/g,"").split("").reverse().join(".");}
function activateButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-active')}
function deactivateButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-active')}
function disableButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-disabled')}
function enableButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-disabled')}}
fc.sourceNormalizers=[];fc.sourceFetchers=[];var ajaxDefaults={dataType:'json',cache:false};var eventGUID=1;function EventManager(options,_sources){var t=this;t.isFetchNeeded=isFetchNeeded;t.fetchEvents=fetchEvents;t.addEventSource=addEventSource;t.removeEventSource=removeEventSource;t.updateEvent=updateEvent;t.renderEvent=renderEvent;t.removeEvents=removeEvents;t.clientEvents=clientEvents;t.normalizeEvent=normalizeEvent;var trigger=t.trigger;var getView=t.getView;var reportEvents=t.reportEvents;var stickySource={events:[]};var sources=[stickySource];var rangeStart,rangeEnd;var currentFetchID=0;var pendingSourceCnt=0;var loadingLevel=0;var cache=[];for(var i=0;i<_sources.length;i++){_addEventSource(_sources[i])}
function isFetchNeeded(start,end){return!rangeStart||start<rangeStart||end>rangeEnd}
function fetchEvents(start,end){rangeStart=start;rangeEnd=end;cache=[];var fetchID=++currentFetchID;var len=sources.length;pendingSourceCnt=len;for(var i=0;i<len;i++){fetchEventSource(sources[i],fetchID)}}
function fetchEventSource(source,fetchID){_fetchEventSource(source,function(events){if(fetchID==currentFetchID){if(events){for(var i=0;i<events.length;i++){events[i].source=source;normalizeEvent(events[i])}
cache=cache.concat(events)}
pendingSourceCnt--;if(!pendingSourceCnt){reportEvents(cache)}}})}
function _fetchEventSource(source,callback){var i;var fetchers=fc.sourceFetchers;var res;for(i=0;i<fetchers.length;i++){res=fetchers[i](source,rangeStart,rangeEnd,callback);if(res===true){return}else if(typeof res=='object'){_fetchEventSource(res,callback);return}}
var events=source.events;if(events){if($.isFunction(events)){pushLoading();events(cloneDate(rangeStart),cloneDate(rangeEnd),function(events){callback(events);popLoading()})}else if($.isArray(events)){callback(events)}else{callback()}}else{var url=source.url;if(url){var success=source.success;var error=source.error;var complete=source.complete;var data=$.extend({},source.data||{});var startParam=firstDefined(source.startParam,options.startParam);var endParam=firstDefined(source.endParam,options.endParam);if(startParam){data[startParam]=Math.round(+rangeStart/1000)}
if(endParam){data[endParam]=Math.round(+rangeEnd/1000)}
pushLoading();$.ajax($.extend({},ajaxDefaults,source,{data:data,success:function(events){events=events||[];var res=applyAll(success,this,arguments);if($.isArray(res)){events=res}
callback(events)},error:function(){applyAll(error,this,arguments);callback()},complete:function(){applyAll(complete,this,arguments);popLoading()}}))}else{callback()}}}
function addEventSource(source){source=_addEventSource(source);if(source){pendingSourceCnt++;fetchEventSource(source,currentFetchID)}}
function _addEventSource(source){if($.isFunction(source)||$.isArray(source)){source={events:source}}else if(typeof source=='string'){source={url:source}}
if(typeof source=='object'){normalizeSource(source);sources.push(source);return source}}
function removeEventSource(source){sources=$.grep(sources,function(src){return!isSourcesEqual(src,source)});cache=$.grep(cache,function(e){return!isSourcesEqual(e.source,source)});reportEvents(cache)}
function updateEvent(event){var i,len=cache.length,e,defaultEventEnd=getView().defaultEventEnd,startDelta=event.start-event._start,endDelta=event.end?(event.end-(event._end||defaultEventEnd(event))):0;for(i=0;i<len;i++){e=cache[i];if(e._id==event._id&&e!=event){e.start=new Date(+e.start+startDelta);if(event.end){if(e.end){e.end=new Date(+e.end+endDelta)}else{e.end=new Date(+defaultEventEnd(e)+endDelta)}}else{e.end=null}
e.title=event.title;e.url=event.url;e.allDay=event.allDay;e.className=event.className;e.editable=event.editable;e.color=event.color;e.backgroudColor=event.backgroudColor;e.borderColor=event.borderColor;e.textColor=event.textColor;normalizeEvent(e)}}
normalizeEvent(event);reportEvents(cache)}
function renderEvent(event,stick){normalizeEvent(event);if(!event.source){if(stick){stickySource.events.push(event);event.source=stickySource}
cache.push(event)}
reportEvents(cache)}
function removeEvents(filter){if(!filter){cache=[];for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=[]}}}else{if(!$.isFunction(filter)){var id=filter+'';filter=function(e){return e._id==id}}
cache=$.grep(cache,filter,true);for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=$.grep(sources[i].events,filter,true)}}}
reportEvents(cache)}
function clientEvents(filter){if($.isFunction(filter)){return $.grep(cache,filter)}else if(filter){filter+='';return $.grep(cache,function(e){return e._id==filter})}
return cache}
function pushLoading(){if(!loadingLevel++){trigger('loading',null,true)}}
function popLoading(){if(!--loadingLevel){trigger('loading',null,false)}}
function normalizeEvent(event){var source=event.source||{};var ignoreTimezone=firstDefined(source.ignoreTimezone,options.ignoreTimezone);event._id=event._id||(event.id===undefined?'_fc'+eventGUID++:event.id+'');if(event.date){if(!event.start){event.start=event.date}
delete event.date}
event._start=cloneDate(event.start=parseDate(event.start,ignoreTimezone));event.end=parseDate(event.end,ignoreTimezone);if(event.end&&event.end<=event.start){event.end=null}
event._end=event.end?cloneDate(event.end):null;if(event.allDay===undefined){event.allDay=firstDefined(source.allDayDefault,options.allDayDefault)}
if(event.className){if(typeof event.className=='string'){event.className=event.className.split(/\s+/)}}else{event.className=[]}}
function normalizeSource(source){if(source.className){if(typeof source.className=='string'){source.className=source.className.split(/\s+/)}}else{source.className=[]}
var normalizers=fc.sourceNormalizers;for(var i=0;i<normalizers.length;i++){normalizers[i](source)}}
function isSourcesEqual(source1,source2){return source1&&source2&&getSourcePrimitive(source1)==getSourcePrimitive(source2)}
function getSourcePrimitive(source){return((typeof source=='object')?(source.events||source.url):'')||source}}
fc.addDays=addDays;fc.cloneDate=cloneDate;fc.parseDate=parseDate;fc.parseISO8601=parseISO8601;fc.parseTime=parseTime;fc.formatDate=formatDate;fc.formatDates=formatDates;var dayIDs=['sun','mon','tue','wed','thu','fri','sat'],DAY_MS=86400000,HOUR_MS=3600000,MINUTE_MS=60000;function addYears(d,n,keepTime){d.setFullYear(d.getFullYear()+n);if(!keepTime){clearTime(d)}
return d}
function addMonths(d,n,keepTime){if(+d){var m=d.getMonth()+n,check=cloneDate(d);check.setDate(1);check.setMonth(m);d.setMonth(m);if(!keepTime){clearTime(d)}
while(d.getMonth()!=check.getMonth()){d.setDate(d.getDate()+(d<check?1:-1))}}
return d}
function addDays(d,n,keepTime){if(+d){var dd=d.getDate()+n,check=cloneDate(d);check.setHours(9);check.setDate(dd);d.setDate(dd);if(!keepTime){clearTime(d)}
fixDate(d,check)}
return d}
function fixDate(d,check){if(+d){while(d.getDate()!=check.getDate()){d.setTime(+d+(d<check?1:-1)*HOUR_MS)}}}
function addMinutes(d,n){d.setMinutes(d.getMinutes()+n);return d}
function clearTime(d){d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);return d}
function cloneDate(d,dontKeepTime){if(dontKeepTime){return clearTime(new Date(+d))}
return new Date(+d)}
function zeroDate(){var i=0,d;do{d=new Date(1970,i++,1)}while(d.getHours());return d}
function skipWeekend(date,inc,excl){inc=inc||1;while(!date.getDay()||(excl&&date.getDay()==1||!excl&&date.getDay()==6)){addDays(date,inc)}
return date}
function dayDiff(d1,d2){return Math.round((cloneDate(d1,true)-cloneDate(d2,true))/DAY_MS)}
function setYMD(date,y,m,d){if(y!==undefined&&y!=date.getFullYear()){date.setDate(1);date.setMonth(0);date.setFullYear(y)}
if(m!==undefined&&m!=date.getMonth()){date.setDate(1);date.setMonth(m)}
if(d!==undefined){date.setDate(d)}}
function parseDate(s,ignoreTimezone){if(typeof s=='object'){return s}
if(typeof s=='number'){return new Date(s*1000)}
if(typeof s=='string'){if(s.match(/^\d+(\.\d+)?$/)){return new Date(parseFloat(s)*1000)}
if(ignoreTimezone===undefined){ignoreTimezone=true}
return parseISO8601(s,ignoreTimezone)||(s?new Date(s):null)}
return null}
function parseISO8601(s,ignoreTimezone){var m=s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!m){return null}
var date=new Date(m[1],0,1);if(ignoreTimezone||!m[13]){var check=new Date(m[1],0,1,9,0);if(m[3]){date.setMonth(m[3]-1);check.setMonth(m[3]-1)}
if(m[5]){date.setDate(m[5]);check.setDate(m[5])}
fixDate(date,check);if(m[7]){date.setHours(m[7])}
if(m[8]){date.setMinutes(m[8])}
if(m[10]){date.setSeconds(m[10])}
if(m[12]){date.setMilliseconds(Number("0."+m[12])*1000)}
fixDate(date,check)}else{date.setUTCFullYear(m[1],m[3]?m[3]-1:0,m[5]||1);date.setUTCHours(m[7]||0,m[8]||0,m[10]||0,m[12]?Number("0."+m[12])*1000:0);if(m[14]){var offset=Number(m[16])*60+(m[18]?Number(m[18]):0);offset*=m[15]=='-'?1:-1;date=new Date(+date+(offset*60*1000))}}
return date}
function parseTime(s){if(typeof s=='number'){return s*60}
if(typeof s=='object'){return s.getHours()*60+s.getMinutes()}
var m=s.match(/(\d+)(?::(\d+))?\s*(\w+)?/);if(m){var h=parseInt(m[1],10);if(m[3]){h%=12;if(m[3].toLowerCase().charAt(0)=='p'){h+=12}}
return h*60+(m[2]?parseInt(m[2],10):0)}}
function formatDate(date,format,options){return formatDates(date,null,format,options)}
function formatDates(date1,date2,format,options){options=options||defaults;var date=date1,otherDate=date2,i,len=format.length,c,i2,formatter,res='';for(i=0;i<len;i++){c=format.charAt(i);if(c=="'"){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)=="'"){if(date){if(i2==i+1){res+="'"}else{res+=format.substring(i+1,i2)}
i=i2}
break}}}else if(c=='('){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==')'){var subres=formatDate(date,format.substring(i+1,i2),options);if(parseInt(subres.replace(/\D/,''),10)){res+=subres}
i=i2;break}}}else if(c=='['){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==']'){var subformat=format.substring(i+1,i2);var subres=formatDate(date,subformat,options);if(subres!=formatDate(otherDate,subformat,options)){res+=subres}
i=i2;break}}}else if(c=='{'){date=date2;otherDate=date1}else if(c=='}'){date=date1;otherDate=date2}else{for(i2=len;i2>i;i2--){if(formatter=dateFormatters[format.substring(i,i2)]){if(date){res+=formatter(date,options)}
i=i2-1;break}}
if(i2==i){if(date){res+=c}}}}
return res};var dateFormatters={s:function(d){return d.getSeconds()},ss:function(d){return zeroPad(d.getSeconds())},m:function(d){return d.getMinutes()},mm:function(d){return zeroPad(d.getMinutes())},h:function(d){return d.getHours()%12||12},hh:function(d){return zeroPad(d.getHours()%12||12)},H:function(d){return d.getHours()},HH:function(d){return zeroPad(d.getHours())},d:function(d){return d.getDate()},dd:function(d){return zeroPad(d.getDate())},ddd:function(d,o){return o.dayNamesShort[d.getDay()]},dddd:function(d,o){return o.dayNames[d.getDay()]},M:function(d){return d.getMonth()+1},MM:function(d){return zeroPad(d.getMonth()+1)},MMM:function(d,o){return o.monthNamesShort[d.getMonth()]},MMMM:function(d,o){return o.monthNames[d.getMonth()]},yy:function(d){return(d.getFullYear()+'').substring(2)},yyyy:function(d){return d.getFullYear()},t:function(d){return d.getHours()<12?'a':'p'},tt:function(d){return d.getHours()<12?'am':'pm'},T:function(d){return d.getHours()<12?'A':'P'},TT:function(d){return d.getHours()<12?'AM':'PM'},u:function(d){return formatDate(d,"yyyy-MM-dd'T'HH:mm:ss'Z'")},S:function(d){var date=d.getDate();if(date>10&&date<20){return'th'}
return['st','nd','rd'][date%10-1]||'th'}};fc.applyAll=applyAll;function exclEndDay(event){if(event.end){return _exclEndDay(event.end,event.allDay)}else{return addDays(cloneDate(event.start),1)}}
function _exclEndDay(end,allDay){end=cloneDate(end);return allDay||end.getHours()||end.getMinutes()?addDays(end,1):clearTime(end)}
function segCmp(a,b){return(b.msLength-a.msLength)*100+(a.event.start-b.event.start)}
function segsCollide(seg1,seg2){return seg1.end>seg2.start&&seg1.start<seg2.end}
function sliceSegs(events,visEventEnds,start,end){var segs=[],i,len=events.length,event,eventStart,eventEnd,segStart,segEnd,isStart,isEnd;for(i=0;i<len;i++){event=events[i];eventStart=event.start;eventEnd=visEventEnds[i];if(eventEnd>start&&eventStart<end){if(eventStart<start){segStart=cloneDate(start);isStart=false}else{segStart=eventStart;isStart=true}if(eventEnd>end){segEnd=cloneDate(end);isEnd=false}else{segEnd=eventEnd;isEnd=true}
segs.push({event:event,start:segStart,end:segEnd,isStart:isStart,isEnd:isEnd,msLength:segEnd-segStart})}}
return segs.sort(segCmp)}
function stackSegs(segs){var levels=[],i,len=segs.length,seg,j,collide,k;for(i=0;i<len;i++){seg=segs[i];j=0;while(true){collide=false;if(levels[j]){for(k=0;k<levels[j].length;k++){if(segsCollide(levels[j][k],seg)){collide=true;break}}}
if(collide){j++}else{break}}
if(levels[j]){levels[j].push(seg)}else{levels[j]=[seg]}}
return levels}
function lazySegBind(container,segs,bindHandlers){container.unbind('mouseover').mouseover(function(ev){var parent=ev.target,e,i,seg;while(parent!=this){e=parent;parent=parent.parentNode}
if((i=e._fci)!==undefined){e._fci=undefined;seg=segs[i];bindHandlers(seg.event,seg.element,seg);$(ev.target).trigger(ev)}
ev.stopPropagation()})}
function setOuterWidth(element,width,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.width(Math.max(0,width-hsides(e,includeMargins)))}}
function setOuterHeight(element,height,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.height(Math.max(0,height-vsides(e,includeMargins)))}}
function hsides(element,includeMargins){return hpadding(element)+hborders(element)+(includeMargins?hmargins(element):0)}
function hpadding(element){return(parseFloat($.curCSS(element[0],'paddingLeft',true))||0)+(parseFloat($.curCSS(element[0],'paddingRight',true))||0)}
function hmargins(element){return(parseFloat($.curCSS(element[0],'marginLeft',true))||0)+(parseFloat($.curCSS(element[0],'marginRight',true))||0)}
function hborders(element){return(parseFloat($.curCSS(element[0],'borderLeftWidth',true))||0)+(parseFloat($.curCSS(element[0],'borderRightWidth',true))||0)}
function vsides(element,includeMargins){return vpadding(element)+vborders(element)+(includeMargins?vmargins(element):0)}
function vpadding(element){return(parseFloat($.curCSS(element[0],'paddingTop',true))||0)+(parseFloat($.curCSS(element[0],'paddingBottom',true))||0)}
function vmargins(element){return(parseFloat($.curCSS(element[0],'marginTop',true))||0)+(parseFloat($.curCSS(element[0],'marginBottom',true))||0)}
function vborders(element){return(parseFloat($.curCSS(element[0],'borderTopWidth',true))||0)+(parseFloat($.curCSS(element[0],'borderBottomWidth',true))||0)}
function setMinHeight(element,height){height=(typeof height=='number'?height+'px':height);element.each(function(i,_element){})}
function noop(){}
function cmp(a,b){return a-b}
function arrayMax(a){return Math.max.apply(Math,a)}
function zeroPad(n){return(n<10?'0':'')+n}
function smartProperty(obj,name){if(obj[name]!==undefined){return obj[name]}
var parts=name.split(/(?=[A-Z])/),i=parts.length-1,res;for(;i>=0;i--){res=obj[parts[i].toLowerCase()];if(res!==undefined){return res}}
return obj['']}
function htmlEscape(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#039;').replace(/"/g,'&quot;').replace(/\n/g,'<br />')}
function cssKey(_element){return _element.id+'/'+_element.className+'/'+_element.style.cssText.replace(/(^|;)\s*(top|left|width|height)\s*:[^;]*/ig,'')}
function disableTextSelection(element){element.attr('unselectable','on').css('MozUserSelect','none').bind('selectstart.ui',function(){return false})}
function markFirstLast(e){e.children().removeClass('fc-first fc-last').filter(':first-child').addClass('fc-first').end().filter(':last-child').addClass('fc-last')}
function setDayID(cell,date){cell.each(function(i,_cell){_cell.className=_cell.className.replace(/^fc-\w*/,'fc-'+dayIDs[date.getDay()])})}
function getSkinCss(event,opt){var source=event.source||{};var eventColor=event.color;var sourceColor=source.color;var optionColor=opt('eventColor');var backgroundColor=event.backgroundColor||eventColor||source.backgroundColor||sourceColor||opt('eventBackgroundColor')||optionColor;var borderColor=event.borderColor||eventColor||source.borderColor||sourceColor||opt('eventBorderColor')||optionColor;var textColor=event.textColor||source.textColor||opt('eventTextColor');var statements=[];if(backgroundColor){statements.push('background-color:'+backgroundColor)}
if(borderColor){statements.push('border-color:'+borderColor)}
if(textColor){statements.push('color:'+textColor)}
return statements.join(';')}
function applyAll(functions,thisObj,args){if($.isFunction(functions)){functions=[functions]}
if(functions){var i;var ret;for(i=0;i<functions.length;i++){ret=functions[i].apply(thisObj,args)||ret}
return ret}}
function firstDefined(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i]}}}
fcViews.month=MonthView;function MonthView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'month');var opt=t.opt;var renderBasic=t.renderBasic;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addMonths(date,delta);date.setDate(1)}
var start=cloneDate(date,true);start.setDate(1);var end=addMonths(cloneDate(start),1);var visStart=cloneDate(start);var visEnd=cloneDate(end);var firstDay=opt('firstDay');var nwe=opt('weekends')?0:1;if(nwe){skipWeekend(visStart);skipWeekend(visEnd,-1,true)}
addDays(visStart,-((visStart.getDay()-Math.max(firstDay,nwe)+7)%7));addDays(visEnd,(7-visEnd.getDay()+Math.max(firstDay,nwe))%7);var rowCnt=Math.round((visEnd-visStart)/(DAY_MS*7));if(opt('weekMode')=='fixed'){addDays(visEnd,(6-rowCnt)*7);rowCnt=6}
t.title=formatDate(start,opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(6,rowCnt,nwe?5:7,true)}}
fcViews.basicWeek=BasicWeekView;function BasicWeekView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicWeek');var opt=t.opt;var renderBasic=t.renderBasic;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7)}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);var visEnd=cloneDate(end);var weekends=opt('weekends');if(!weekends){skipWeekend(visStart);skipWeekend(visEnd,-1,true)}
t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(1,1,weekends?7:5,false)}}
fcViews.basicDay=BasicDayView;function BasicDayView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicDay');var opt=t.opt;var renderBasic=t.renderBasic;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);if(!opt('weekends')){skipWeekend(date,delta<0?-1:1)}}
t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=cloneDate(date,true);t.end=t.visEnd=addDays(cloneDate(t.start),1);renderBasic(1,1,1,false)}}
setDefaults({weekMode:'fixed'});function BasicView(element,calendar,viewName){var t=this;t.renderBasic=renderBasic;t.setHeight=setHeight;t.setWidth=setWidth;t.renderDayOverlay=renderDayOverlay;t.defaultSelectionEnd=defaultSelectionEnd;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;t.defaultEventEnd=defaultEventEnd;t.getHoverListener=function(){return hoverListener};t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.dayOfWeekCol=dayOfWeekCol;t.dateCell=dateCell;t.cellDate=cellDate;t.cellIsAllDay=function(){return true};t.allDayRow=allDayRow;t.allDayBounds=allDayBounds;t.getRowCnt=function(){return rowCnt};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getDaySegmentContainer=function(){return daySegmentContainer};View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);BasicEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var clearEvents=t.clearEvents;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var daySelectionMousedown=t.daySelectionMousedown;var formatDate=calendar.formatDate;var head;var headCells;var body;var bodyRows;var bodyCells;var bodyFirstCells;var bodyCellTopInners;var daySegmentContainer;var viewWidth;var viewHeight;var colWidth;var rowCnt,colCnt;var coordinateGrid;var hoverListener;var colContentPositions;var rtl,dis,dit;var firstDay;var nwe;var tm;var colFormat;disableTextSelection(element.addClass('fc-grid'));function renderBasic(maxr,r,c,showNumbers){rowCnt=r;colCnt=c;updateOptions();var firstTime=!body;if(firstTime){buildSkeleton(maxr,showNumbers)}else{clearEvents()}
updateCells(firstTime)}
function updateOptions(){rtl=opt('isRTL');if(rtl){dis=-1;dit=colCnt-1}else{dis=1;dit=0}
firstDay=opt('firstDay');nwe=opt('weekends')?0:1;tm=opt('theme')?'ui':'fc';colFormat=opt('columnFormat')}
function buildSkeleton(maxRowCnt,showNumbers){var s;var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var i,j;var table;s="<table class='fc-border-separate' style='width:100%' cellspacing='0'><thead><tr>";for(i=0;i<colCnt;i++){s+="<th class='fc- "+headerClass+"'/>"}
s+="</tr></thead><tbody>";for(i=0;i<maxRowCnt;i++){s+="<tr class='fc-week"+i+"'>";for(j=0;j<colCnt;j++){s+="<td class='fc- "+contentClass+" fc-day"+(i*colCnt+j)+"'><div>"+(showNumbers?"<div class='fc-day-number'/>":'')+"<div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>"}
s+="</tr>"}
s+="</tbody></table>";table=$(s).appendTo(element);head=table.find('thead');headCells=head.find('th');body=table.find('tbody');bodyRows=body.find('tr');bodyCells=body.find('td');bodyFirstCells=bodyCells.filter(':first-child');bodyCellTopInners=bodyRows.eq(0).find('div.fc-day-content div');markFirstLast(head.add(head.find('tr')));markFirstLast(bodyRows);bodyRows.eq(0).addClass('fc-first');dayBind(bodyCells);daySegmentContainer=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(element)}
function updateCells(firstTime){var dowDirty=firstTime||rowCnt==1;var month=t.start.getMonth();var today=clearTime(new Date());var cell;var date;var row;if(dowDirty){headCells.each(function(i,_cell){cell=$(_cell);date=indexDate(i);cell.html(formatDate(date,colFormat));setDayID(cell,date)})}
bodyCells.each(function(i,_cell){cell=$(_cell);date=indexDate(i);if(date.getMonth()==month){cell.removeClass('fc-other-month')}else{cell.addClass('fc-other-month')}if(+date==+today){cell.addClass(tm+'-state-highlight fc-today')}else{cell.removeClass(tm+'-state-highlight fc-today')}
cell.find('div.fc-day-number').text(date.getDate());if(dowDirty){setDayID(cell,date)}});bodyRows.each(function(i,_row){row=$(_row);if(i<rowCnt){row.show();if(i==rowCnt-1){row.addClass('fc-last')}else{row.removeClass('fc-last')}}else{row.hide()}})}
function setHeight(height){viewHeight=height;var bodyHeight=viewHeight-head.height();var rowHeight;var rowHeightLast;var cell;if(opt('weekMode')=='variable'){rowHeight=rowHeightLast=Math.floor(bodyHeight/(rowCnt==1?2:6))}else{rowHeight=Math.floor(bodyHeight/rowCnt);rowHeightLast=bodyHeight-rowHeight*(rowCnt-1)}
bodyFirstCells.each(function(i,_cell){if(i<rowCnt){cell=$(_cell);setMinHeight(cell.find('> div'),(i==rowCnt-1?rowHeightLast:rowHeight)-vsides(cell))}})}
function setWidth(width){viewWidth=width;colContentPositions.clear();colWidth=Math.floor(viewWidth/colCnt);setOuterWidth(headCells.slice(0,-1),colWidth)}
function dayBind(days){days.click(dayClick).mousedown(daySelectionMousedown)}
function dayClick(ev){if(!opt('selectable')){var index=parseInt(this.className.match(/fc\-day(\d+)/)[1]);var date=indexDate(index);trigger('dayClick',this,date,true,ev)}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build()}
var rowStart=cloneDate(t.visStart);var rowEnd=addDays(cloneDate(rowStart),colCnt);for(var i=0;i<rowCnt;i++){var stretchStart=new Date(Math.max(rowStart,overlayStart));var stretchEnd=new Date(Math.min(rowEnd,overlayEnd));if(stretchStart<stretchEnd){var colStart,colEnd;if(rtl){colStart=dayDiff(stretchEnd,rowStart)*dis+dit+1;colEnd=dayDiff(stretchStart,rowStart)*dis+dit+1}else{colStart=dayDiff(stretchStart,rowStart);colEnd=dayDiff(stretchEnd,rowStart)}
dayBind(renderCellOverlay(i,colStart,i,colEnd-1))}
addDays(rowStart,7);addDays(rowEnd,7)}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,element);return renderOverlay(rect,element)}
function defaultSelectionEnd(startDate,allDay){return cloneDate(startDate)}
function renderSelection(startDate,endDate,allDay){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true)}
function clearSelection(){clearOverlays()}
function reportDayClick(date,allDay,ev){var cell=dateCell(date);var _element=bodyCells[cell.row*colCnt+cell.col];trigger('dayClick',_element,date,allDay,ev)}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){renderCellOverlay(cell.row,cell.col,cell.row,cell.col)}},ev)}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){var d=cellDate(cell);trigger('drop',_dragElement,d,true,ev,ui)}}
function defaultEventEnd(event){return cloneDate(event.start)}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;headCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n}
p=[n];cols[i]=p});p[1]=n+e.outerWidth();bodyRows.each(function(i,_e){if(i<rowCnt){e=$(_e);n=e.offset().top;if(i){p[1]=n}
p=[n];rows[i]=p}});p[1]=n+e.outerHeight()});hoverListener=new HoverListener(coordinateGrid);colContentPositions=new HorizontalPositionCache(function(col){return bodyCellTopInners.eq(col)});function colContentLeft(col){return colContentPositions.left(col)}
function colContentRight(col){return colContentPositions.right(col)}
function dateCell(date){return{row:Math.floor(dayDiff(date,t.visStart)/7),col:dayOfWeekCol(date.getDay())}}
function cellDate(cell){return _cellDate(cell.row,cell.col)}
function _cellDate(row,col){return addDays(cloneDate(t.visStart),row*7+col*dis+dit)}
function indexDate(index){return _cellDate(Math.floor(index/colCnt),index%colCnt)}
function dayOfWeekCol(dayOfWeek){return((dayOfWeek-Math.max(firstDay,nwe)+colCnt)%colCnt)*dis+dit}
function allDayRow(i){return bodyRows.eq(i)}
function allDayBounds(i){return{left:0,right:viewWidth}}}
function BasicEventRenderer(){var t=this;t.renderEvents=renderEvents;t.compileDaySegs=compileSegs;t.clearEvents=clearEvents;t.bindDaySeg=bindDaySeg;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var reportEvents=t.reportEvents;var reportEventClear=t.reportEventClear;var eventElementHandlers=t.eventElementHandlers;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var getDaySegmentContainer=t.getDaySegmentContainer;var getHoverListener=t.getHoverListener;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var renderDaySegs=t.renderDaySegs;var resizableDayEvent=t.resizableDayEvent;function renderEvents(events,modifiedEventId){reportEvents(events);renderDaySegs(compileSegs(events),modifiedEventId)}
function clearEvents(){reportEventClear();getDaySegmentContainer().empty()}
function compileSegs(events){var rowCnt=getRowCnt(),colCnt=getColCnt(),d1=cloneDate(t.visStart),d2=addDays(cloneDate(d1),colCnt),visEventsEnds=$.map(events,exclEndDay),i,row,j,level,k,seg,segs=[];for(i=0;i<rowCnt;i++){row=stackSegs(sliceSegs(events,visEventsEnds,d1,d2));for(j=0;j<row.length;j++){level=row[j];for(k=0;k<level.length;k++){seg=level[k];seg.row=i;seg.level=j;segs.push(seg)}}
addDays(d1,7);addDays(d2,7)}
return segs}
function bindDaySeg(event,eventElement,seg){if(isEventDraggable(event)){draggableDayEvent(event,eventElement)}
if(seg.isEnd&&isEventResizable(event)){resizableDayEvent(event,eventElement,seg)}
eventElementHandlers(event,eventElement)}
function draggableDayEvent(event,eventElement){var hoverListener=getHoverListener();var dayDelta;eventElement.draggable({zIndex:9,delay:50,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable('option','revert',!cell||!rowDelta&&!colDelta);clearOverlays();if(cell){dayDelta=rowDelta*7+colDelta*(opt('isRTL')?-1:1);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta))}else{dayDelta=0}},ev,'drag')},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(dayDelta){eventDrop(this,event,dayDelta,0,event.allDay,ev,ui)}else{eventElement.css('filter','');showEvents(event,eventElement)}}})}}
fcViews.agendaWeek=AgendaWeekView;function AgendaWeekView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaWeek');var opt=t.opt;var renderAgenda=t.renderAgenda;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7)}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);var visEnd=cloneDate(end);var weekends=opt('weekends');if(!weekends){skipWeekend(visStart);skipWeekend(visEnd,-1,true)}
t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderAgenda(weekends?7:5)}}
fcViews.agendaDay=AgendaDayView;function AgendaDayView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaDay');var opt=t.opt;var renderAgenda=t.renderAgenda;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);if(!opt('weekends')){skipWeekend(date,delta<0?-1:1)}}
var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderAgenda(1)}}
setDefaults({allDaySlot:true,allDayText:'all-day',firstHour:6,slotMinutes:30,defaultEventMinutes:120,axisFormat:'h(:mm)tt',timeFormat:{agenda:'h:mm{ - h:mm}'},dragOpacity:{agenda:.5},minTime:0,maxTime:24});function AgendaView(element,calendar,viewName){var t=this;t.renderAgenda=renderAgenda;t.setWidth=setWidth;t.setHeight=setHeight;t.beforeHide=beforeHide;t.afterShow=afterShow;t.defaultEventEnd=defaultEventEnd;t.timePosition=timePosition;t.dayOfWeekCol=dayOfWeekCol;t.dateCell=dateCell;t.cellDate=cellDate;t.cellIsAllDay=cellIsAllDay;t.allDayRow=getAllDayRow;t.allDayBounds=allDayBounds;t.getHoverListener=function(){return hoverListener};t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getDaySegmentContainer=function(){return daySegmentContainer};t.getSlotSegmentContainer=function(){return slotSegmentContainer};t.getMinMinute=function(){return minMinute};t.getMaxMinute=function(){return maxMinute};t.getBodyContent=function(){return slotContent};t.getRowCnt=function(){return 1};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getSlotHeight=function(){return slotHeight};t.defaultSelectionEnd=defaultSelectionEnd;t.renderDayOverlay=renderDayOverlay;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);AgendaEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var clearEvents=t.clearEvents;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var reportSelection=t.reportSelection;var unselect=t.unselect;var daySelectionMousedown=t.daySelectionMousedown;var slotSegHtml=t.slotSegHtml;var formatDate=calendar.formatDate;var dayTable;var dayHead;var dayHeadCells;var dayBody;var dayBodyCells;var dayBodyCellInners;var dayBodyFirstCell;var dayBodyFirstCellStretcher;var slotLayer;var daySegmentContainer;var allDayTable;var allDayRow;var slotScroller;var slotContent;var slotSegmentContainer;var slotTable;var slotTableFirstInner;var axisFirstCells;var gutterCells;var selectionHelper;var viewWidth;var viewHeight;var axisWidth;var colWidth;var gutterWidth;var slotHeight;var savedScrollTop;var colCnt;var slotCnt;var coordinateGrid;var hoverListener;var colContentPositions;var slotTopCache={};var tm;var firstDay;var nwe;var rtl,dis,dit;var minMinute,maxMinute;var colFormat;disableTextSelection(element.addClass('fc-agenda'));function renderAgenda(c){colCnt=c;updateOptions();if(!dayTable){buildSkeleton()}else{clearEvents()}
updateCells()}
function updateOptions(){tm=opt('theme')?'ui':'fc';nwe=opt('weekends')?0:1;firstDay=opt('firstDay');if(rtl=opt('isRTL')){dis=-1;dit=colCnt-1}else{dis=1;dit=0}
minMinute=parseTime(opt('minTime'));maxMinute=parseTime(opt('maxTime'));colFormat=opt('columnFormat')}
function buildSkeleton(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var s;var i;var d;var maxd;var minutes;var slotNormal=opt('slotMinutes')%15==0;s="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'><thead><tr><th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";for(i=0;i<colCnt;i++){s+="<th class='fc- fc-col"+i+' '+headerClass+"'/>"}
s+="<th class='fc-agenda-gutter "+headerClass+"'>&nbsp;</th></tr></thead><tbody><tr><th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";for(i=0;i<colCnt;i++){s+="<td class='fc- fc-col"+i+' '+contentClass+"'><div><div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>"}
s+="<td class='fc-agenda-gutter "+contentClass+"'>&nbsp;</td></tr></tbody></table>";dayTable=$(s).appendTo(element);dayHead=dayTable.find('thead');dayHeadCells=dayHead.find('th').slice(1,-1);dayBody=dayTable.find('tbody');dayBodyCells=dayBody.find('td').slice(0,-1);dayBodyCellInners=dayBodyCells.find('div.fc-day-content div');dayBodyFirstCell=dayBodyCells.eq(0);dayBodyFirstCellStretcher=dayBodyFirstCell.find('> div');markFirstLast(dayHead.add(dayHead.find('tr')));markFirstLast(dayBody.add(dayBody.find('tr')));axisFirstCells=dayHead.find('th:first');gutterCells=dayTable.find('.fc-agenda-gutter');slotLayer=$("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(element);if(opt('allDaySlot')){daySegmentContainer=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotLayer);s="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'><tr><th class='"+headerClass+" fc-agenda-axis'>"+opt('allDayText')+"</th><td><div class='fc-day-content'><div style='position:relative'/></div></td><th class='"+headerClass+" fc-agenda-gutter'>&nbsp;</th></tr></table>";allDayTable=$(s).appendTo(slotLayer);allDayRow=allDayTable.find('tr');dayBind(allDayRow.find('td'));axisFirstCells=axisFirstCells.add(allDayTable.find('th:first'));gutterCells=gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));slotLayer.append("<div class='fc-agenda-divider "+headerClass+"'><div class='fc-agenda-divider-inner'/></div>")}else{daySegmentContainer=$([])}
slotScroller=$("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(slotLayer);slotContent=$("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(slotScroller);slotSegmentContainer=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotContent);s="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'><tbody>";d=zeroDate();maxd=addMinutes(cloneDate(d),maxMinute);addMinutes(d,minMinute);slotCnt=0;for(i=0;d<maxd;i++){minutes=d.getMinutes();s+="<tr class='fc-slot"+i+' '+(!minutes?'':'fc-minor')+"'><th class='fc-agenda-axis "+headerClass+"'>"+((!slotNormal||!minutes)?formatDate(d,opt('axisFormat')):'&nbsp;')+"</th><td class='"+contentClass+"'><div style='position:relative'>&nbsp;</div></td></tr>";addMinutes(d,opt('slotMinutes'));slotCnt++}
s+="</tbody></table>";slotTable=$(s).appendTo(slotContent);slotTableFirstInner=slotTable.find('div:first');slotBind(slotTable.find('td'));axisFirstCells=axisFirstCells.add(slotTable.find('th:first'))}
function updateCells(){var i;var headCell;var bodyCell;var date;var today=clearTime(new Date());for(i=0;i<colCnt;i++){date=colDate(i);headCell=dayHeadCells.eq(i);headCell.html(formatDate(date,colFormat));bodyCell=dayBodyCells.eq(i);if(+date==+today){bodyCell.addClass(tm+'-state-highlight fc-today')}else{bodyCell.removeClass(tm+'-state-highlight fc-today')}
setDayID(headCell.add(bodyCell),date)}}
function setHeight(height,dateChanged){if(height===undefined){height=viewHeight}
viewHeight=height;slotTopCache={};var headHeight=dayBody.position().top;var allDayHeight=slotScroller.position().top;var bodyHeight=Math.min(height-headHeight,slotTable.height()+allDayHeight+1);dayBodyFirstCellStretcher.height(bodyHeight-vsides(dayBodyFirstCell));slotLayer.css('top',headHeight);slotScroller.height(bodyHeight-allDayHeight-1);slotHeight=slotTableFirstInner.height()+1;if(dateChanged){resetScroll()}}
function setWidth(width){viewWidth=width;colContentPositions.clear();axisWidth=0;setOuterWidth(axisFirstCells.width('').each(function(i,_cell){axisWidth=Math.max(axisWidth,$(_cell).outerWidth())}),axisWidth);var slotTableWidth=slotScroller[0].clientWidth;gutterWidth=slotScroller.width()-slotTableWidth;if(gutterWidth){setOuterWidth(gutterCells,gutterWidth);gutterCells.show().prev().removeClass('fc-last')}else{gutterCells.hide().prev().addClass('fc-last')}
colWidth=Math.floor((slotTableWidth-axisWidth)/colCnt);setOuterWidth(dayHeadCells.slice(0,-1),colWidth)}
function resetScroll(){var d0=zeroDate();var scrollDate=cloneDate(d0);scrollDate.setHours(opt('firstHour'));var top=timePosition(d0,scrollDate)+1;function scroll(){slotScroller.scrollTop(top)}
scroll();setTimeout(scroll,0)}
function beforeHide(){savedScrollTop=slotScroller.scrollTop()}
function afterShow(){slotScroller.scrollTop(savedScrollTop)}
function dayBind(cells){cells.click(slotClick).mousedown(daySelectionMousedown)}
function slotBind(cells){cells.click(slotClick).mousedown(slotSelectionMousedown)}
function slotClick(ev){if(!opt('selectable')){var col=Math.min(colCnt-1,Math.floor((ev.pageX-dayTable.offset().left-axisWidth)/colWidth));var date=colDate(col);var rowMatch=this.parentNode.className.match(/fc-slot(\d+)/);if(rowMatch){var mins=parseInt(rowMatch[1])*opt('slotMinutes');var hours=Math.floor(mins/60);date.setHours(hours);date.setMinutes(mins%60+minMinute);trigger('dayClick',dayBodyCells[col],date,false,ev)}else{trigger('dayClick',dayBodyCells[col],date,true,ev)}}}
function renderDayOverlay(startDate,endDate,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build()}
var visStart=cloneDate(t.visStart);var startCol,endCol;if(rtl){startCol=dayDiff(endDate,visStart)*dis+dit+1;endCol=dayDiff(startDate,visStart)*dis+dit+1}else{startCol=dayDiff(startDate,visStart);endCol=dayDiff(endDate,visStart)}
startCol=Math.max(0,startCol);endCol=Math.min(colCnt,endCol);if(startCol<endCol){dayBind(renderCellOverlay(0,startCol,0,endCol-1))}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,slotLayer);return renderOverlay(rect,slotLayer)}
function renderSlotOverlay(overlayStart,overlayEnd){var dayStart=cloneDate(t.visStart);var dayEnd=addDays(cloneDate(dayStart),1);for(var i=0;i<colCnt;i++){var stretchStart=new Date(Math.max(dayStart,overlayStart));var stretchEnd=new Date(Math.min(dayEnd,overlayEnd));if(stretchStart<stretchEnd){var col=i*dis+dit;var rect=coordinateGrid.rect(0,col,0,col,slotContent);var top=timePosition(dayStart,stretchStart);var bottom=timePosition(dayStart,stretchEnd);rect.top=top;rect.height=bottom-top;slotBind(renderOverlay(rect,slotContent))}
addDays(dayStart,1);addDays(dayEnd,1)}}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;dayHeadCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n}
p=[n];cols[i]=p});p[1]=n+e.outerWidth();if(opt('allDaySlot')){e=allDayRow;n=e.offset().top;rows[0]=[n,n+e.outerHeight()]}
var slotTableTop=slotContent.offset().top;var slotScrollerTop=slotScroller.offset().top;var slotScrollerBottom=slotScrollerTop+slotScroller.outerHeight();function constrain(n){return Math.max(slotScrollerTop,Math.min(slotScrollerBottom,n))}
for(var i=0;i<slotCnt;i++){rows.push([constrain(slotTableTop+slotHeight*i),constrain(slotTableTop+slotHeight*(i+1))])}});hoverListener=new HoverListener(coordinateGrid);colContentPositions=new HorizontalPositionCache(function(col){return dayBodyCellInners.eq(col)});function colContentLeft(col){return colContentPositions.left(col)}
function colContentRight(col){return colContentPositions.right(col)}
function dateCell(date){return{row:Math.floor(dayDiff(date,t.visStart)/7),col:dayOfWeekCol(date.getDay())}}
function cellDate(cell){var d=colDate(cell.col);var slotIndex=cell.row;if(opt('allDaySlot')){slotIndex--}
if(slotIndex>=0){addMinutes(d,minMinute+slotIndex*opt('slotMinutes'))}
return d}
function colDate(col){return addDays(cloneDate(t.visStart),col*dis+dit)}
function cellIsAllDay(cell){return opt('allDaySlot')&&!cell.row}
function dayOfWeekCol(dayOfWeek){return((dayOfWeek-Math.max(firstDay,nwe)+colCnt)%colCnt)*dis+dit}
function timePosition(day,time){day=cloneDate(day,true);if(time<addMinutes(cloneDate(day),minMinute)){return 0}
if(time>=addMinutes(cloneDate(day),maxMinute)){return slotTable.height()}
var slotMinutes=opt('slotMinutes'),minutes=time.getHours()*60+time.getMinutes()-minMinute,slotI=Math.floor(minutes/slotMinutes),slotTop=slotTopCache[slotI];if(slotTop===undefined){slotTop=slotTopCache[slotI]=slotTable.find('tr:eq('+slotI+') td div')[0].offsetTop}
return Math.max(0,Math.round(slotTop-1+slotHeight*((minutes%slotMinutes)/slotMinutes)))}
function allDayBounds(){return{left:axisWidth,right:viewWidth-gutterWidth}}
function getAllDayRow(index){return allDayRow}
function defaultEventEnd(event){var start=cloneDate(event.start);if(event.allDay){return start}
return addMinutes(start,opt('defaultEventMinutes'))}
function defaultSelectionEnd(startDate,allDay){if(allDay){return cloneDate(startDate)}
return addMinutes(cloneDate(startDate),opt('slotMinutes'))}
function renderSelection(startDate,endDate,allDay){if(allDay){if(opt('allDaySlot')){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true)}}else{renderSlotSelection(startDate,endDate)}}
function renderSlotSelection(startDate,endDate){var helperOption=opt('selectHelper');coordinateGrid.build();if(helperOption){var col=dayDiff(startDate,t.visStart)*dis+dit;if(col>=0&&col<colCnt){var rect=coordinateGrid.rect(0,col,0,col,slotContent);var top=timePosition(startDate,startDate);var bottom=timePosition(startDate,endDate);if(bottom>top){rect.top=top;rect.height=bottom-top;rect.left+=2;rect.width-=5;if($.isFunction(helperOption)){var helperRes=helperOption(startDate,endDate);if(helperRes){rect.position='absolute';rect.zIndex=8;selectionHelper=$(helperRes).css(rect).appendTo(slotContent)}}else{rect.isStart=true;rect.isEnd=true;selectionHelper=$(slotSegHtml({title:'',start:startDate,end:endDate,className:['fc-select-helper'],editable:false},rect));selectionHelper.css('opacity',opt('dragOpacity'))}if(selectionHelper){slotBind(selectionHelper);slotContent.append(selectionHelper);setOuterWidth(selectionHelper,rect.width,true);setOuterHeight(selectionHelper,rect.height,true)}}}}else{renderSlotOverlay(startDate,endDate)}}
function clearSelection(){clearOverlays();if(selectionHelper){selectionHelper.remove();selectionHelper=null}}
function slotSelectionMousedown(ev){if(ev.which==1&&opt('selectable')){unselect(ev);var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cell.col==origCell.col&&!cellIsAllDay(cell)){var d1=cellDate(origCell);var d2=cellDate(cell);dates=[d1,addMinutes(cloneDate(d1),opt('slotMinutes')),d2,addMinutes(cloneDate(d2),opt('slotMinutes'))].sort(cmp);renderSlotSelection(dates[0],dates[3])}else{dates=null}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],false,ev)}
reportSelection(dates[0],dates[3],false,ev)}})}}
function reportDayClick(date,allDay,ev){trigger('dayClick',dayBodyCells[dayOfWeekCol(date.getDay())],date,allDay,ev)}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){if(cellIsAllDay(cell)){renderCellOverlay(cell.row,cell.col,cell.row,cell.col)}else{var d1=cellDate(cell);var d2=addMinutes(cloneDate(d1),opt('defaultEventMinutes'));renderSlotOverlay(d1,d2)}}},ev)}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){trigger('drop',_dragElement,cellDate(cell),cellIsAllDay(cell),ev,ui)}}}
function AgendaEventRenderer(){var t=this;t.renderEvents=renderEvents;t.compileDaySegs=compileDaySegs;t.clearEvents=clearEvents;t.slotSegHtml=slotSegHtml;t.bindDaySeg=bindDaySeg;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEvents=t.reportEvents;var reportEventClear=t.reportEventClear;var eventElementHandlers=t.eventElementHandlers;var setHeight=t.setHeight;var getDaySegmentContainer=t.getDaySegmentContainer;var getSlotSegmentContainer=t.getSlotSegmentContainer;var getHoverListener=t.getHoverListener;var getMaxMinute=t.getMaxMinute;var getMinMinute=t.getMinMinute;var timePosition=t.timePosition;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var renderDaySegs=t.renderDaySegs;var resizableDayEvent=t.resizableDayEvent;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var getSlotHeight=t.getSlotHeight;var getBodyContent=t.getBodyContent;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var calendar=t.calendar;var formatDate=calendar.formatDate;var formatDates=calendar.formatDates;function renderEvents(events,modifiedEventId){reportEvents(events);var i,len=events.length,dayEvents=[],slotEvents=[];for(i=0;i<len;i++){if(events[i].allDay){dayEvents.push(events[i])}else{slotEvents.push(events[i])}}
if(opt('allDaySlot')){renderDaySegs(compileDaySegs(dayEvents),modifiedEventId);setHeight()}
renderSlotSegs(compileSlotSegs(slotEvents),modifiedEventId)}
function clearEvents(){reportEventClear();getDaySegmentContainer().empty();getSlotSegmentContainer().empty()}
function compileDaySegs(events){var levels=stackSegs(sliceSegs(events,$.map(events,exclEndDay),t.visStart,t.visEnd)),i,levelCnt=levels.length,level,j,seg,segs=[];for(i=0;i<levelCnt;i++){level=levels[i];for(j=0;j<level.length;j++){seg=level[j];seg.row=0;seg.level=i;segs.push(seg)}}
return segs}
function compileSlotSegs(events){var colCnt=getColCnt(),minMinute=getMinMinute(),maxMinute=getMaxMinute(),d=addMinutes(cloneDate(t.visStart),minMinute),visEventEnds=$.map(events,slotEventEnd),i,col,j,level,k,seg,segs=[];for(i=0;i<colCnt;i++){col=stackSegs(sliceSegs(events,visEventEnds,d,addMinutes(cloneDate(d),maxMinute-minMinute)));countForwardSegs(col);for(j=0;j<col.length;j++){level=col[j];for(k=0;k<level.length;k++){seg=level[k];seg.col=i;seg.level=j;segs.push(seg)}}
addDays(d,1,true)}
return segs}
function slotEventEnd(event){if(event.end){return cloneDate(event.end)}else{return addMinutes(cloneDate(event.start),opt('defaultEventMinutes'))}}
function renderSlotSegs(segs,modifiedEventId){var i,segCnt=segs.length,seg,event,classes,top,bottom,colI,levelI,forward,leftmost,availWidth,outerWidth,left,html='',eventElements,eventElement,triggerRes,vsideCache={},hsideCache={},key,val,contentElement,height,slotSegmentContainer=getSlotSegmentContainer(),rtl,dis,dit,colCnt=getColCnt();if(rtl=opt('isRTL')){dis=-1;dit=colCnt-1}else{dis=1;dit=0}
for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;top=timePosition(seg.start,seg.start);bottom=timePosition(seg.start,seg.end);colI=seg.col;levelI=seg.level;forward=seg.forward||0;leftmost=colContentLeft(colI*dis+dit);availWidth=colContentRight(colI*dis+dit)-leftmost;availWidth=Math.min(availWidth-6,availWidth*.95);if(levelI){outerWidth=availWidth/(levelI+forward+1)}else{if(forward){outerWidth=((availWidth/(forward+1))-(12/2))*2}else{outerWidth=availWidth}}
left=leftmost+(availWidth/(levelI+forward+1)*levelI)*dis+(rtl?availWidth-outerWidth:0);seg.top=top;seg.left=left;seg.outerWidth=outerWidth;seg.outerHeight=bottom-top;html+=slotSegHtml(event,seg)}
slotSegmentContainer[0].innerHTML=html;eventElements=slotSegmentContainer.children();for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;eventElement=$(eventElements[i]);triggerRes=trigger('eventRender',event,event,eventElement);if(triggerRes===false){eventElement.remove()}else{if(triggerRes&&triggerRes!==true){eventElement.remove();eventElement=$(triggerRes).css({position:'absolute',top:seg.top,left:seg.left}).appendTo(slotSegmentContainer)}
seg.element=eventElement;if(event._id===modifiedEventId){bindSlotSeg(event,eventElement,seg)}else{eventElement[0]._fci=i}
reportEventElement(event,eventElement)}}
lazySegBind(slotSegmentContainer,segs,bindSlotSeg);for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){val=vsideCache[key=seg.key=cssKey(eventElement[0])];seg.vsides=val===undefined?(vsideCache[key]=vsides(eventElement,true)):val;val=hsideCache[key];seg.hsides=val===undefined?(hsideCache[key]=hsides(eventElement,true)):val;contentElement=eventElement.find('div.fc-event-content');if(contentElement.length){seg.contentTop=contentElement[0].offsetTop}}}
for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){eventElement[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+'px';height=Math.max(0,seg.outerHeight-seg.vsides);eventElement[0].style.height=height+'px';event=seg.event;if(seg.contentTop!==undefined&&height-seg.contentTop<10){eventElement.find('div.fc-event-time').text(formatDate(event.start,opt('timeFormat'))+' - '+event.title);eventElement.find('div.fc-event-title').remove()}
trigger('eventAfterRender',event,event,eventElement)}}}
function slotSegHtml(event,seg){var html="<";var url=event.url;var skinCss=getSkinCss(event,opt);var skinCssAttr=(skinCss?" style='"+skinCss+"'":'');var classes=['fc-event','fc-event-skin','fc-event-vert'];if(isEventDraggable(event)){classes.push('fc-event-draggable')}
if(seg.isStart){classes.push('fc-corner-top')}
if(seg.isEnd){classes.push('fc-corner-bottom')}
classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[])}
if(url){html+="a href='"+htmlEscape(event.url)+"'"}else{html+="div"}
html+=" class='"+classes.join(' ')+"' style='position:absolute;z-index:8;top:"+seg.top+"px;left:"+seg.left+"px;"+skinCss+"'><div class='fc-event-inner fc-event-skin'"+skinCssAttr+"><div class='fc-event-head fc-event-skin'"+skinCssAttr+"><div class='fc-event-time'>"+htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</div></div><div class='fc-event-content'><div class='fc-event-title'>"+htmlEscape(event.title)+"</div></div><div class='fc-event-bg'></div></div>";if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-s'>=</div>"}
html+="</"+(url?"a":"div");return html}
function bindDaySeg(event,eventElement,seg){if(isEventDraggable(event)){draggableDayEvent(event,eventElement,seg.isStart)}
if(seg.isEnd&&isEventResizable(event)){resizableDayEvent(event,eventElement,seg)}
eventElementHandlers(event,eventElement)}
function bindSlotSeg(event,eventElement,seg){var timeElement=eventElement.find('div.fc-event-time');if(isEventDraggable(event)){draggableSlotEvent(event,eventElement,timeElement)}
if(seg.isEnd&&isEventResizable(event)){resizableSlotEvent(event,eventElement,timeElement)}
eventElementHandlers(event,eventElement)}
function draggableDayEvent(event,eventElement,isStart){var origWidth;var revert;var allDay=true;var dayDelta;var dis=opt('isRTL')?-1:1;var hoverListener=getHoverListener();var colWidth=getColWidth();var slotHeight=getSlotHeight();var minMinute=getMinMinute();eventElement.draggable({zIndex:9,opacity:opt('dragOpacity','month'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);origWidth=eventElement.width();hoverListener.start(function(cell,origCell,rowDelta,colDelta){clearOverlays();if(cell){revert=false;dayDelta=colDelta*dis;if(!cell.row){renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));resetElement()}else{if(isStart){if(allDay){eventElement.width(colWidth-10);setOuterHeight(eventElement,slotHeight*Math.round((event.end?((event.end-event.start)/MINUTE_MS):opt('defaultEventMinutes'))/opt('slotMinutes')));eventElement.draggable('option','grid',[colWidth,1]);allDay=false}}else{revert=true}}
revert=revert||(allDay&&!dayDelta)}else{resetElement();revert=true}
eventElement.draggable('option','revert',revert)},ev,'drag')},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(revert){resetElement();eventElement.css('filter','');showEvents(event,eventElement)}else{var minuteDelta=0;if(!allDay){minuteDelta=Math.round((eventElement.offset().top-getBodyContent().offset().top)/slotHeight)*opt('slotMinutes')+minMinute-(event.start.getHours()*60+event.start.getMinutes())}
eventDrop(this,event,dayDelta,minuteDelta,allDay,ev,ui)}}});function resetElement(){if(!allDay){eventElement.width(origWidth).height('').draggable('option','grid',null);allDay=true}}}
function draggableSlotEvent(event,eventElement,timeElement){var origPosition;var allDay=false;var dayDelta;var minuteDelta;var prevMinuteDelta;var dis=opt('isRTL')?-1:1;var hoverListener=getHoverListener();var colCnt=getColCnt();var colWidth=getColWidth();var slotHeight=getSlotHeight();eventElement.draggable({zIndex:9,scroll:false,grid:[colWidth,slotHeight],axis:colCnt==1?'y':false,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);origPosition=eventElement.position();minuteDelta=prevMinuteDelta=0;hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable('option','revert',!cell);clearOverlays();if(cell){dayDelta=colDelta*dis;if(opt('allDaySlot')&&!cell.row){if(!allDay){allDay=true;timeElement.hide();eventElement.draggable('option','grid',null)}
renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta))}else{resetElement()}}},ev,'drag')},drag:function(ev,ui){minuteDelta=Math.round((ui.position.top-origPosition.top)/slotHeight)*opt('slotMinutes');if(minuteDelta!=prevMinuteDelta){if(!allDay){updateTimeText(minuteDelta)}
prevMinuteDelta=minuteDelta}},stop:function(ev,ui){var cell=hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(cell&&(dayDelta||minuteDelta||allDay)){eventDrop(this,event,dayDelta,allDay?0:minuteDelta,allDay,ev,ui)}else{resetElement();eventElement.css('filter','');eventElement.css(origPosition);updateTimeText(0);showEvents(event,eventElement)}}});function updateTimeText(minuteDelta){var newStart=addMinutes(cloneDate(event.start),minuteDelta);var newEnd;if(event.end){newEnd=addMinutes(cloneDate(event.end),minuteDelta)}
timeElement.text(formatDates(newStart,newEnd,opt('timeFormat')))}
function resetElement(){if(allDay){timeElement.css('display','');eventElement.draggable('option','grid',[colWidth,slotHeight]);allDay=false}}}
function resizableSlotEvent(event,eventElement,timeElement){var slotDelta,prevSlotDelta;var slotHeight=getSlotHeight();eventElement.resizable({handles:{s:'div.ui-resizable-s'},grid:slotHeight,start:function(ev,ui){slotDelta=prevSlotDelta=0;hideEvents(event,eventElement);eventElement.css('z-index',9);trigger('eventResizeStart',this,event,ev,ui)},resize:function(ev,ui){slotDelta=Math.round((Math.max(slotHeight,eventElement.height())-ui.originalSize.height)/slotHeight);if(slotDelta!=prevSlotDelta){timeElement.text(formatDates(event.start,(!slotDelta&&!event.end)?null:addMinutes(eventEnd(event),opt('slotMinutes')*slotDelta),opt('timeFormat')));prevSlotDelta=slotDelta}},stop:function(ev,ui){trigger('eventResizeStop',this,event,ev,ui);if(slotDelta){eventResize(this,event,0,opt('slotMinutes')*slotDelta,ev,ui)}else{eventElement.css('z-index',8);showEvents(event,eventElement)}}})}}
function countForwardSegs(levels){var i,j,k,level,segForward,segBack;for(i=levels.length-1;i>0;i--){level=levels[i];for(j=0;j<level.length;j++){segForward=level[j];for(k=0;k<levels[i-1].length;k++){segBack=levels[i-1][k];if(segsCollide(segForward,segBack)){segBack.forward=Math.max(segBack.forward||0,(segForward.forward||0)+1)}}}}}
function View(element,calendar,viewName){var t=this;t.element=element;t.calendar=calendar;t.name=viewName;t.opt=opt;t.trigger=trigger;t.isEventDraggable=isEventDraggable;t.isEventResizable=isEventResizable;t.reportEvents=reportEvents;t.eventEnd=eventEnd;t.reportEventElement=reportEventElement;t.reportEventClear=reportEventClear;t.eventElementHandlers=eventElementHandlers;t.showEvents=showEvents;t.hideEvents=hideEvents;t.eventDrop=eventDrop;t.eventResize=eventResize;var defaultEventEnd=t.defaultEventEnd;var normalizeEvent=calendar.normalizeEvent;var reportEventChange=calendar.reportEventChange;var eventsByID={};var eventElements=[];var eventElementsByID={};var options=calendar.options;function opt(name,viewNameOverride){var v=options[name];if(typeof v=='object'){return smartProperty(v,viewNameOverride||viewName)}
return v}
function trigger(name,thisObj){return calendar.trigger.apply(calendar,[name,thisObj||t].concat(Array.prototype.slice.call(arguments,2),[t]))}
function isEventDraggable(event){return isEventEditable(event)&&!opt('disableDragging')}
function isEventResizable(event){return isEventEditable(event)&&!opt('disableResizing')}
function isEventEditable(event){return firstDefined(event.editable,(event.source||{}).editable,opt('editable'))}
function reportEvents(events){eventsByID={};var i,len=events.length,event;for(i=0;i<len;i++){event=events[i];if(eventsByID[event._id]){eventsByID[event._id].push(event)}else{eventsByID[event._id]=[event]}}}
function eventEnd(event){return event.end?cloneDate(event.end):defaultEventEnd(event)}
function reportEventElement(event,element){eventElements.push(element);if(eventElementsByID[event._id]){eventElementsByID[event._id].push(element)}else{eventElementsByID[event._id]=[element]}}
function reportEventClear(){eventElements=[];eventElementsByID={}}
function eventElementHandlers(event,eventElement){eventElement.click(function(ev){if(!eventElement.hasClass('ui-draggable-dragging')&&!eventElement.hasClass('ui-resizable-resizing')){return trigger('eventClick',this,event,ev)}}).hover(function(ev){trigger('eventMouseover',this,event,ev)},function(ev){trigger('eventMouseout',this,event,ev)})}
function showEvents(event,exceptElement){eachEventElement(event,exceptElement,'show')}
function hideEvents(event,exceptElement){eachEventElement(event,exceptElement,'hide')}
function eachEventElement(event,exceptElement,funcName){var elements=eventElementsByID[event._id],i,len=elements.length;for(i=0;i<len;i++){if(!exceptElement||elements[i][0]!=exceptElement[0]){elements[i][funcName]()}}}
function eventDrop(e,event,dayDelta,minuteDelta,allDay,ev,ui){var oldAllDay=event.allDay;var eventId=event._id;moveEvents(eventsByID[eventId],dayDelta,minuteDelta,allDay);trigger('eventDrop',e,event,dayDelta,minuteDelta,allDay,function(){moveEvents(eventsByID[eventId],-dayDelta,-minuteDelta,oldAllDay);reportEventChange(eventId)},ev,ui);reportEventChange(eventId)}
function eventResize(e,event,dayDelta,minuteDelta,ev,ui){var eventId=event._id;elongateEvents(eventsByID[eventId],dayDelta,minuteDelta);trigger('eventResize',e,event,dayDelta,minuteDelta,function(){elongateEvents(eventsByID[eventId],-dayDelta,-minuteDelta);reportEventChange(eventId)},ev,ui);reportEventChange(eventId)}
function moveEvents(events,dayDelta,minuteDelta,allDay){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];if(allDay!==undefined){e.allDay=allDay}
addMinutes(addDays(e.start,dayDelta,true),minuteDelta);if(e.end){e.end=addMinutes(addDays(e.end,dayDelta,true),minuteDelta)}
normalizeEvent(e,options)}}
function elongateEvents(events,dayDelta,minuteDelta){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];e.end=addMinutes(addDays(eventEnd(e),dayDelta,true),minuteDelta);normalizeEvent(e,options)}}}
function DayEventRenderer(){var t=this;t.renderDaySegs=renderDaySegs;t.resizableDayEvent=resizableDayEvent;var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventResize=t.eventResize;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var allDayRow=t.allDayRow;var allDayBounds=t.allDayBounds;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var dayOfWeekCol=t.dayOfWeekCol;var dateCell=t.dateCell;var compileDaySegs=t.compileDaySegs;var getDaySegmentContainer=t.getDaySegmentContainer;var bindDaySeg=t.bindDaySeg;var formatDates=t.calendar.formatDates;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var clearSelection=t.clearSelection;function renderDaySegs(segs,modifiedEventId){var segmentContainer=getDaySegmentContainer();var rowDivs;var rowCnt=getRowCnt();var colCnt=getColCnt();var i=0;var rowI;var levelI;var colHeights;var j;var segCnt=segs.length;var seg;var top;var k;segmentContainer[0].innerHTML=daySegHTML(segs);daySegElementResolve(segs,segmentContainer.children());daySegElementReport(segs);daySegHandlers(segs,segmentContainer,modifiedEventId);daySegCalcHSides(segs);daySegSetWidths(segs);daySegCalcHeights(segs);rowDivs=getRowDivs();for(rowI=0;rowI<rowCnt;rowI++){levelI=0;colHeights=[];for(j=0;j<colCnt;j++){colHeights[j]=0}
while(i<segCnt&&(seg=segs[i]).row==rowI){top=arrayMax(colHeights.slice(seg.startCol,seg.endCol));seg.top=top;top+=seg.outerHeight;for(k=seg.startCol;k<seg.endCol;k++){colHeights[k]=top}
i++}
rowDivs[rowI].height(arrayMax(colHeights))}
daySegSetTops(segs,getRowTops(rowDivs))}
function renderTempDaySegs(segs,adjustRow,adjustTop){var tempContainer=$("<div/>");var elements;var segmentContainer=getDaySegmentContainer();var i;var segCnt=segs.length;var element;tempContainer[0].innerHTML=daySegHTML(segs);elements=tempContainer.children();segmentContainer.append(elements);daySegElementResolve(segs,elements);daySegCalcHSides(segs);daySegSetWidths(segs);daySegCalcHeights(segs);daySegSetTops(segs,getRowTops(getRowDivs()));elements=[];for(i=0;i<segCnt;i++){element=segs[i].element;if(element){if(segs[i].row===adjustRow){element.css('top',adjustTop)}
elements.push(element[0])}}
return $(elements)}
function daySegHTML(segs){var rtl=opt('isRTL');var i;var segCnt=segs.length;var seg;var event;var url;var classes;var bounds=allDayBounds();var minLeft=bounds.left;var maxLeft=bounds.right;var leftCol;var rightCol;var left;var right;var skinCss;var html='';for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;classes=['fc-event','fc-event-skin','fc-event-hori'];if(isEventDraggable(event)){classes.push('fc-event-draggable')}
if(rtl){if(seg.isStart){classes.push('fc-corner-right')}
if(seg.isEnd){classes.push('fc-corner-left')}
leftCol=dayOfWeekCol(seg.end.getDay()-1);rightCol=dayOfWeekCol(seg.start.getDay());left=seg.isEnd?colContentLeft(leftCol):minLeft;right=seg.isStart?colContentRight(rightCol):maxLeft}else{if(seg.isStart){classes.push('fc-corner-left')}
if(seg.isEnd){classes.push('fc-corner-right')}
leftCol=dayOfWeekCol(seg.start.getDay());rightCol=dayOfWeekCol(seg.end.getDay()-1);left=seg.isStart?colContentLeft(leftCol):minLeft;right=seg.isEnd?colContentRight(rightCol):maxLeft}
classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[])}
url=event.url;skinCss=getSkinCss(event,opt);if(url){html+="<a rel='nofollow' target='_blank' href='"+htmlEscape(url)+"'";html+=" class='"+classes.join(' ')+"' style='position:absolute;z-index:8;left:"+left+"px;text-align:center;'><div class='fc-event-inner fc-event-skin'"+(skinCss?" style='"+skinCss+"'":'')+">"}else{html+="<div";html+=" class='"+classes.join(' ')+"' style='position:absolute;z-index:8;left:"+left+"px;margin-top:-20px;text-align:right;'><div class='fc-event-inner fc-event-skin'"+(skinCss?" style='"+skinCss+"'":'')+">"}if(!event.allDay&&seg.isStart){html+="<span class='fc-event-time'>"+htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</span>"}
if(event._id.match(/[l|r]{0,1}cu_\d{4}-\d{1,2}-\d{1,2}/)){event._id=event._id.replace(/(^\s*)|(\s*$)/g,"").replace(/\ {2,}/," ");var eventIds=event._id.split(" ");var eventIdsCnt=eventIds.length;var iconCss='';var lastSpanCss='';for(var j=0;j<eventIdsCnt;j++){if(eventIds[j].match(/[l|r]{0,1}cu_\d{4}-\d{1,2}-\d{1,2}/)){iconCss=eventIds[j];continue}
if(j<eventIdsCnt-2){html+="<span class='"+htmlEscape(eventIds[j])+"'></span>"}else if(j==eventIdsCnt-2){if(iconCss!=''){html+="<span class='"+htmlEscape(eventIds[j])+"'></span>"}else{lastSpanCss=eventIds[j]}}else{lastSpanCss=eventIds[j]}}
html+="<span class='fc-event-title "+htmlEscape(lastSpanCss+" "+iconCss)+"'>"+htmlEscape(event.title)+"</span></div>"}else{html+="<span class='fc-event-title "+htmlEscape(event._id)+"'>"+htmlEscape(event.title)+"</span></div>"}if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-"+(rtl?'w':'e')+"'>&nbsp;&nbsp;&nbsp;</div>"}
html+="</"+(url?"a":"div")+">";seg.left=left;seg.outerWidth=right-left;seg.startCol=leftCol;seg.endCol=rightCol+1}
return html}
function daySegElementResolve(segs,elements){var i;var segCnt=segs.length;var seg;var event;var element;var triggerRes;for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;element=$(elements[i]);triggerRes=trigger('eventRender',event,event,element);if(triggerRes===false){element.remove()}else{if(triggerRes&&triggerRes!==true){triggerRes=$(triggerRes).css({position:'absolute',left:seg.left});element.replaceWith(triggerRes);element=triggerRes}
seg.element=element}}}
function daySegElementReport(segs){var i;var segCnt=segs.length;var seg;var element;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){reportEventElement(seg.event,element)}}}
function daySegHandlers(segs,segmentContainer,modifiedEventId){var i;var segCnt=segs.length;var seg;var element;var event;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){event=seg.event;if(event._id===modifiedEventId){bindDaySeg(event,element,seg)}else{element[0]._fci=i}}}
lazySegBind(segmentContainer,segs,bindDaySeg)}
function daySegCalcHSides(segs){var i;var segCnt=segs.length;var seg;var element;var key,val;var hsideCache={};for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){key=seg.key=cssKey(element[0]);val=hsideCache[key];if(val===undefined){val=hsideCache[key]=hsides(element,true)}
seg.hsides=val}}}
function daySegSetWidths(segs){var i;var segCnt=segs.length;var seg;var element;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){element[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+'px'}}}
function daySegCalcHeights(segs){var i;var segCnt=segs.length;var seg;var element;var key,val;var vmarginCache={};for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){key=seg.key;val=vmarginCache[key];if(val===undefined){val=vmarginCache[key]=vmargins(element)}
seg.outerHeight=element[0].offsetHeight+val}}}
function getRowDivs(){var i;var rowCnt=getRowCnt();var rowDivs=[];for(i=0;i<rowCnt;i++){rowDivs[i]=allDayRow(i).find('td:first div.fc-day-content > div')}
return rowDivs}
function getRowTops(rowDivs){var i;var rowCnt=rowDivs.length;var tops=[];for(i=0;i<rowCnt;i++){tops[i]=rowDivs[i][0].offsetTop}
return tops}
function daySegSetTops(segs,rowTops){var i;var segCnt=segs.length;var seg;var element;var event;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){element[0].style.top=rowTops[seg.row]+(seg.top||0)-15+'px';event=seg.event;trigger('eventAfterRender',event,event,element)}}}
function resizableDayEvent(event,element,seg){var rtl=opt('isRTL');var direction=rtl?'w':'e';var handle=element.find('div.ui-resizable-'+direction);var isResizing=false;disableTextSelection(element);element.mousedown(function(ev){ev.preventDefault()}).click(function(ev){if(isResizing){ev.preventDefault();ev.stopImmediatePropagation()}});handle.mousedown(function(ev){if(ev.which!=1){return}
isResizing=true;var hoverListener=t.getHoverListener();var rowCnt=getRowCnt();var colCnt=getColCnt();var dis=rtl?-1:1;var dit=rtl?colCnt-1:0;var elementTop=element.css('top');var dayDelta;var helpers;var eventCopy=$.extend({},event);var minCell=dateCell(event.start);clearSelection();$('body').css('cursor',direction+'-resize').one('mouseup',mouseup);trigger('eventResizeStart',this,event,ev);hoverListener.start(function(cell,origCell){if(cell){var r=Math.max(minCell.row,cell.row);var c=cell.col;if(rowCnt==1){r=0}
if(r==minCell.row){if(rtl){c=Math.min(minCell.col,c)}else{c=Math.max(minCell.col,c)}}
dayDelta=(r*7+c*dis+dit)-(origCell.row*7+origCell.col*dis+dit);var newEnd=addDays(eventEnd(event),dayDelta,true);if(dayDelta){eventCopy.end=newEnd;var oldHelpers=helpers;helpers=renderTempDaySegs(compileDaySegs([eventCopy]),seg.row,elementTop);helpers.find('*').css('cursor',direction+'-resize');if(oldHelpers){oldHelpers.remove()}
hideEvents(event)}else{if(helpers){showEvents(event);helpers.remove();helpers=null}}
clearOverlays();renderDayOverlay(event.start,addDays(cloneDate(newEnd),1))}},ev);function mouseup(ev){trigger('eventResizeStop',this,event,ev);$('body').css('cursor','');hoverListener.stop();clearOverlays();if(dayDelta){eventResize(this,event,dayDelta,0,ev)}
setTimeout(function(){isResizing=false},0)}})}}
function SelectionManager(){var t=this;t.select=select;t.unselect=unselect;t.reportSelection=reportSelection;t.daySelectionMousedown=daySelectionMousedown;var opt=t.opt;var trigger=t.trigger;var defaultSelectionEnd=t.defaultSelectionEnd;var renderSelection=t.renderSelection;var clearSelection=t.clearSelection;var selected=false;if(opt('selectable')&&opt('unselectAuto')){$(document).mousedown(function(ev){var ignore=opt('unselectCancel');if(ignore){if($(ev.target).parents(ignore).length){return}}
unselect(ev)})}
function select(startDate,endDate,allDay){unselect();if(!endDate){endDate=defaultSelectionEnd(startDate,allDay)}
renderSelection(startDate,endDate,allDay);reportSelection(startDate,endDate,allDay)}
function unselect(ev){if(selected){selected=false;clearSelection();trigger('unselect',null,ev)}}
function reportSelection(startDate,endDate,allDay,ev){selected=true;trigger('select',null,startDate,endDate,allDay,ev)}
function daySelectionMousedown(ev){var cellDate=t.cellDate;var cellIsAllDay=t.cellIsAllDay;var hoverListener=t.getHoverListener();var reportDayClick=t.reportDayClick;if(ev.which==1&&opt('selectable')){unselect(ev);var _mousedownElement=this;var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cellIsAllDay(cell)){dates=[cellDate(origCell),cellDate(cell)].sort(cmp);renderSelection(dates[0],dates[1],true)}else{dates=null}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],true,ev)}
reportSelection(dates[0],dates[1],true,ev)}})}}}
function OverlayManager(){var t=this;t.renderOverlay=renderOverlay;t.clearOverlays=clearOverlays;var usedOverlays=[];var unusedOverlays=[];function renderOverlay(rect,parent){var e=unusedOverlays.shift();if(!e){e=$("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>")}
if(e[0].parentNode!=parent[0]){e.appendTo(parent)}
usedOverlays.push(e.css(rect).show());return e}
function clearOverlays(){var e;while(e=usedOverlays.shift()){unusedOverlays.push(e.hide().unbind())}}}
function CoordinateGrid(buildFunc){var t=this;var rows;var cols;t.build=function(){rows=[];cols=[];buildFunc(rows,cols)};t.cell=function(x,y){var rowCnt=rows.length;var colCnt=cols.length;var i,r=-1,c=-1;for(i=0;i<rowCnt;i++){if(y>=rows[i][0]&&y<rows[i][1]){r=i;break}}
for(i=0;i<colCnt;i++){if(x>=cols[i][0]&&x<cols[i][1]){c=i;break}}
return(r>=0&&c>=0)?{row:r,col:c}:null};t.rect=function(row0,col0,row1,col1,originElement){var origin=originElement.offset();return{top:rows[row0][0]-origin.top,left:cols[col0][0]-origin.left,width:cols[col1][1]-cols[col0][0],height:rows[row1][1]-rows[row0][0]}}}
function HoverListener(coordinateGrid){var t=this;var bindType;var change;var firstCell;var cell;t.start=function(_change,ev,_bindType){change=_change;firstCell=cell=null;coordinateGrid.build();mouse(ev);bindType=_bindType||'mousemove';$(document).bind(bindType,mouse)};function mouse(ev){_fixUIEvent(ev);var newCell=coordinateGrid.cell(ev.pageX,ev.pageY);if(!newCell!=!cell||newCell&&(newCell.row!=cell.row||newCell.col!=cell.col)){if(newCell){if(!firstCell){firstCell=newCell}
change(newCell,firstCell,newCell.row-firstCell.row,newCell.col-firstCell.col)}else{change(newCell,firstCell)}
cell=newCell}}
t.stop=function(){$(document).unbind(bindType,mouse);return cell}}
function _fixUIEvent(event){if(event.pageX===undefined){event.pageX=event.originalEvent.pageX;event.pageY=event.originalEvent.pageY}}
function HorizontalPositionCache(getElement){var t=this,elements={},lefts={},rights={};function e(i){return elements[i]=elements[i]||getElement(i)}
t.left=function(i){return lefts[i]=lefts[i]===undefined?e(i).position().left:lefts[i]};t.right=function(i){return rights[i]=rights[i]===undefined?t.left(i)+e(i).width():rights[i]};t.clear=function(){elements={};lefts={};rights={}}}});;define('tour_amd/right_scroll_v7',['jquery'],function($){var exports={};var init;var tourPage={leftCat:function(){var lc=$("#leftcat").length,lcVal=$("#leftcat").val();if(lc){var catLoaded=false;$('.categorys').hover(function(){if(!catLoaded){catLoaded=true;$(".categorys").load('/header/'+lcVal+'');}});}},canlendarLoad:function(){if($("#hotel_page").length){return;}
var routeId=$("#route_id_tmp").val();var no_product_flag=$("#no_product").val();if(no_product_flag==1){routeId=1;}
$.ajax({datatype:"html",url:'/singleCalendar/routeId/'+routeId,success:function(data){$('#calendar').html(data);tabScroll();}});},noDate:function(){var no_date=$("#no_date").length;if(no_date){try{var arrPageSizes=___getPageSize();$('#noDate').css({top:parseInt($('#noDate').css("top"))
-(arrPageSizes[3]/5)
+(arrPageSizes[3]-parseInt($('#noDate').css("height")))/2-10});}catch(e){}}},__tourList:function(){var arry=new Array();for(var t=0;t<$(".tourList").children().length;t++){arry[t]=0;}
if($(".tourList").children().length>1){$(".tourList").find("li").each(function(i,n){var _this=$(n);_this.hover(function(){var _index=_this.index();var l_left=80*(_index)+30;$(".tourItem").eq(_index).find($(".mRec_con .arrow")).css("left",l_left);_this.addClass("xc_selected");var _src=_this.attr(("data-src"));showImg(_src,_index);changeCont(i);},function(){var temp=0;if(arry[i]==1){return false;}
for(var j=0;j<arry.length;j++){if(arry[j]==1){temp=j;}}
changeCont(temp);$(".tourList").find("li").siblings().removeClass("xc_selected").end().eq(temp).addClass("xc_selected");});});$(".tourList").find("li").each(function(i,n){var _ths=$(n);_ths.click(function(){$("#tripcontent"+i).find('.list').each(function(){$(this).find('.in-table').hide();var nextTable=$(this).find('.in-table').eq(0);nextTable.show();nextTable.parent().removeClass('over_scroll');var height=nextTable.height();if(height<474){nextTable.parent().height(height);}else{nextTable.parent().height(474);}
nextTable.parent().addClass('over_scroll');});_ths.siblings().removeClass("xc_selected").end().addClass("xc_selected");for(var j=0;j<arry.length;j++){if(i!=j){arry[j]=0;}else{arry[j]=1;$(".tourItem").eq(j).find($(".mRec_con .arrow")).css("left",80*j+30);}}});});function changeCont(tt){$(".tourSection_niuren_parent").children().siblings().hide().end().eq(tt).show();$('.more-dl-info').removeClass('tb-show');$('.deadline-table').hide();}}},__clearComparSelect:function(){if($(".comparison_btn").length){$(".del_btn").click(function(){$(".comparison_btn").removeClass("compar_select");});}},__commScroll:function(){if($(".right_scroll").length==0){var rightHtml='<div class="right_scroll"></div>';var winWidth=$(window).width(),comparison=parseInt((winWidth-1000),10)/2,winh=$(window).height();$(document.body).append(rightHtml);$(".right_scroll").css({top:258});}},__scrollPosition:function(obj){var st=$(window).scrollTop(),winh=$(window).height();if(!window.XMLHttpRequest){obj.css({"top":st+winh-winh/2,"background-attachment":"fixed","background-image":"url(about:blank)"});}},__onLineService:function(groupid){var st=$(window).scrollTop(),localTime=new Date().getHours().toLocaleString();var numTime=parseInt(localTime,10);var onLine=$('<li><a class="add_order" id="esq_live800" value="0"></a></li>'),offLine=$('<li><a class="add_order add_order_hide"></a></li>');var $backToTopEle;if(numTime>=7&&numTime<=21){addAttr(onLine,$backToTopEle);$backToTopEle=onLine;$(function(){$backToTopEle.show();});}else{return false;}
function addAttr(obj,fnshow){var treeObj=obj,fnobj=fnshow;var $backToTopTxt='在线客服';fnobj=treeObj.appendTo($(".right_scroll")).attr({title:$backToTopTxt});treeObj.find("a").attr({href:'javascript:Live800('+groupid+',560,480);'});}},__addBtnRight:function(){var st=$(window).scrollTop();var comparison_btn=$('<li data="加入对比"><a class="comparison_btn" onclick="com_pro_click();""></a></li>');addAttr(comparison_btn,comparison_btn);function addAttr(obj,fnshow){fnshow=obj.appendTo($(".right_scroll"));};$(function(){comparison_btn.show();$(".comparison_btn").click(function(){_gaq.push(['_trackEvent','[产品页]','[浮动层点击]','[加入对比]']);if($(".compared_prod").hasClass("hide")){$(".comparison_btn").removeClass("compar_select");}else{$(".comparison_btn").addClass("compar_select");}});});},__addStow:function(){var uId=$("#userId").val(),routeId=$("#route_id").val();var addStow=$('<li data="加入收藏"><a class="add_scroll"></a></li>');addAttr(addStow);function addAttr(obj,fnshow){fnshow=obj.appendTo($(".right_scroll"));}
addStow.click(function(){_gaq.push(['_trackEvent','[产品页]','[浮动层点击]','[加入收藏]']);var addbtn=$("#favorite_id");if(addbtn.hasClass("on")){addStow.addClass("addbtn");}
$(window).scrollTop(100,0);clickAddScroll();});},__backTop:function(){var backTop=$('<li data="返回顶部"><a class="backToTop"></a></li>');addAttr(backTop);function addAttr(obj,fnshow){fnshow=obj.appendTo($(".right_scroll"));}
backTop.click(function(){$(window).scrollTop(0,0);});},__addWeChat:function(s){var weChat=$('<li class="fashion_icon" data="扫码支付" id="Saoma"><a class="add_weChat"></a><div class="pop_weChart" id="weChat_pop"></div></li>');addAttr(weChat);function addAttr(obj,fnshow){if($(".right_scroll").find(".add_order").length>0){fnshow=obj.insertAfter($(".right_scroll li").eq(0));}else{fnshow=obj.insertBefore($(".right_scroll li").eq(0));}}
if(!$("#weChat_pop").find("img").length){$("#weChat_pop").append('<img src='+s+' alt="" /><p class="">微信扫码预订<br />点评多返5元</p>');}
tourPage.__showRightScrollPop();},__addOrderPhone:function(){if($("#Saoma").length>0){return false;}
var tuniuNum=$(".tuniu_400_num").html();var orderPhone=$('<li class="fashion_icon" data="电话预订"><a class="add_phone"></a><span class="pop_phone_p"><img class="pop_phone" src="http://img1.tuniucdn.com/img/20140423/common/pop_phone.png"/><span class="pop_phone_num">'+tuniuNum+'</span></span></li>');addAttr(orderPhone);function addAttr(obj,fnshow){if($(".right_scroll").find(".add_order").length>0){fnshow=obj.insertAfter($(".right_scroll li").eq(0));}else{fnshow=obj.insertBefore($(".right_scroll li").eq(0));}}
tourPage.__showRightScrollPop();},__clearComparSelect:function(){if($(".comparison_btn").length){$(".del_btn").click(function(){$(".comparison_btn").removeClass("compar_select");});}},__showRightScrollPop:function(){var fashion_icon=$(".right_scroll .fashion_icon");if(fashion_icon.length>0){fashion_icon.each(function(i,n){$(n).hover(function(){if($(n).find(".pop_phone_p").length>0){$(n).find(".pop_phone_p").find(".pop_phone").show();$(n).find(".pop_phone_p").find(".pop_phone_num").show();}
if($(n).find(".pop_weChart").length>0){$(n).find(".pop_weChart").show();}},function(){$(n).find(".pop_phone_p").find(".pop_phone").hide();$(n).find(".pop_phone_p").find(".pop_phone_num").hide();$(n).find(".pop_weChart").hide();});});}},__addErWeiMa:function(s,t){var wifiYouhui=$("#wifiYouhui");if(s){wifiYouhui.find("#wifiHasErWei").show().find("img").attr("src",t);}else{wifiYouhui.hide();}}}
var rightScrollChange={adjustScreen:function(){var time="";$(window).resize(function(){clearTimeout(time);time=setTimeout("rightScrollChange.rePosRightScroll()",200);});},rePosRightScroll:function(){var right_scroll=$(".right_scroll");if(right_scroll.length>0){var winWidth=$(window).width();if(winWidth>1100){$(".right_scroll").show();var comparison=parseInt((winWidth-1000),10)/2;var winh=$(window).height();$(".right_scroll").css({bottom:winh/2-80});}else{$(".right_scroll").hide();}};}}
var getAppData={getCookie:function(c_name){if(document.cookie.length>0)
{c_start=document.cookie.indexOf(c_name+"=")
if(c_start!=-1)
{c_start=c_start+c_name.length+1
c_end=document.cookie.indexOf(";",c_start)
if(c_end==-1)c_end=document.cookie.length
return unescape(document.cookie.substring(c_start,c_end))}}
return""},getRouteId:function(){var routeId_ProdType=[];var route_id=$("#route_id").val();var city_code=$("#city_code").val();var prodType="";if(route_id&&route_id!=""){routeId_ProdType[0]=route_id;}
if(city_code&&city_code!=""){routeId_ProdType[1]=city_code;}
if(prodType!=""){routeId_ProdType[2]=0;}
return routeId_ProdType;},insertInPage:function(data){var insertWhere=$("");insertWhere.html(data);},getTuniuApp:function(){var routeIdProdType=getAppData.getRouteId();var tn_url="http://dynamic.m.tuniu.com/webBanner/getBannerForProduct";var tn_data={"productId":routeIdProdType[0],"cityCode":routeIdProdType[1],"p":getAppData.getCookie("tuniu_partner"),"productType":routeIdProdType[2]}
var data={"success":false,"qRCodeUrl":""}
var isShowPhone=$("#phow_show");if(!isShowPhone.length){return false;}
var isShowPhoneVal=isShowPhone.val();if(isShowPhoneVal==1){tourPage.__addOrderPhone();}}};init=function(){tourPage.canlendarLoad();tourPage.noDate();tourPage.__tourList();};exports.init=init;return exports;});;define('tour_amd/jquery.gallery',['jquery'],function($){$.fn.gyGallery=function(options){var defaults={loader_image:'http://img3.tuniucdn.com/site/file/tn-gallery/img/loader.gif',start_at_index:0,description_wrapper:false,thumb_opacity:0.7,animate_first_image:false,animation_speed:400,width:false,height:false,display_next_and_prev:true,display_back_and_forward:true,scroll_jump:0,slideshow:{enable:true,autostart:false,speed:5000,start_label:'Start',stop_label:'Stop',stop_on_scroll:true,countdown_prefix:'(',countdown_sufix:')',onStart:false,onStop:false},effect:'slide-hori',enable_keyboard_move:true,cycle:true,callbacks:{init:false,afterImageVisible:false,beforeImageVisible:false}};var settings=$.extend(false,defaults,options);if(options&&options.slideshow){settings.slideshow=$.extend(false,defaults.slideshow,options.slideshow);};if(!settings.slideshow.enable){settings.slideshow.autostart=false;};var galleries=[];$(this).each(function(){var gallery=new AdGallery(this,settings);galleries[galleries.length]=gallery;});return galleries;};$("head")&&$("head").append('<link href="http://img2.tuniucdn.com/f/20141017/tn-gallery/gallery.css" rel="stylesheet">');function VerticalSlideAnimation(img_container,direction,desc){var current_top=parseInt(img_container.css('top'),10);if(direction=='left'){var old_image_top='-'+this.image_wrapper_height+'px';img_container.css('top',this.image_wrapper_height+'px');}else{var old_image_top=this.image_wrapper_height+'px';img_container.css('top','-'+this.image_wrapper_height+'px');};if(desc){desc.css('bottom','-'+desc[0].offsetHeight+'px');desc.animate({bottom:0},this.settings.animation_speed*2);};if(this.current_description){this.current_description.animate({bottom:'-'+this.current_description[0].offsetHeight+'px'},this.settings.animation_speed*2);};return{old_image:{top:old_image_top},new_image:{top:current_top}};};function HorizontalSlideAnimation(img_container,direction,desc){var current_left=parseInt(img_container.css('left'),10);if(direction=='left'){var old_image_left='-'+this.image_wrapper_width+'px';img_container.css('left',this.image_wrapper_width+'px');}else{var old_image_left=this.image_wrapper_width+'px';img_container.css('left','-'+this.image_wrapper_width+'px');};if(desc){desc.css('bottom','-'+desc[0].offsetHeight+'px');desc.animate({bottom:0},this.settings.animation_speed*2);};if(this.current_description){this.current_description.animate({bottom:'-'+this.current_description[0].offsetHeight+'px'},this.settings.animation_speed*2);};return{old_image:{left:old_image_left},new_image:{left:current_left}};};function ResizeAnimation(img_container,direction,desc){var image_width=img_container.width();var image_height=img_container.height();var current_left=parseInt(img_container.css('left'),10);var current_top=parseInt(img_container.css('top'),10);img_container.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2});return{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:image_width,height:image_height,top:current_top,left:current_left}};};function FadeAnimation(img_container,direction,desc){img_container.css('opacity',0);return{old_image:{opacity:0},new_image:{opacity:1}};};function NoneAnimation(img_container,direction,desc){img_container.css('opacity',0);return{old_image:{opacity:0},new_image:{opacity:1},speed:0};};function AdGallery(wrapper,settings){this.init(wrapper,settings);};AdGallery.prototype={wrapper:false,image_wrapper:false,gallery_info:false,nav:false,loader:false,preloads:false,thumbs_wrapper:false,scroll_back:false,scroll_forward:false,next_link:false,prev_link:false,slideshow:false,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:false,current_description:false,nav_display_width:0,settings:false,images:false,in_transition:false,animations:false,init:function(wrapper,settings){var context=this;this.wrapper=$(wrapper);this.settings=settings;this.setupElements();this.setupAnimations();if(this.settings.width){this.image_wrapper_width=this.settings.width;this.image_wrapper.width(this.settings.width);this.wrapper.width(this.settings.width);}else{this.image_wrapper_width=this.image_wrapper.width();};if(this.settings.height){this.image_wrapper_height=this.settings.height;this.image_wrapper.height(this.settings.height);}else{this.image_wrapper_height=this.image_wrapper.height();};this.nav_display_width=this.nav.width();this.current_index=0;this.current_image=false;this.current_description=false;this.in_transition=false;this.findImages();if(this.settings.display_next_and_prev){this.initNextAndPrev();};var nextimage_callback=function(callback){return context.nextImage(callback);};this.slideshow=new AdGallerySlideshow(nextimage_callback,this.settings.slideshow);this.controls.append(this.slideshow.create());if(this.settings.slideshow.enable){this.slideshow.enable();}else{this.slideshow.disable();};if(this.settings.display_back_and_forward){this.initBackAndForward();};if(this.settings.enable_keyboard_move){this.initKeyEvents();};var start_at=parseInt(this.settings.start_at_index,10);if(window.location.hash&&window.location.hash.indexOf('#gy-image')===0){start_at=window.location.hash.replace(/[^0-9]+/g,'');if((start_at*1)!=start_at){start_at=this.settings.start_at_index;};};this.loading(true);this.showImage(start_at,function(){if(context.settings.slideshow.autostart){context.preloadImage(start_at+1);context.slideshow.start();};});this.fireCallback(this.settings.callbacks.init);},setupAnimations:function(){this.animations={'slide-vert':VerticalSlideAnimation,'slide-hori':HorizontalSlideAnimation,'resize':ResizeAnimation,'fade':FadeAnimation,'none':NoneAnimation};},setupElements:function(){this.controls=this.wrapper.find('.gy-controls');this.gallery_info=$('<p class="gy-info"></p>');this.controls.append(this.gallery_info);this.image_wrapper=this.wrapper.find('.gy-image-wrapper');this.image_wrapper.empty();this.nav=this.wrapper.find('.gy-nav');this.thumbs_wrapper=this.nav.find('.gy-thumbs');this.preloads=$('<div class="gy-preloads"></div>');this.loader=$('<img class="gy-loader" src="'+this.settings.loader_image+'">');this.image_wrapper.append(this.loader);this.loader.hide();$(document.body).append(this.preloads);},loading:function(bool){if(bool){this.loader.show();}else{this.loader.hide();};},addAnimation:function(name,fn){if($.isFunction(fn)){this.animations[name]=fn;};},findImages:function(){var context=this;this.images=[];var thumb_wrapper_width=0;var thumbs_loaded=0;var thumbs=this.thumbs_wrapper.find('a');var thumb_count=thumbs.length;if(this.settings.thumb_opacity<1){thumbs.find('img').css('opacity',this.settings.thumb_opacity);};thumbs.each(function(i){var link=$(this);var image_src=link.attr('href');var thumb=link.find('img');if(!context.isImageLoaded(thumb[0])){thumb.load(function(){thumb_wrapper_width+=this.parentNode.parentNode.offsetWidth;thumbs_loaded++;});}else{thumb_wrapper_width+=thumb[0].parentNode.parentNode.offsetWidth;thumbs_loaded++;};link.addClass('gy-thumb'+i);link.click(function(){context.showImage(i);context.slideshow.stop();return false;}).hover(function(){if(!$(this).is('.gy-active')&&context.settings.thumb_opacity<1){$(this).find('img').fadeTo(300,1);};context.preloadImage(i);},function(){if(!$(this).is('.gy-active')&&context.settings.thumb_opacity<1){$(this).find('img').fadeTo(300,context.settings.thumb_opacity);};});var link=false;if(thumb.data('gy-link')){link=thumb.data('gy-link');}else if(thumb.attr('longdesc')&&thumb.attr('longdesc').length){link=thumb.attr('longdesc');};var desc=false;if(thumb.data('gy-desc')){desc=thumb.data('gy-desc');}else if(thumb.attr('alt')&&thumb.attr('alt').length){desc=thumb.attr('alt');};var title=false;if(thumb.data('gy-title')){title=thumb.data('gy-title');}else if(thumb.attr('title')&&thumb.attr('title').length){title=thumb.attr('title');};context.images[i]={thumb:thumb.attr('src'),image:image_src,error:false,preloaded:false,desc:desc,title:title,size:false,link:link};});var inter=setInterval(function(){if(thumb_count==thumbs_loaded){thumb_wrapper_width-=100;var list=context.nav.find('.gy-thumb-list');list.css('width',thumb_wrapper_width+'px');var i=1;var last_height=list.height();while(i<201){list.css('width',(thumb_wrapper_width+i)+'px');if(last_height!=list.height()){break;}
last_height=list.height();i++;}
clearInterval(inter);};},100);},initKeyEvents:function(){var context=this;$(document).keydown(function(e){if(e.keyCode==39){context.nextImage();context.slideshow.stop();}else if(e.keyCode==37){context.prevImage();context.slideshow.stop();};});},initNextAndPrev:function(){this.next_link=$('<div class="gy-next"><div class="gy-next-image"></div></div>');this.prev_link=$('<div class="gy-prev"><div class="gy-prev-image"></div></div>');this.image_wrapper.append(this.next_link);this.image_wrapper.append(this.prev_link);var context=this;this.prev_link.add(this.next_link).mouseover(function(e){$(this).css('height',context.image_wrapper_height);$(this).find('div').show();}).mouseout(function(e){$(this).find('div').hide();}).click(function(){if($(this).is('.gy-next')){context.nextImage();context.slideshow.stop();}else{context.prevImage();context.slideshow.stop();};}).find('div').css('opacity',0.7);},initBackAndForward:function(){var context=this;this.scroll_forward=$('<div class="gy-forward"></div>');this.scroll_back=$('<div class="gy-back"></div>');this.nav.append(this.scroll_forward);this.nav.prepend(this.scroll_back);var has_scrolled=0;var thumbs_scroll_interval=false;$(this.scroll_back).add(this.scroll_forward).click(function(){var width=context.nav_display_width-50;if(context.settings.scroll_jump>0){var width=context.settings.scroll_jump;};if($(this).is('.gy-forward')){var left=context.thumbs_wrapper.scrollLeft()+width;}else{var left=context.thumbs_wrapper.scrollLeft()-width;};if(context.settings.slideshow.stop_on_scroll){context.slideshow.stop();};context.thumbs_wrapper.animate({scrollLeft:left+'px'});return false;}).css('opacity',0.6).hover(function(){var direction='left';if($(this).is('.gy-forward')){direction='right';};thumbs_scroll_interval=setInterval(function(){has_scrolled++;if(has_scrolled>30&&context.settings.slideshow.stop_on_scroll){context.slideshow.stop();};var left=context.thumbs_wrapper.scrollLeft()+1;if(direction=='left'){left=context.thumbs_wrapper.scrollLeft()-1;};context.thumbs_wrapper.scrollLeft(left);},10);$(this).css('opacity',1);},function(){has_scrolled=0;clearInterval(thumbs_scroll_interval);$(this).css('opacity',0.6);});},_afterShow:function(){this.gallery_info.html((this.current_index+1)+' / '+this.images.length);if(!this.settings.cycle){this.prev_link.show().css('height',this.image_wrapper_height);this.next_link.show().css('height',this.image_wrapper_height);if(this.current_index==(this.images.length-1)){this.next_link.hide();};if(this.current_index==0){this.prev_link.hide();};};this.fireCallback(this.settings.callbacks.afterImageVisible);},_getContainedImageSize:function(image_width,image_height){if(image_height>this.image_wrapper_height){var ratio=image_width/image_height;image_height=this.image_wrapper_height;image_width=this.image_wrapper_height*ratio;};if(image_width>this.image_wrapper_width){var ratio=image_height/image_width;image_width=this.image_wrapper_width;image_height=this.image_wrapper_width*ratio;};return{width:image_width,height:image_height};},_centerImage:function(img_container,image_width,image_height){img_container.css('top','0px');if(image_height<this.image_wrapper_height){var dif=this.image_wrapper_height-image_height;img_container.css('top',(dif/2)+'px');};img_container.css('left','0px');if(image_width<this.image_wrapper_width){var dif=this.image_wrapper_width-image_width;img_container.css('left',(dif/2)+'px');};},_getDescription:function(image){var desc=false;if(image.desc.length||image.title.length){var title='';if(image.title.length){title='<strong class="gy-description-title">'+image.title+'</strong>';};var desc='';if(image.desc.length){desc='<span>'+image.desc+'</span>';};desc=$('<p class="gy-image-description">'+title+desc+'</p>');};return desc;},showImage:function(index,callback){if(this.images[index]&&!this.in_transition){var context=this;var image=this.images[index];this.in_transition=true;if(!image.preloaded){this.loading(true);this.preloadImage(index,function(){context.loading(false);context._showWhenLoaded(index,callback);});}else{this._showWhenLoaded(index,callback);};};},_showWhenLoaded:function(index,callback){if(this.images[index]){var context=this;var image=this.images[index];var img_container=$(document.createElement('div')).addClass('gy-image');var img=$(new Image()).attr('src',image.image);if(image.link){var link=$('<a href="'+image.link+'" target="_blank"></a>');link.append(img);img_container.append(link);}else{img_container.append(img);}
this.image_wrapper.prepend(img_container);var size=this._getContainedImageSize(image.size.width,image.size.height);img.attr('width',size.width);img.attr('height',size.height);img_container.css({width:size.width+'px',height:size.height+'px'});this._centerImage(img_container,size.width,size.height);var desc=this._getDescription(image,img_container);if(desc){if(!this.settings.description_wrapper){img_container.append(desc);var width=size.width-parseInt(desc.css('padding-left'),10)-parseInt(desc.css('padding-right'),10);desc.css('width',width+'px');}else{this.settings.description_wrapper.append(desc);}};this.highLightThumb(this.nav.find('.gy-thumb'+index));var direction='right';if(this.current_index<index){direction='left';};this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var animation_speed=this.settings.animation_speed;var easing='swing';var animation=this.animations[this.settings.effect].call(this,img_container,direction,desc);if(typeof animation.speed!='undefined'){animation_speed=animation.speed;};if(typeof animation.easing!='undefined'){easing=animation.easing;};if(this.current_image){var old_image=this.current_image;var old_description=this.current_description;old_image.animate(animation.old_image,animation_speed,easing,function(){old_image.remove();if(old_description)old_description.remove();});};img_container.animate(animation.new_image,animation_speed,easing,function(){context.current_index=index;context.current_image=img_container;context.current_description=desc;context.in_transition=false;context._afterShow();context.fireCallback(callback);});}else{this.current_index=index;this.current_image=img_container;context.current_description=desc;this.in_transition=false;context._afterShow();this.fireCallback(callback);};};},nextIndex:function(){if(this.current_index==(this.images.length-1)){if(!this.settings.cycle){return false;};var next=0;}else{var next=this.current_index+1;};return next;},nextImage:function(callback){var next=this.nextIndex();if(next===false)return false;this.preloadImage(next+1);this.showImage(next,callback);return true;},prevIndex:function(){if(this.current_index==0){if(!this.settings.cycle){return false;};var prev=this.images.length-1;}else{var prev=this.current_index-1;};return prev;},prevImage:function(callback){var prev=this.prevIndex();if(prev===false)return false;this.preloadImage(prev-1);this.showImage(prev,callback);return true;},preloadAll:function(){var context=this;var i=0;function preloadNext(){if(i<context.images.length){i++;context.preloadImage(i,preloadNext);};};context.preloadImage(i,preloadNext);},preloadImage:function(index,callback){if(this.images[index]){var image=this.images[index];if(!this.images[index].preloaded){var img=$(new Image());img.attr('src',image.image);if(!this.isImageLoaded(img[0])){this.preloads.append(img);var context=this;img.load(function(){image.preloaded=true;image.size={width:this.width,height:this.height};context.fireCallback(callback);}).error(function(){image.error=true;image.preloaded=false;image.size=false;});}else{image.preloaded=true;image.size={width:img[0].width,height:img[0].height};this.fireCallback(callback);};}else{this.fireCallback(callback);};};},isImageLoaded:function(img){if(typeof img.complete!='undefined'&&!img.complete){return false;};if(typeof img.naturalWidth!='undefined'&&img.naturalWidth==0){return false;};return true;},highLightThumb:function(thumb){this.thumbs_wrapper.find('.gy-active').removeClass('gy-active');thumb.addClass('gy-active');if(this.settings.thumb_opacity<1){this.thumbs_wrapper.find('a:not(.gy-active) img').fadeTo(300,this.settings.thumb_opacity);thumb.find('img').fadeTo(300,1);};var left=thumb[0].parentNode.offsetLeft;left-=(this.nav_display_width/2)-(thumb[0].offsetWidth/2);this.thumbs_wrapper.animate({scrollLeft:left+'px'});},fireCallback:function(fn){if($.isFunction(fn)){fn.call(this);};}};function AdGallerySlideshow(nextimage_callback,settings){this.init(nextimage_callback,settings);};AdGallerySlideshow.prototype={start_link:false,stop_link:false,countdown:false,controls:false,settings:false,nextimage_callback:false,enabled:false,running:false,countdown_interval:false,init:function(nextimage_callback,settings){var context=this;this.nextimage_callback=nextimage_callback;this.settings=settings;},create:function(){this.start_link=$('<span class="gy-slideshow-start">'+this.settings.start_label+'</span>');this.stop_link=$('<span class="gy-slideshow-stop">'+this.settings.stop_label+'</span>');this.countdown=$('<span class="gy-slideshow-countdown"></span>');this.controls=$('<div class="gy-slideshow-controls"></div>');this.controls.append(this.start_link).append(this.stop_link).append(this.countdown);this.countdown.hide();var context=this;this.start_link.click(function(){context.start();});this.stop_link.click(function(){context.stop();});$(document).keydown(function(e){if(e.keyCode==83){if(context.running){context.stop();}else{context.start();};};});return this.controls;},disable:function(){this.enabled=false;this.stop();this.controls.hide();},enable:function(){this.enabled=true;this.controls.show();},toggle:function(){if(this.enabled){this.disable();}else{this.enable();};},start:function(){if(this.running||!this.enabled)return false;var context=this;this.running=true;this.controls.addClass('gy-slideshow-running');this._next();this.fireCallback(this.settings.onStart);return true;},stop:function(){if(!this.running)return false;this.running=false;this.countdown.hide();this.controls.removeClass('gy-slideshow-running');clearInterval(this.countdown_interval);this.fireCallback(this.settings.onStop);return true;},_next:function(){var context=this;var pre=this.settings.countdown_prefix;var su=this.settings.countdown_sufix;clearInterval(context.countdown_interval);this.countdown.show().html(pre+(this.settings.speed/1000)+su);var slide_timer=0;this.countdown_interval=setInterval(function(){slide_timer+=1000;if(slide_timer>=context.settings.speed){var whenNextIsShown=function(){if(context.running){context._next();};slide_timer=0;};if(!context.nextimage_callback(whenNextIsShown)){context.stop();};slide_timer=0;};var sec=parseInt(context.countdown.text().replace(/[^0-9]/g,''),10);sec--;if(sec>0){context.countdown.html(pre+sec+su);};},1000);},fireCallback:function(fn){if($.isFunction(fn)){fn.call(this);};}};});;define('tour_amd/tour_side',['jquery'],function($){var exports={};var proListv3=proListv3||{};proListv3={init:function(){proListv3.showBookingTips();proListv3.floatTab();proListv3.hoverHotLine();},showBookingTips:function(){$('.icon_tip').on({mouseenter:function(){utip=$(this).next('.popTip');if(utip.length){$('.popBox').length>0?tip=$('.popBox'):tip=$('<div class="popBox"></div>').appendTo('body');tip.html(utip.html());tip.show();}},mouseleave:function(){tip=$('.popBox')
if(tip.length){tip.hide();}},mousemove:function(e){tip=$('.popBox')
if(tip.length){var mousex=e.pageX+20;var mousey=e.pageY;var tipWidth=tip.outerWidth();var tipHeight=tip.outerHeight();var tipVisX=$(window).width()-(mousex+tipWidth);var tipVisY=$(window).height()-(mousey+tipHeight);if(tipVisX<20){mousex=e.pageX-tipWidth-20;}
if(tipVisY<0){mousey=e.pageY-tipHeight;}
tip.css({top:mousey,left:mousex});}}})},floatTab:function(){var tab=$('.floattabcontainer'),tabbox=tab.children('.float-tab');if(tab.length==0){return false;}
var isIE6=$.browser.msie&&$.browser.version=="6.0",tab=$('.floattabcontainer'),content=$('.contentbox'),item=content.find('.diytour_new');var _t=tab.offset().top,_top,_bottom;tabbox.find('li').click(function(){$(this).addClass('cur').siblings().removeClass('cur');if(content.find('.diytour_new[tabrel="'+$(this).attr('rel')+'"]').length>0){var pos=content.find('.diytour_new[tabrel="'+$(this).attr('rel')+'"]').offset().top;$('body,html').animate({'scrollTop':pos},200);}});var heightArr=[],timer;$(window).scroll(function(){clearTimeout(timer);timer=setTimeout(function(){act();},30);});function act(){_t=content.offset().top;_bottom=content.offset().top+content.height();_top=$(window).scrollTop();if(!isIE6){if(_top>_t&&_top<_bottom){tab.slideDown(100).css({'position':'fixed','top':0,'left':tab.offset().left-$(window).scrollLeft()});}else{tab.hide().css({'position':'static','top':0});}}
item.each(function(i){heightArr=[];if($(this).offset().top<_top+40){heightArr[i]=$(this).attr('tabrel');tabbox.find('li[rel="'+heightArr.pop()+'"]').addClass('cur').siblings().removeClass('cur');}})}},hoverHotLine:function(){$(".showPic li").live("mouseenter",function(){if($(this).index()!==0){var firstLi=$(this).parent().find("li:first");$(".pic",firstLi).stop(true,true).animate({width:"0px"});$(".des",firstLi).stop(true,true).animate({width:"125px",marginLeft:"25px"});$(firstLi).removeClass("cur");}
$(this).addClass("cur");$(".pic",this).stop(true,true).animate({width:"70px"});$(".des",this).stop(true,true).animate({width:"82px",marginLeft:"8px"});});$(".showPic li").live("mouseleave",function(){var firstLi=$(this).parent().find("li:first");$(firstLi).addClass("cur");$(".pic",firstLi).stop(true,true).animate({width:"70px"});$(".des",firstLi).stop(true,true).animate({width:"82px",marginLeft:"8px"});if($(this).index()!==0){$(".pic",this).stop(true,true).animate({width:"0px"});$(".des",this).stop(true,true).animate({width:"125px",marginLeft:"25px"});$(this).removeClass("cur");}});$('.showPic .c').live('mouseleave',function(){var firstLi=$(this).find("li:first");$(firstLi).addClass("cur");$(".pic",firstLi).stop(true,true).animate({width:"70px"});$(".des",firstLi).stop(true,true).animate({width:"82px",marginLeft:"8px"});});}};exports.init=proListv3.init;return exports;});;define('tour_amd/tabScroll',['jquery','common_amd/tool'],function($,tool){var exports={};var init;function pkgTabScroll(){var bd_li=$("#pkg-detail-tab-bd").children("li");var pkg_tab=$("#pkg-detail-tab-bd").offset().top;var pkg_tab_hand=$(".pkg-detail-tab");var pkg_box=$(".pkg-detail-box");var status;pkg_tab_hand.find('li').click(function(){$(this).stop(true);var $pkg_li=$(this).index();var p_infor=$("#general_infor").find("div.pkg-detail-infor").eq($pkg_li).offset().top-30;$('html, body').animate({scrollTop:p_infor},500);return false;});if($.browser.msie&&$.browser.version=="6.0"){return false;}else{$(window).scroll(tool.event.debounce(function(){var rect=pkg_box[0].getBoundingClientRect();var pkg_info;if(rect.top>50){status=undefined;pkg_tab_hand.css({"position":"static"})}else{pkg_info=pkg_box.find(".pkg-detail-infor");$.each(pkg_info,function(i,item){if(status===i)return;if(item.getBoundingClientRect().top<50){if(!pkg_info[i+1]||pkg_info[i+1].getBoundingClientRect().top>50){bd_li.siblings().removeClass("current");bd_li.eq(i).addClass("current");var s_top=$(window).scrollTop();autopos(pkg_tab_hand);status=i;return false;}}});}}));}}
function autopos(p_h){if($.browser.msie&&$.browser.version=="6.0"){return false;}else{p_h.css({"position":"fixed","top":0})}}
init=function(){init=function(){};pkgTabScroll();};exports.init=init;return exports;});;define('tour_amd/tour_main',['jquery','tour_amd/jquery.gallery'],function($){var exports={};var init;var tourMain=tourMain||{};var pkg_isIE6=$.browser.msie&&$.browser.version=='6.0';tourMain={init:function(){tourMain.simulateSelect(".select_city",".select_list",".select_result");tourMain.simulateSelect(".select_date",".select_list",".select_result");tourMain.simulateSelect(".select_date",".s_list",".s_con");tourMain.simulateSelect(".select_adult",".s_alist",".s_acon");tourMain.simulateSelect(".select_child",".s_list",".s_ccon");tourMain.tipsShow('illustration',true);tourMain.tipsShow('fenqiAbout');tourMain.tipsShow('abhor',true);tourMain.tipsShow('adjutant');tourMain.tipsShow('comment');tourMain.tipsShow('youji',true);tourMain.tipsShow('niudaojia');tourMain.tipsShow('fenqi',true);tourMain.tipsShow('free_wifi',true);tourMain.tipsShow('nWireless',true);tourMain.tipsShow('duobaobi',true);tourMain.switchIndex("#youhuiLink","#pkg-detail-tab-bd");tourMain.chuyouNumClick($("#adA-le"),$("#adA-ri"),$("#adultN"),1);tourMain.chuyouNumClick($("#adC-le"),$("#adC-ri"),$("#childN"),0);tourMain.expandInfo('recombox-d',$('.phy-book .recombox'),184-$(".recmark").height());tourMain.showMoreTuijian();tourMain.resizeScreen();tourMain.gallery();tourMain.changeTab("#city_menu_nav li","#city_menu_con .city_menu_item","cur","hover");},simulateSelect:function(box,list,result){$(box).hover(function(){$(this).addClass("select_hover");},function(){$(this).removeClass("select_hover");})
$("li",box).live("click",function(){var _this=$(this);var _parent=_this.parents(box).eq(0);var _result=_parent.find(result);_result.html(_this.html());if(_result.hasClass("grey")){_result.removeClass("grey");}
_parent.removeClass("select_hover");})},scrollText:function(){if($("#ub_wrap").find("li").length>0){var marquee=new ScrollText("ub_wrap");marquee.LineHeight=30;marquee.Amount=1;marquee.Timeout=1000;marquee.Delay=30;marquee.Start();}},tipsShow:function(handler,holder){var o=$("."+handler),target=$("."+handler+"_hover");var _z=target.find(".z");var _y=target.find(".y");var showing=false,timer;o.hover(function(){showing=true;clearTimeout(timer);var aWidth=$(this).width();var _t=$(this).height()<20?24:$(this).height()+10;var top=$(this).offset().top+_t;var left=$(this).offset().left-(target.width()-$(this).width())/2;if(handler=='adjutant'&&$(window).width()<1200){left=left-49;$('.z,.y').css("left",175);}
target.show().css({'top':top,'left':left,'z-index':5000});_z.css('left',(target.width()-_z.width())/2);_y.css('left',(target.width()-_y.width())/2);if($(this).attr('rel-data')){target.find('p').text($(this).attr('rel-data'));}},function(){showing=false;if(holder){if(!showing){timer=setTimeout(function(){target.hide();},100)}}else{target.hide();}});if(holder){target.hover(function(){showing=true;clearTimeout(timer);},function(){showing=false;if(!showing){timer=setTimeout(function(){target.hide();},200)}})}},switchIndex:function(nav,content){$(nav).click(function(){var $content=$(content);$('html,body').animate({scrollTop:$content.offset().top},1500);})},chuyouNumClick:function(minus,plus,_input,num){var i=parseInt(_input.val(),10);plus.click(function(){i++;_input.val(i);if(i>1){minus.addClass("on");}else{minus.removeClass("on");}})
minus.click(function(){if(i<=num){minus.removeClass("on");return false;}
i--;_input.val(i);})},expandInfo:function(cls,box,h){setTimeout(function(){var outHeight=$("#recombox").height()||0;var innerHeight=$("#recomInnerBox").height()||0;if(innerHeight<outHeight){}else{$(".showallbtn").show();box.hover(function(){$(this).css({'height':'auto','z-index':100});},function(){$(this).css('height',96);})}},200);box.css('height',96);},showMoreTuijian:function(){var o=$("#tuijian_btn");o.live("click",function(){var _this=$(this);if(!_this.hasClass("show")){_this.addClass("show");_this.next(".hot_line").addClass("on");}else{_this.removeClass("show");_this.next(".hot_line").removeClass("on");}})},gallery:function(){$(".gallery_con").children().eq(0).html($("#galleryCon").children().eq(0).html());$('#gallery').gyGallery({"width":500,"height":280});$("#gallery_nav li").click(function(){var $tab=$(this);var tab_index=$tab.index();var $content=$(".gallery_con").children();$("#gallery_nav li").removeClass("on");$tab.addClass("on");$content.empty();$content.eq(tab_index).html($("#galleryCon").children().eq(tab_index).html());$('#gallery').gyGallery({"width":500,"height":280});})},resizeScreen:function(){var index1200=$("#index1200");$("#tuijianRouteMore").css("right",($(window).width()-1000)/2+20);if(!tourMain.isBigThan1280()){index1200.removeClass("index1200").addClass("index1000");}else{index1200.removeClass("index1000").addClass("index1200");}
$(window).resize(function(){var w_wd=$(window).width();$("#tuijianRouteMore").css("right",(w_wd-1000)/2+20);$(window).trigger("scroll");if(!tourMain.isBigThan1280()){if(!index1200.hasClass("index1000")){index1200.removeClass("index1200").addClass("index1000");}}else{if(!index1200.hasClass("index1200")){index1200.removeClass("index1000").addClass("index1200");}}});},isIE6:function(){if($.browser.msie&&$.browser.version==6){return true;}else{return false;}},isBigThan1280:function(){var w_wd=$(window).width();if(w_wd>=1280){return true;}else{return false;}},changeTab:function(nav,con,on,type){$(nav).on(type,function(){var _this=$(this);var _index=_this.index();_this.addClass(on).siblings().removeClass(on);$(con).hide();$(con).eq(_index).show();})}};init=function(){tourMain.init();setTimeout(function(){$("#gallery_nav li.on").trigger("click")},500);};exports.init=init;return exports;});;define('tour_amd/general_infor',['jquery'],function($){var exports={};var pkgDetailInfor=pkgDetailInfor||{};pkgDetailInfor={init:function(){pkgDetailInfor.autocomp("#now_yuding");},autocomp:function(o){$(o).click(function(){$("html,body").animate({"scrollTop":160},600);})}};function tabScroll(){var sidebarPrv=$("#tripall .sidebarPrv");var ie6=$.browser.msie&&$.browser.version=="6.0";if(!sidebarPrv.length)return;if(ie6)return;var sidebar=sidebarPrv.children(".sidebar");var len=sidebar.children('a').size();var _height=len*35;var _top;var _s=sidebarPrv.offset().top-60;var ydxzTop=$('#xcjs').find(".btcircle").offset().top;var dayHei=ydxzTop-_height;var contentIdList=[];sidebar.find("a").each(function(){contentIdList.push($($(this)[0]).attr("rel"));})
sidebar.find('a').click(function(){$(this).stop(true,true);$(this).addClass('current').siblings().removeClass('current');var $day_li=$(this).index();var d_infor=$("#tripall").find("div.tripdays").eq($day_li).offset().top-44;$('html, body').animate({scrollTop:d_infor},500);return false;});var _status=100;state_=false;function iday(){_top=$(window).scrollTop();if(_s<_top&&dayHei>_top){sidebar.css({'position':'fixed','top':44});state_=false;}else if(dayHei<_top&&ydxzTop>_top){sidebar.css({'position':'absolute','top':dayHei-_s-60});}else{sidebar.removeAttr('style');state_=true;}
if(!state_){scrollDay();}}
function scrollDay(){$.each(contentIdList,function(i,list){var topCurr=$("#"+list).offset().top-50;if(i<contentIdList.length-1){var topNext=$("#"+contentIdList[i+1]).offset().top-50;if(_top>=topCurr&&_top<topNext){sidebar.find("a").eq(i).addClass("current").siblings().removeClass("current");return false;}
if(_top<topCurr){sidebar.find("a").eq(0).addClass("current").siblings().removeClass("current");return false;}}else{sidebar.find("a").eq(i).addClass("current").siblings().removeClass("current");}});}
$(window).scroll(iday);}
var init=function(){pkgDetailInfor.init();tabScroll();};exports.init=init;return exports;});;define('tour_amd/fullcalendar-min_add',['jquery'],function($){var defaults={defaultView:'month',aspectRatio:1.35,header:{left:'title',center:'',right:'today prev,next'},weekends:true,allDayDefault:true,ignoreTimezone:true,lazyFetching:true,startParam:'start',endParam:'end',titleFormat:{month:'MMMM yyyy',week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:'dddd, MMM d, yyyy'},columnFormat:{month:'ddd',week:'ddd M/d',day:'dddd M/d'},timeFormat:{'':'h(:mm)t'},isRTL:false,firstDay:0,monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],buttonText:{prev:'&nbsp;&#9668;&nbsp;',next:'&nbsp;&#9658;&nbsp;',prevYear:'&nbsp;&lt;&lt;&nbsp;',nextYear:'&nbsp;&gt;&gt;&nbsp;',today:'today',month:'month',week:'week',day:'day'},theme:false,buttonIcons:{prev:'circle-triangle-w',next:'circle-triangle-e'},unselectAuto:true,dropAccept:'*'};var rtlDefaults={header:{left:'next,prev today',center:'',right:'title'},buttonText:{prev:'&nbsp;&#9658;&nbsp;',next:'&nbsp;&#9668;&nbsp;',prevYear:'&nbsp;&gt;&gt;&nbsp;',nextYear:'&nbsp;&lt;&lt;&nbsp;'},buttonIcons:{prev:'circle-triangle-e',next:'circle-triangle-w'}};var fc=$.fullCalendar={version:"1.5.3"};var fcViews=fc.views={};$.fn.fullCalendar=function(options){if(typeof options=='string'){var args=Array.prototype.slice.call(arguments,1);var res;this.each(function(){var calendar=$.data(this,'fullCalendar');if(calendar&&$.isFunction(calendar[options])){var r=calendar[options].apply(calendar,args);if(res===undefined){res=r}
if(options=='destroy'){$.removeData(this,'fullCalendar')}}});if(res!==undefined){return res}
return this}
var eventSources=options.eventSources||[];delete options.eventSources;if(options.events){eventSources.push(options.events);delete options.events}
options=$.extend(true,{},defaults,(options.isRTL||options.isRTL===undefined&&defaults.isRTL)?rtlDefaults:{},options);this.each(function(i,_element){var element=$(_element);var calendar=new Calendar(element,options,eventSources);element.data('fullCalendar',calendar);calendar.render()});return this};function setDefaults(d){$.extend(true,defaults,d)}
function Calendar(element,options,eventSources){var t=this;t.options=options;t.render=render;t.destroy=destroy;t.refetchEvents=refetchEvents;t.reportEvents=reportEvents;t.reportEventChange=reportEventChange;t.rerenderEvents=rerenderEvents;t.changeView=changeView;t.select=select;t.unselect=unselect;t.prev=prev;t.next=next;t.prevYear=prevYear;t.nextYear=nextYear;t.today=today;t.gotoDate=gotoDate;t.incrementDate=incrementDate;t.formatDate=function(format,date){return formatDate(format,date,options)};t.formatDates=function(format,date1,date2){return formatDates(format,date1,date2,options)};t.getDate=getDate;t.getView=getView;t.option=option;t.trigger=trigger;EventManager.call(t,options,eventSources);var isFetchNeeded=t.isFetchNeeded;var fetchEvents=t.fetchEvents;var _element=element[0];var header;var headerElement;var content;var tm;var currentView;var viewInstances={};var elementOuterWidth;var suggestedViewHeight;var absoluteViewElement;var resizeUID=0;var ignoreWindowResize=0;var date=new Date();var events=[];var _dragElement;setYMD(date,options.year,options.month,options.date);function render(inc){if(!content){initialRender()}else{calcSize();markSizesDirty();markEventsDirty();renderView(inc)}}
function initialRender(){tm=options.theme?'ui':'fc';element.addClass('fc');if(options.isRTL){element.addClass('fc-rtl')}
if(options.theme){element.addClass('ui-widget')}
content=$("<div class='fc-content' style='position:relative'/>").prependTo(element);header=new Header(t,options);headerElement=header.render();if(headerElement){element.prepend(headerElement)}
changeView(options.defaultView);$(window).resize(windowResize);if(!bodyVisible()){lateRender()}}
function lateRender(){setTimeout(function(){if(!currentView.start&&bodyVisible()){renderView()}},0)}
function destroy(){$(window).unbind('resize',windowResize);header.destroy();content.remove();element.removeClass('fc fc-rtl ui-widget')}
function elementVisible(){return _element.offsetWidth!==0}
function bodyVisible(){return $('body')[0].offsetWidth!==0}
function changeView(newViewName){if(!currentView||newViewName!=currentView.name){ignoreWindowResize++;unselect();var oldView=currentView;var newViewElement;if(oldView){(oldView.beforeHide||noop)();setMinHeight(content,content.height());oldView.element.hide()}else{setMinHeight(content,1)}
content.css('overflow','hidden');currentView=viewInstances[newViewName];if(currentView){currentView.element.show()}else{currentView=viewInstances[newViewName]=new fcViews[newViewName](newViewElement=absoluteViewElement=$("<div class='fc-view fc-view-"+newViewName+"' style='position:absolute'/>").appendTo(content),t)}if(oldView){header.deactivateButton(oldView.name)}
header.activateButton(newViewName);renderView();content.css('overflow','');if(oldView){setMinHeight(content,1)}
if(!newViewElement){(currentView.afterShow||noop)()}
ignoreWindowResize--}}
function renderView(inc){if(elementVisible()){ignoreWindowResize++;unselect();if(suggestedViewHeight===undefined){calcSize()}
var forceEventRender=false;if(!currentView.start||inc||date<currentView.start||date>=currentView.end){currentView.render(date,inc||0);setSize(true);forceEventRender=true}else if(currentView.sizeDirty){currentView.clearEvents();setSize();forceEventRender=true}else if(currentView.eventsDirty){currentView.clearEvents();forceEventRender=true}
currentView.sizeDirty=false;currentView.eventsDirty=false;updateEvents(forceEventRender);elementOuterWidth=element.outerWidth();header.updateTitle(currentView.title);var today=new Date();if(today>=currentView.start&&today<currentView.end){header.disableButton('today')}else{header.enableButton('today')}
ignoreWindowResize--;currentView.trigger('viewDisplay',_element)}}
function updateSize(){markSizesDirty();if(elementVisible()){calcSize();setSize();unselect();currentView.clearEvents();currentView.renderEvents(events);currentView.sizeDirty=false}}
function markSizesDirty(){$.each(viewInstances,function(i,inst){inst.sizeDirty=true})}
function calcSize(){if(options.contentHeight){suggestedViewHeight=options.contentHeight}else if(options.height){suggestedViewHeight=options.height-(headerElement?headerElement.height():0)-vsides(content)}else{suggestedViewHeight=Math.round(content.width()/Math.max(options.aspectRatio,.5))}}
function setSize(dateChanged){ignoreWindowResize++;currentView.setHeight(suggestedViewHeight,dateChanged);if(absoluteViewElement){absoluteViewElement.css('position','relative');absoluteViewElement=null}
currentView.setWidth(content.width(),dateChanged);ignoreWindowResize--}
function windowResize(){if(!ignoreWindowResize){if(currentView.start){var uid=++resizeUID;setTimeout(function(){if(uid==resizeUID&&!ignoreWindowResize&&elementVisible()){if(elementOuterWidth!=(elementOuterWidth=element.outerWidth())){ignoreWindowResize++;updateSize();currentView.trigger('windowResize',_element);ignoreWindowResize--}}},200)}else{lateRender()}}}
function updateEvents(forceRender){if(!options.lazyFetching||isFetchNeeded(currentView.visStart,currentView.visEnd)){refetchEvents()}else if(forceRender){rerenderEvents()}}
function refetchEvents(){fetchEvents(currentView.visStart,currentView.visEnd)}
function reportEvents(_events){events=_events;rerenderEvents()}
function reportEventChange(eventID){rerenderEvents(eventID)}
function rerenderEvents(modifiedEventID){markEventsDirty();if(elementVisible()){currentView.clearEvents();currentView.renderEvents(events,modifiedEventID);currentView.eventsDirty=false}}
function markEventsDirty(){$.each(viewInstances,function(i,inst){inst.eventsDirty=true})}
function select(start,end,allDay){currentView.select(start,end,allDay===undefined?true:allDay)}
function unselect(){if(currentView){currentView.unselect()}}
function prev(){renderView(-1)}
function next(){renderView(1)}
function prevYear(){addYears(date,-1);renderView()}
function nextYear(){addYears(date,1);renderView()}
function today(){date=new Date();renderView()}
function gotoDate(year,month,dateOfMonth){if(year instanceof Date){date=cloneDate(year)}else{setYMD(date,year,month,dateOfMonth)}
renderView()}
function incrementDate(years,months,days){if(years!==undefined){addYears(date,years)}
if(months!==undefined){addMonths(date,months)}
if(days!==undefined){addDays(date,days)}
renderView()}
function getDate(){return cloneDate(date)}
function getView(){return currentView}
function option(name,value){if(value===undefined){return options[name]}
if(name=='height'||name=='contentHeight'||name=='aspectRatio'){options[name]=value;updateSize()}}
function trigger(name,thisObj){if(options[name]){return options[name].apply(thisObj||_element,Array.prototype.slice.call(arguments,2))}}
if(options.droppable){$(document).bind('dragstart',function(ev,ui){var _e=ev.target;var e=$(_e);if(!e.parents('.fc').length){var accept=options.dropAccept;if($.isFunction(accept)?accept.call(_e,e):e.is(accept)){_dragElement=_e;currentView.dragStart(_dragElement,ev,ui)}}}).bind('dragstop',function(ev,ui){if(_dragElement){currentView.dragStop(_dragElement,ev,ui);_dragElement=null}})}}
function Header(calendar,options){var t=this;t.render=render;t.destroy=destroy;t.updateTitle=updateTitle;t.activateButton=activateButton;t.deactivateButton=deactivateButton;t.disableButton=disableButton;t.enableButton=enableButton;var element=$([]);var tm;function render(){tm=options.theme?'ui':'fc';var sections=options.header;if(sections){element=$("<table class='fc-header' style='width:100%'/>").append($("<tr/>").append(renderSection('left')).append(renderSection('center')).append(renderSection('right')));return element}}
function destroy(){element.remove()}
function renderSection(position){var e=$("<td class='fc-header-"+position+"'/>");var buttonStr=options.header[position];if(buttonStr){$.each(buttonStr.split(' '),function(i){if(i>0){e.append("<span class='fc-header-space'/>")}
var prevButton;$.each(this.split(','),function(j,buttonName){if(buttonName=='title'){e.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>");if(prevButton){prevButton.addClass(tm+'-corner-right')}
prevButton=null}else{var buttonClick;if(calendar[buttonName]){buttonClick=calendar[buttonName]}else if(fcViews[buttonName]){buttonClick=function(){button.removeClass(tm+'-state-hover');calendar.changeView(buttonName)}}
if(buttonClick){var icon=options.theme?smartProperty(options.buttonIcons,buttonName):null;var text=smartProperty(options.buttonText,buttonName);var button=$("<span class='fc-button fc-button-"+buttonName+" "+tm+"-state-default'><span class='fc-button-inner'><span class='fc-button-content'>"+(icon?"<span class='fc-icon-wrap'><span class='ui-icon ui-icon-"+icon+"'/></span>":text)+"</span><span class='fc-button-effect'><span></span></span></span></span>");if(button){button.click(function(){if(!button.hasClass(tm+'-state-disabled')){buttonClick()}}).mousedown(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-down')}).mouseup(function(){button.removeClass(tm+'-state-down')}).hover(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-hover')},function(){button.removeClass(tm+'-state-hover').removeClass(tm+'-state-down')}).appendTo(e);if(!prevButton){button.addClass(tm+'-corner-left')}
prevButton=button}}}});if(prevButton){prevButton.addClass(tm+'-corner-right')}})}
return e}
function updateTitle(html){element.find('h2').html(reSpellDate(html));}
function reSpellDate(tn_date){return tn_date.replace(/\s+/g,"").split("��").reverse().join(".");}
function activateButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-active')}
function deactivateButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-active')}
function disableButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-disabled')}
function enableButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-disabled')}}
fc.sourceNormalizers=[];fc.sourceFetchers=[];var ajaxDefaults={dataType:'json',cache:false};var eventGUID=1;function EventManager(options,_sources){var t=this;t.isFetchNeeded=isFetchNeeded;t.fetchEvents=fetchEvents;t.addEventSource=addEventSource;t.removeEventSource=removeEventSource;t.updateEvent=updateEvent;t.renderEvent=renderEvent;t.removeEvents=removeEvents;t.clientEvents=clientEvents;t.normalizeEvent=normalizeEvent;var trigger=t.trigger;var getView=t.getView;var reportEvents=t.reportEvents;var stickySource={events:[]};var sources=[stickySource];var rangeStart,rangeEnd;var currentFetchID=0;var pendingSourceCnt=0;var loadingLevel=0;var cache=[];for(var i=0;i<_sources.length;i++){_addEventSource(_sources[i])}
function isFetchNeeded(start,end){return!rangeStart||start<rangeStart||end>rangeEnd}
function fetchEvents(start,end){rangeStart=start;rangeEnd=end;cache=[];var fetchID=++currentFetchID;var len=sources.length;pendingSourceCnt=len;for(var i=0;i<len;i++){fetchEventSource(sources[i],fetchID)}}
function fetchEventSource(source,fetchID){_fetchEventSource(source,function(events){if(fetchID==currentFetchID){if(events){for(var i=0;i<events.length;i++){events[i].source=source;normalizeEvent(events[i])}
cache=cache.concat(events)}
pendingSourceCnt--;if(!pendingSourceCnt){reportEvents(cache)}}})}
function _fetchEventSource(source,callback){var i;var fetchers=fc.sourceFetchers;var res;for(i=0;i<fetchers.length;i++){res=fetchers[i](source,rangeStart,rangeEnd,callback);if(res===true){return}else if(typeof res=='object'){_fetchEventSource(res,callback);return}}
var events=source.events;if(events){if($.isFunction(events)){pushLoading();events(cloneDate(rangeStart),cloneDate(rangeEnd),function(events){callback(events);popLoading()})}else if($.isArray(events)){callback(events)}else{callback()}}else{var url=source.url;if(url){var success=source.success;var error=source.error;var complete=source.complete;var data=$.extend({},source.data||{});var startParam=firstDefined(source.startParam,options.startParam);var endParam=firstDefined(source.endParam,options.endParam);if(startParam){data[startParam]=Math.round(+rangeStart/1000)}
if(endParam){data[endParam]=Math.round(+rangeEnd/1000)}
pushLoading();$.ajax($.extend({},ajaxDefaults,source,{data:data,success:function(events){events=events||[];var res=applyAll(success,this,arguments);if($.isArray(res)){events=res}
callback(events)},error:function(){applyAll(error,this,arguments);callback()},complete:function(){applyAll(complete,this,arguments);popLoading()}}))}else{callback()}}}
function addEventSource(source){source=_addEventSource(source);if(source){pendingSourceCnt++;fetchEventSource(source,currentFetchID)}}
function _addEventSource(source){if($.isFunction(source)||$.isArray(source)){source={events:source}}else if(typeof source=='string'){source={url:source}}
if(typeof source=='object'){normalizeSource(source);sources.push(source);return source}}
function removeEventSource(source){sources=$.grep(sources,function(src){return!isSourcesEqual(src,source)});cache=$.grep(cache,function(e){return!isSourcesEqual(e.source,source)});reportEvents(cache)}
function updateEvent(event){var i,len=cache.length,e,defaultEventEnd=getView().defaultEventEnd,startDelta=event.start-event._start,endDelta=event.end?(event.end-(event._end||defaultEventEnd(event))):0;for(i=0;i<len;i++){e=cache[i];if(e._id==event._id&&e!=event){e.start=new Date(+e.start+startDelta);if(event.end){if(e.end){e.end=new Date(+e.end+endDelta)}else{e.end=new Date(+defaultEventEnd(e)+endDelta)}}else{e.end=null}
e.title=event.title;e.url=event.url;e.allDay=event.allDay;e.className=event.className;e.editable=event.editable;e.color=event.color;e.backgroudColor=event.backgroudColor;e.borderColor=event.borderColor;e.textColor=event.textColor;normalizeEvent(e)}}
normalizeEvent(event);reportEvents(cache)}
function renderEvent(event,stick){normalizeEvent(event);if(!event.source){if(stick){stickySource.events.push(event);event.source=stickySource}
cache.push(event)}
reportEvents(cache)}
function removeEvents(filter){if(!filter){cache=[];for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=[]}}}else{if(!$.isFunction(filter)){var id=filter+'';filter=function(e){return e._id==id}}
cache=$.grep(cache,filter,true);for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=$.grep(sources[i].events,filter,true)}}}
reportEvents(cache)}
function clientEvents(filter){if($.isFunction(filter)){return $.grep(cache,filter)}else if(filter){filter+='';return $.grep(cache,function(e){return e._id==filter})}
return cache}
function pushLoading(){if(!loadingLevel++){trigger('loading',null,true)}}
function popLoading(){if(!--loadingLevel){trigger('loading',null,false)}}
function normalizeEvent(event){var source=event.source||{};var ignoreTimezone=firstDefined(source.ignoreTimezone,options.ignoreTimezone);event._id=event._id||(event.id===undefined?'_fc'+eventGUID++:event.id+'');if(event.date){if(!event.start){event.start=event.date}
delete event.date}
event._start=cloneDate(event.start=parseDate(event.start,ignoreTimezone));event.end=parseDate(event.end,ignoreTimezone);if(event.end&&event.end<=event.start){event.end=null}
event._end=event.end?cloneDate(event.end):null;if(event.allDay===undefined){event.allDay=firstDefined(source.allDayDefault,options.allDayDefault)}
if(event.className){if(typeof event.className=='string'){event.className=event.className.split(/\s+/)}}else{event.className=[]}}
function normalizeSource(source){if(source.className){if(typeof source.className=='string'){source.className=source.className.split(/\s+/)}}else{source.className=[]}
var normalizers=fc.sourceNormalizers;for(var i=0;i<normalizers.length;i++){normalizers[i](source)}}
function isSourcesEqual(source1,source2){return source1&&source2&&getSourcePrimitive(source1)==getSourcePrimitive(source2)}
function getSourcePrimitive(source){return((typeof source=='object')?(source.events||source.url):'')||source}}
fc.addDays=addDays;fc.cloneDate=cloneDate;fc.parseDate=parseDate;fc.parseISO8601=parseISO8601;fc.parseTime=parseTime;fc.formatDate=formatDate;fc.formatDates=formatDates;var dayIDs=['sun','mon','tue','wed','thu','fri','sat'],DAY_MS=86400000,HOUR_MS=3600000,MINUTE_MS=60000;function addYears(d,n,keepTime){d.setFullYear(d.getFullYear()+n);if(!keepTime){clearTime(d)}
return d}
function addMonths(d,n,keepTime){if(+d){var m=d.getMonth()+n,check=cloneDate(d);check.setDate(1);check.setMonth(m);d.setMonth(m);if(!keepTime){clearTime(d)}
while(d.getMonth()!=check.getMonth()){d.setDate(d.getDate()+(d<check?1:-1))}}
return d}
function addDays(d,n,keepTime){if(+d){var dd=d.getDate()+n,check=cloneDate(d);check.setHours(9);check.setDate(dd);d.setDate(dd);if(!keepTime){clearTime(d)}
fixDate(d,check)}
return d}
function fixDate(d,check){if(+d){while(d.getDate()!=check.getDate()){d.setTime(+d+(d<check?1:-1)*HOUR_MS)}}}
function addMinutes(d,n){d.setMinutes(d.getMinutes()+n);return d}
function clearTime(d){d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);return d}
function cloneDate(d,dontKeepTime){if(dontKeepTime){return clearTime(new Date(+d))}
return new Date(+d)}
function zeroDate(){var i=0,d;do{d=new Date(1970,i++,1)}while(d.getHours());return d}
function skipWeekend(date,inc,excl){inc=inc||1;while(!date.getDay()||(excl&&date.getDay()==1||!excl&&date.getDay()==6)){addDays(date,inc)}
return date}
function dayDiff(d1,d2){return Math.round((cloneDate(d1,true)-cloneDate(d2,true))/DAY_MS)}
function setYMD(date,y,m,d){if(y!==undefined&&y!=date.getFullYear()){date.setDate(1);date.setMonth(0);date.setFullYear(y)}
if(m!==undefined&&m!=date.getMonth()){date.setDate(1);date.setMonth(m)}
if(d!==undefined){date.setDate(d)}}
function parseDate(s,ignoreTimezone){if(typeof s=='object'){return s}
if(typeof s=='number'){return new Date(s*1000)}
if(typeof s=='string'){if(s.match(/^\d+(\.\d+)?$/)){return new Date(parseFloat(s)*1000)}
if(ignoreTimezone===undefined){ignoreTimezone=true}
return parseISO8601(s,ignoreTimezone)||(s?new Date(s):null)}
return null}
function parseISO8601(s,ignoreTimezone){var m=s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!m){return null}
var date=new Date(m[1],0,1);if(ignoreTimezone||!m[13]){var check=new Date(m[1],0,1,9,0);if(m[3]){date.setMonth(m[3]-1);check.setMonth(m[3]-1)}
if(m[5]){date.setDate(m[5]);check.setDate(m[5])}
fixDate(date,check);if(m[7]){date.setHours(m[7])}
if(m[8]){date.setMinutes(m[8])}
if(m[10]){date.setSeconds(m[10])}
if(m[12]){date.setMilliseconds(Number("0."+m[12])*1000)}
fixDate(date,check)}else{date.setUTCFullYear(m[1],m[3]?m[3]-1:0,m[5]||1);date.setUTCHours(m[7]||0,m[8]||0,m[10]||0,m[12]?Number("0."+m[12])*1000:0);if(m[14]){var offset=Number(m[16])*60+(m[18]?Number(m[18]):0);offset*=m[15]=='-'?1:-1;date=new Date(+date+(offset*60*1000))}}
return date}
function parseTime(s){if(typeof s=='number'){return s*60}
if(typeof s=='object'){return s.getHours()*60+s.getMinutes()}
var m=s.match(/(\d+)(?::(\d+))?\s*(\w+)?/);if(m){var h=parseInt(m[1],10);if(m[3]){h%=12;if(m[3].toLowerCase().charAt(0)=='p'){h+=12}}
return h*60+(m[2]?parseInt(m[2],10):0)}}
function formatDate(date,format,options){return formatDates(date,null,format,options)}
function formatDates(date1,date2,format,options){options=options||defaults;var date=date1,otherDate=date2,i,len=format.length,c,i2,formatter,res='';for(i=0;i<len;i++){c=format.charAt(i);if(c=="'"){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)=="'"){if(date){if(i2==i+1){res+="'"}else{res+=format.substring(i+1,i2)}
i=i2}
break}}}else if(c=='('){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==')'){var subres=formatDate(date,format.substring(i+1,i2),options);if(parseInt(subres.replace(/\D/,''),10)){res+=subres}
i=i2;break}}}else if(c=='['){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==']'){var subformat=format.substring(i+1,i2);var subres=formatDate(date,subformat,options);if(subres!=formatDate(otherDate,subformat,options)){res+=subres}
i=i2;break}}}else if(c=='{'){date=date2;otherDate=date1}else if(c=='}'){date=date1;otherDate=date2}else{for(i2=len;i2>i;i2--){if(formatter=dateFormatters[format.substring(i,i2)]){if(date){res+=formatter(date,options)}
i=i2-1;break}}
if(i2==i){if(date){res+=c}}}}
return res};var dateFormatters={s:function(d){return d.getSeconds()},ss:function(d){return zeroPad(d.getSeconds())},m:function(d){return d.getMinutes()},mm:function(d){return zeroPad(d.getMinutes())},h:function(d){return d.getHours()%12||12},hh:function(d){return zeroPad(d.getHours()%12||12)},H:function(d){return d.getHours()},HH:function(d){return zeroPad(d.getHours())},d:function(d){return d.getDate()},dd:function(d){return zeroPad(d.getDate())},ddd:function(d,o){return o.dayNamesShort[d.getDay()]},dddd:function(d,o){return o.dayNames[d.getDay()]},M:function(d){return d.getMonth()+1},MM:function(d){return zeroPad(d.getMonth()+1)},MMM:function(d,o){return o.monthNamesShort[d.getMonth()]},MMMM:function(d,o){return o.monthNames[d.getMonth()]},yy:function(d){return(d.getFullYear()+'').substring(2)},yyyy:function(d){return d.getFullYear()},t:function(d){return d.getHours()<12?'a':'p'},tt:function(d){return d.getHours()<12?'am':'pm'},T:function(d){return d.getHours()<12?'A':'P'},TT:function(d){return d.getHours()<12?'AM':'PM'},u:function(d){return formatDate(d,"yyyy-MM-dd'T'HH:mm:ss'Z'")},S:function(d){var date=d.getDate();if(date>10&&date<20){return'th'}
return['st','nd','rd'][date%10-1]||'th'}};fc.applyAll=applyAll;function exclEndDay(event){if(event.end){return _exclEndDay(event.end,event.allDay)}else{return addDays(cloneDate(event.start),1)}}
function _exclEndDay(end,allDay){end=cloneDate(end);return allDay||end.getHours()||end.getMinutes()?addDays(end,1):clearTime(end)}
function segCmp(a,b){return(b.msLength-a.msLength)*100+(a.event.start-b.event.start)}
function segsCollide(seg1,seg2){return seg1.end>seg2.start&&seg1.start<seg2.end}
function sliceSegs(events,visEventEnds,start,end){var segs=[],i,len=events.length,event,eventStart,eventEnd,segStart,segEnd,isStart,isEnd;for(i=0;i<len;i++){event=events[i];eventStart=event.start;eventEnd=visEventEnds[i];if(eventEnd>start&&eventStart<end){if(eventStart<start){segStart=cloneDate(start);isStart=false}else{segStart=eventStart;isStart=true}if(eventEnd>end){segEnd=cloneDate(end);isEnd=false}else{segEnd=eventEnd;isEnd=true}
segs.push({event:event,start:segStart,end:segEnd,isStart:isStart,isEnd:isEnd,msLength:segEnd-segStart})}}
return segs.sort(segCmp)}
function stackSegs(segs){var levels=[],i,len=segs.length,seg,j,collide,k;for(i=0;i<len;i++){seg=segs[i];j=0;while(true){collide=false;if(levels[j]){for(k=0;k<levels[j].length;k++){if(segsCollide(levels[j][k],seg)){collide=true;break}}}
if(collide){j++}else{break}}
if(levels[j]){levels[j].push(seg)}else{levels[j]=[seg]}}
return levels}
function lazySegBind(container,segs,bindHandlers){container.unbind('mouseover').mouseover(function(ev){var parent=ev.target,e,i,seg;while(parent!=this){e=parent;parent=parent.parentNode}
if((i=e._fci)!==undefined){e._fci=undefined;seg=segs[i];bindHandlers(seg.event,seg.element,seg);$(ev.target).trigger(ev)}
ev.stopPropagation()})}
function setOuterWidth(element,width,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.width(Math.max(0,width-hsides(e,includeMargins)))}}
function setOuterHeight(element,height,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.height(Math.max(0,height-vsides(e,includeMargins)))}}
function hsides(element,includeMargins){return hpadding(element)+hborders(element)+(includeMargins?hmargins(element):0)}
function hpadding(element){return(parseFloat($.curCSS(element[0],'paddingLeft',true))||0)+(parseFloat($.curCSS(element[0],'paddingRight',true))||0)}
function hmargins(element){return(parseFloat($.curCSS(element[0],'marginLeft',true))||0)+(parseFloat($.curCSS(element[0],'marginRight',true))||0)}
function hborders(element){return(parseFloat($.curCSS(element[0],'borderLeftWidth',true))||0)+(parseFloat($.curCSS(element[0],'borderRightWidth',true))||0)}
function vsides(element,includeMargins){return vpadding(element)+vborders(element)+(includeMargins?vmargins(element):0)}
function vpadding(element){return(parseFloat($.curCSS(element[0],'paddingTop',true))||0)+(parseFloat($.curCSS(element[0],'paddingBottom',true))||0)}
function vmargins(element){return(parseFloat($.curCSS(element[0],'marginTop',true))||0)+(parseFloat($.curCSS(element[0],'marginBottom',true))||0)}
function vborders(element){return(parseFloat($.curCSS(element[0],'borderTopWidth',true))||0)+(parseFloat($.curCSS(element[0],'borderBottomWidth',true))||0)}
function setMinHeight(element,height){height=(typeof height=='number'?height+'px':height);element.each(function(i,_element){})}
function noop(){}
function cmp(a,b){return a-b}
function arrayMax(a){return Math.max.apply(Math,a)}
function zeroPad(n){return(n<10?'0':'')+n}
function smartProperty(obj,name){if(obj[name]!==undefined){return obj[name]}
var parts=name.split(/(?=[A-Z])/),i=parts.length-1,res;for(;i>=0;i--){res=obj[parts[i].toLowerCase()];if(res!==undefined){return res}}
return obj['']}
function htmlEscape(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#039;').replace(/"/g,'&quot;').replace(/\n/g,'<br />')}
function cssKey(_element){return _element.id+'/'+_element.className+'/'+_element.style.cssText.replace(/(^|;)\s*(top|left|width|height)\s*:[^;]*/ig,'')}
function disableTextSelection(element){element.attr('unselectable','on').css('MozUserSelect','none').bind('selectstart.ui',function(){return false})}
function markFirstLast(e){e.children().removeClass('fc-first fc-last').filter(':first-child').addClass('fc-first').end().filter(':last-child').addClass('fc-last')}
function setDayID(cell,date){cell.each(function(i,_cell){_cell.className=_cell.className.replace(/^fc-\w*/,'fc-'+dayIDs[date.getDay()])})}
function getSkinCss(event,opt){var source=event.source||{};var eventColor=event.color;var sourceColor=source.color;var optionColor=opt('eventColor');var backgroundColor=event.backgroundColor||eventColor||source.backgroundColor||sourceColor||opt('eventBackgroundColor')||optionColor;var borderColor=event.borderColor||eventColor||source.borderColor||sourceColor||opt('eventBorderColor')||optionColor;var textColor=event.textColor||source.textColor||opt('eventTextColor');var statements=[];if(backgroundColor){statements.push('background-color:'+backgroundColor)}
if(borderColor){statements.push('border-color:'+borderColor)}
if(textColor){statements.push('color:'+textColor)}
return statements.join(';')}
function applyAll(functions,thisObj,args){if($.isFunction(functions)){functions=[functions]}
if(functions){var i;var ret;for(i=0;i<functions.length;i++){ret=functions[i].apply(thisObj,args)||ret}
return ret}}
function firstDefined(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i]}}}
fcViews.month=MonthView;function MonthView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'month');var opt=t.opt;var renderBasic=t.renderBasic;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addMonths(date,delta);date.setDate(1)}
var start=cloneDate(date,true);start.setDate(1);var end=addMonths(cloneDate(start),1);var visStart=cloneDate(start);var visEnd=cloneDate(end);var firstDay=opt('firstDay');var nwe=opt('weekends')?0:1;if(nwe){skipWeekend(visStart);skipWeekend(visEnd,-1,true)}
addDays(visStart,-((visStart.getDay()-Math.max(firstDay,nwe)+7)%7));addDays(visEnd,(7-visEnd.getDay()+Math.max(firstDay,nwe))%7);var rowCnt=Math.round((visEnd-visStart)/(DAY_MS*7));if(opt('weekMode')=='fixed'){addDays(visEnd,(6-rowCnt)*7);rowCnt=6}
t.title=formatDate(start,opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(6,rowCnt,nwe?5:7,true)}}
fcViews.basicWeek=BasicWeekView;function BasicWeekView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicWeek');var opt=t.opt;var renderBasic=t.renderBasic;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7)}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);var visEnd=cloneDate(end);var weekends=opt('weekends');if(!weekends){skipWeekend(visStart);skipWeekend(visEnd,-1,true)}
t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(1,1,weekends?7:5,false)}}
fcViews.basicDay=BasicDayView;function BasicDayView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicDay');var opt=t.opt;var renderBasic=t.renderBasic;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);if(!opt('weekends')){skipWeekend(date,delta<0?-1:1)}}
t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=cloneDate(date,true);t.end=t.visEnd=addDays(cloneDate(t.start),1);renderBasic(1,1,1,false)}}
setDefaults({weekMode:'fixed'});function BasicView(element,calendar,viewName){var t=this;t.renderBasic=renderBasic;t.setHeight=setHeight;t.setWidth=setWidth;t.renderDayOverlay=renderDayOverlay;t.defaultSelectionEnd=defaultSelectionEnd;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;t.defaultEventEnd=defaultEventEnd;t.getHoverListener=function(){return hoverListener};t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.dayOfWeekCol=dayOfWeekCol;t.dateCell=dateCell;t.cellDate=cellDate;t.cellIsAllDay=function(){return true};t.allDayRow=allDayRow;t.allDayBounds=allDayBounds;t.getRowCnt=function(){return rowCnt};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getDaySegmentContainer=function(){return daySegmentContainer};View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);BasicEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var clearEvents=t.clearEvents;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var daySelectionMousedown=t.daySelectionMousedown;var formatDate=calendar.formatDate;var head;var headCells;var body;var bodyRows;var bodyCells;var bodyFirstCells;var bodyCellTopInners;var daySegmentContainer;var viewWidth;var viewHeight;var colWidth;var rowCnt,colCnt;var coordinateGrid;var hoverListener;var colContentPositions;var rtl,dis,dit;var firstDay;var nwe;var tm;var colFormat;disableTextSelection(element.addClass('fc-grid'));function renderBasic(maxr,r,c,showNumbers){rowCnt=r;colCnt=c;updateOptions();var firstTime=!body;if(firstTime){buildSkeleton(maxr,showNumbers)}else{clearEvents()}
updateCells(firstTime)}
function updateOptions(){rtl=opt('isRTL');if(rtl){dis=-1;dit=colCnt-1}else{dis=1;dit=0}
firstDay=opt('firstDay');nwe=opt('weekends')?0:1;tm=opt('theme')?'ui':'fc';colFormat=opt('columnFormat')}
function buildSkeleton(maxRowCnt,showNumbers){var s;var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var i,j;var table;s="<table class='fc-border-separate' style='width:100%' cellspacing='0'><thead><tr>";for(i=0;i<colCnt;i++){s+="<th class='fc- "+headerClass+"'/>"}
s+="</tr></thead><tbody>";for(i=0;i<maxRowCnt;i++){s+="<tr class='fc-week"+i+"'>";for(j=0;j<colCnt;j++){s+="<td class='fc- "+contentClass+" fc-day"+(i*colCnt+j)+"'><div>"+(showNumbers?"<div class='fc-day-number'/>":'')+"<div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>"}
s+="</tr>"}
s+="</tbody></table>";table=$(s).appendTo(element);head=table.find('thead');headCells=head.find('th');body=table.find('tbody');bodyRows=body.find('tr');bodyCells=body.find('td');bodyFirstCells=bodyCells.filter(':first-child');bodyCellTopInners=bodyRows.eq(0).find('div.fc-day-content div');markFirstLast(head.add(head.find('tr')));markFirstLast(bodyRows);bodyRows.eq(0).addClass('fc-first');dayBind(bodyCells);daySegmentContainer=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(element)}
function updateCells(firstTime){var dowDirty=firstTime||rowCnt==1;var month=t.start.getMonth();var today=clearTime(new Date());var cell;var date;var row;if(dowDirty){headCells.each(function(i,_cell){cell=$(_cell);date=indexDate(i);cell.html(formatDate(date,colFormat));setDayID(cell,date)})}
bodyCells.each(function(i,_cell){cell=$(_cell);date=indexDate(i);if(date.getMonth()==month){cell.removeClass('fc-other-month')}else{cell.addClass('fc-other-month')}if(+date==+today){cell.addClass(tm+'-state-highlight fc-today')}else{cell.removeClass(tm+'-state-highlight fc-today')}
cell.find('div.fc-day-number').text(date.getDate());if(dowDirty){setDayID(cell,date)}});bodyRows.each(function(i,_row){row=$(_row);if(i<rowCnt){row.show();if(i==rowCnt-1){row.addClass('fc-last')}else{row.removeClass('fc-last')}}else{row.hide()}})}
function setHeight(height){viewHeight=height;var bodyHeight=viewHeight-head.height();var rowHeight;var rowHeightLast;var cell;if(opt('weekMode')=='variable'){rowHeight=rowHeightLast=Math.floor(bodyHeight/(rowCnt==1?2:6))}else{rowHeight=Math.floor(bodyHeight/rowCnt);rowHeightLast=bodyHeight-rowHeight*(rowCnt-1)}
bodyFirstCells.each(function(i,_cell){if(i<rowCnt){cell=$(_cell);setMinHeight(cell.find('> div'),(i==rowCnt-1?rowHeightLast:rowHeight)-vsides(cell))}})}
function setWidth(width){viewWidth=width;colContentPositions.clear();colWidth=Math.floor(viewWidth/colCnt);setOuterWidth(headCells.slice(0,-1),colWidth)}
function dayBind(days){days.click(dayClick).mousedown(daySelectionMousedown)}
function dayClick(ev){if(!opt('selectable')){var index=parseInt(this.className.match(/fc\-day(\d+)/)[1]);var date=indexDate(index);trigger('dayClick',this,date,true,ev)}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build()}
var rowStart=cloneDate(t.visStart);var rowEnd=addDays(cloneDate(rowStart),colCnt);for(var i=0;i<rowCnt;i++){var stretchStart=new Date(Math.max(rowStart,overlayStart));var stretchEnd=new Date(Math.min(rowEnd,overlayEnd));if(stretchStart<stretchEnd){var colStart,colEnd;if(rtl){colStart=dayDiff(stretchEnd,rowStart)*dis+dit+1;colEnd=dayDiff(stretchStart,rowStart)*dis+dit+1}else{colStart=dayDiff(stretchStart,rowStart);colEnd=dayDiff(stretchEnd,rowStart)}
dayBind(renderCellOverlay(i,colStart,i,colEnd-1))}
addDays(rowStart,7);addDays(rowEnd,7)}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,element);return renderOverlay(rect,element)}
function defaultSelectionEnd(startDate,allDay){return cloneDate(startDate)}
function renderSelection(startDate,endDate,allDay){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true)}
function clearSelection(){clearOverlays()}
function reportDayClick(date,allDay,ev){var cell=dateCell(date);var _element=bodyCells[cell.row*colCnt+cell.col];trigger('dayClick',_element,date,allDay,ev)}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){renderCellOverlay(cell.row,cell.col,cell.row,cell.col)}},ev)}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){var d=cellDate(cell);trigger('drop',_dragElement,d,true,ev,ui)}}
function defaultEventEnd(event){return cloneDate(event.start)}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;headCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n}
p=[n];cols[i]=p});p[1]=n+e.outerWidth();bodyRows.each(function(i,_e){if(i<rowCnt){e=$(_e);n=e.offset().top;if(i){p[1]=n}
p=[n];rows[i]=p}});p[1]=n+e.outerHeight()});hoverListener=new HoverListener(coordinateGrid);colContentPositions=new HorizontalPositionCache(function(col){return bodyCellTopInners.eq(col)});function colContentLeft(col){return colContentPositions.left(col)}
function colContentRight(col){return colContentPositions.right(col)}
function dateCell(date){return{row:Math.floor(dayDiff(date,t.visStart)/7),col:dayOfWeekCol(date.getDay())}}
function cellDate(cell){return _cellDate(cell.row,cell.col)}
function _cellDate(row,col){return addDays(cloneDate(t.visStart),row*7+col*dis+dit)}
function indexDate(index){return _cellDate(Math.floor(index/colCnt),index%colCnt)}
function dayOfWeekCol(dayOfWeek){return((dayOfWeek-Math.max(firstDay,nwe)+colCnt)%colCnt)*dis+dit}
function allDayRow(i){return bodyRows.eq(i)}
function allDayBounds(i){return{left:0,right:viewWidth}}}
function BasicEventRenderer(){var t=this;t.renderEvents=renderEvents;t.compileDaySegs=compileSegs;t.clearEvents=clearEvents;t.bindDaySeg=bindDaySeg;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var reportEvents=t.reportEvents;var reportEventClear=t.reportEventClear;var eventElementHandlers=t.eventElementHandlers;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var getDaySegmentContainer=t.getDaySegmentContainer;var getHoverListener=t.getHoverListener;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var renderDaySegs=t.renderDaySegs;var resizableDayEvent=t.resizableDayEvent;function renderEvents(events,modifiedEventId){reportEvents(events);renderDaySegs(compileSegs(events),modifiedEventId)}
function clearEvents(){reportEventClear();getDaySegmentContainer().empty()}
function compileSegs(events){var rowCnt=getRowCnt(),colCnt=getColCnt(),d1=cloneDate(t.visStart),d2=addDays(cloneDate(d1),colCnt),visEventsEnds=$.map(events,exclEndDay),i,row,j,level,k,seg,segs=[];for(i=0;i<rowCnt;i++){row=stackSegs(sliceSegs(events,visEventsEnds,d1,d2));for(j=0;j<row.length;j++){level=row[j];for(k=0;k<level.length;k++){seg=level[k];seg.row=i;seg.level=j;segs.push(seg)}}
addDays(d1,7);addDays(d2,7)}
return segs}
function bindDaySeg(event,eventElement,seg){if(isEventDraggable(event)){draggableDayEvent(event,eventElement)}
if(seg.isEnd&&isEventResizable(event)){resizableDayEvent(event,eventElement,seg)}
eventElementHandlers(event,eventElement)}
function draggableDayEvent(event,eventElement){var hoverListener=getHoverListener();var dayDelta;eventElement.draggable({zIndex:9,delay:50,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable('option','revert',!cell||!rowDelta&&!colDelta);clearOverlays();if(cell){dayDelta=rowDelta*7+colDelta*(opt('isRTL')?-1:1);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta))}else{dayDelta=0}},ev,'drag')},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(dayDelta){eventDrop(this,event,dayDelta,0,event.allDay,ev,ui)}else{eventElement.css('filter','');showEvents(event,eventElement)}}})}}
fcViews.agendaWeek=AgendaWeekView;function AgendaWeekView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaWeek');var opt=t.opt;var renderAgenda=t.renderAgenda;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7)}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);var visEnd=cloneDate(end);var weekends=opt('weekends');if(!weekends){skipWeekend(visStart);skipWeekend(visEnd,-1,true)}
t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderAgenda(weekends?7:5)}}
fcViews.agendaDay=AgendaDayView;function AgendaDayView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaDay');var opt=t.opt;var renderAgenda=t.renderAgenda;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);if(!opt('weekends')){skipWeekend(date,delta<0?-1:1)}}
var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderAgenda(1)}}
setDefaults({allDaySlot:true,allDayText:'all-day',firstHour:6,slotMinutes:30,defaultEventMinutes:120,axisFormat:'h(:mm)tt',timeFormat:{agenda:'h:mm{ - h:mm}'},dragOpacity:{agenda:.5},minTime:0,maxTime:24});function AgendaView(element,calendar,viewName){var t=this;t.renderAgenda=renderAgenda;t.setWidth=setWidth;t.setHeight=setHeight;t.beforeHide=beforeHide;t.afterShow=afterShow;t.defaultEventEnd=defaultEventEnd;t.timePosition=timePosition;t.dayOfWeekCol=dayOfWeekCol;t.dateCell=dateCell;t.cellDate=cellDate;t.cellIsAllDay=cellIsAllDay;t.allDayRow=getAllDayRow;t.allDayBounds=allDayBounds;t.getHoverListener=function(){return hoverListener};t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getDaySegmentContainer=function(){return daySegmentContainer};t.getSlotSegmentContainer=function(){return slotSegmentContainer};t.getMinMinute=function(){return minMinute};t.getMaxMinute=function(){return maxMinute};t.getBodyContent=function(){return slotContent};t.getRowCnt=function(){return 1};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getSlotHeight=function(){return slotHeight};t.defaultSelectionEnd=defaultSelectionEnd;t.renderDayOverlay=renderDayOverlay;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);AgendaEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var clearEvents=t.clearEvents;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var reportSelection=t.reportSelection;var unselect=t.unselect;var daySelectionMousedown=t.daySelectionMousedown;var slotSegHtml=t.slotSegHtml;var formatDate=calendar.formatDate;var dayTable;var dayHead;var dayHeadCells;var dayBody;var dayBodyCells;var dayBodyCellInners;var dayBodyFirstCell;var dayBodyFirstCellStretcher;var slotLayer;var daySegmentContainer;var allDayTable;var allDayRow;var slotScroller;var slotContent;var slotSegmentContainer;var slotTable;var slotTableFirstInner;var axisFirstCells;var gutterCells;var selectionHelper;var viewWidth;var viewHeight;var axisWidth;var colWidth;var gutterWidth;var slotHeight;var savedScrollTop;var colCnt;var slotCnt;var coordinateGrid;var hoverListener;var colContentPositions;var slotTopCache={};var tm;var firstDay;var nwe;var rtl,dis,dit;var minMinute,maxMinute;var colFormat;disableTextSelection(element.addClass('fc-agenda'));function renderAgenda(c){colCnt=c;updateOptions();if(!dayTable){buildSkeleton()}else{clearEvents()}
updateCells()}
function updateOptions(){tm=opt('theme')?'ui':'fc';nwe=opt('weekends')?0:1;firstDay=opt('firstDay');if(rtl=opt('isRTL')){dis=-1;dit=colCnt-1}else{dis=1;dit=0}
minMinute=parseTime(opt('minTime'));maxMinute=parseTime(opt('maxTime'));colFormat=opt('columnFormat')}
function buildSkeleton(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var s;var i;var d;var maxd;var minutes;var slotNormal=opt('slotMinutes')%15==0;s="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'><thead><tr><th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";for(i=0;i<colCnt;i++){s+="<th class='fc- fc-col"+i+' '+headerClass+"'/>"}
s+="<th class='fc-agenda-gutter "+headerClass+"'>&nbsp;</th></tr></thead><tbody><tr><th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";for(i=0;i<colCnt;i++){s+="<td class='fc- fc-col"+i+' '+contentClass+"'><div><div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>"}
s+="<td class='fc-agenda-gutter "+contentClass+"'>&nbsp;</td></tr></tbody></table>";dayTable=$(s).appendTo(element);dayHead=dayTable.find('thead');dayHeadCells=dayHead.find('th').slice(1,-1);dayBody=dayTable.find('tbody');dayBodyCells=dayBody.find('td').slice(0,-1);dayBodyCellInners=dayBodyCells.find('div.fc-day-content div');dayBodyFirstCell=dayBodyCells.eq(0);dayBodyFirstCellStretcher=dayBodyFirstCell.find('> div');markFirstLast(dayHead.add(dayHead.find('tr')));markFirstLast(dayBody.add(dayBody.find('tr')));axisFirstCells=dayHead.find('th:first');gutterCells=dayTable.find('.fc-agenda-gutter');slotLayer=$("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(element);if(opt('allDaySlot')){daySegmentContainer=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotLayer);s="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'><tr><th class='"+headerClass+" fc-agenda-axis'>"+opt('allDayText')+"</th><td><div class='fc-day-content'><div style='position:relative'/></div></td><th class='"+headerClass+" fc-agenda-gutter'>&nbsp;</th></tr></table>";allDayTable=$(s).appendTo(slotLayer);allDayRow=allDayTable.find('tr');dayBind(allDayRow.find('td'));axisFirstCells=axisFirstCells.add(allDayTable.find('th:first'));gutterCells=gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));slotLayer.append("<div class='fc-agenda-divider "+headerClass+"'><div class='fc-agenda-divider-inner'/></div>")}else{daySegmentContainer=$([])}
slotScroller=$("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(slotLayer);slotContent=$("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(slotScroller);slotSegmentContainer=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotContent);s="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'><tbody>";d=zeroDate();maxd=addMinutes(cloneDate(d),maxMinute);addMinutes(d,minMinute);slotCnt=0;for(i=0;d<maxd;i++){minutes=d.getMinutes();s+="<tr class='fc-slot"+i+' '+(!minutes?'':'fc-minor')+"'><th class='fc-agenda-axis "+headerClass+"'>"+((!slotNormal||!minutes)?formatDate(d,opt('axisFormat')):'&nbsp;')+"</th><td class='"+contentClass+"'><div style='position:relative'>&nbsp;</div></td></tr>";addMinutes(d,opt('slotMinutes'));slotCnt++}
s+="</tbody></table>";slotTable=$(s).appendTo(slotContent);slotTableFirstInner=slotTable.find('div:first');slotBind(slotTable.find('td'));axisFirstCells=axisFirstCells.add(slotTable.find('th:first'))}
function updateCells(){var i;var headCell;var bodyCell;var date;var today=clearTime(new Date());for(i=0;i<colCnt;i++){date=colDate(i);headCell=dayHeadCells.eq(i);headCell.html(formatDate(date,colFormat));bodyCell=dayBodyCells.eq(i);if(+date==+today){bodyCell.addClass(tm+'-state-highlight fc-today')}else{bodyCell.removeClass(tm+'-state-highlight fc-today')}
setDayID(headCell.add(bodyCell),date)}}
function setHeight(height,dateChanged){if(height===undefined){height=viewHeight}
viewHeight=height;slotTopCache={};var headHeight=dayBody.position().top;var allDayHeight=slotScroller.position().top;var bodyHeight=Math.min(height-headHeight,slotTable.height()+allDayHeight+1);dayBodyFirstCellStretcher.height(bodyHeight-vsides(dayBodyFirstCell));slotLayer.css('top',headHeight);slotScroller.height(bodyHeight-allDayHeight-1);slotHeight=slotTableFirstInner.height()+1;if(dateChanged){resetScroll()}}
function setWidth(width){viewWidth=width;colContentPositions.clear();axisWidth=0;setOuterWidth(axisFirstCells.width('').each(function(i,_cell){axisWidth=Math.max(axisWidth,$(_cell).outerWidth())}),axisWidth);var slotTableWidth=slotScroller[0].clientWidth;gutterWidth=slotScroller.width()-slotTableWidth;if(gutterWidth){setOuterWidth(gutterCells,gutterWidth);gutterCells.show().prev().removeClass('fc-last')}else{gutterCells.hide().prev().addClass('fc-last')}
colWidth=Math.floor((slotTableWidth-axisWidth)/colCnt);setOuterWidth(dayHeadCells.slice(0,-1),colWidth)}
function resetScroll(){var d0=zeroDate();var scrollDate=cloneDate(d0);scrollDate.setHours(opt('firstHour'));var top=timePosition(d0,scrollDate)+1;function scroll(){slotScroller.scrollTop(top)}
scroll();setTimeout(scroll,0)}
function beforeHide(){savedScrollTop=slotScroller.scrollTop()}
function afterShow(){slotScroller.scrollTop(savedScrollTop)}
function dayBind(cells){cells.click(slotClick).mousedown(daySelectionMousedown)}
function slotBind(cells){cells.click(slotClick).mousedown(slotSelectionMousedown)}
function slotClick(ev){if(!opt('selectable')){var col=Math.min(colCnt-1,Math.floor((ev.pageX-dayTable.offset().left-axisWidth)/colWidth));var date=colDate(col);var rowMatch=this.parentNode.className.match(/fc-slot(\d+)/);if(rowMatch){var mins=parseInt(rowMatch[1])*opt('slotMinutes');var hours=Math.floor(mins/60);date.setHours(hours);date.setMinutes(mins%60+minMinute);trigger('dayClick',dayBodyCells[col],date,false,ev)}else{trigger('dayClick',dayBodyCells[col],date,true,ev)}}}
function renderDayOverlay(startDate,endDate,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build()}
var visStart=cloneDate(t.visStart);var startCol,endCol;if(rtl){startCol=dayDiff(endDate,visStart)*dis+dit+1;endCol=dayDiff(startDate,visStart)*dis+dit+1}else{startCol=dayDiff(startDate,visStart);endCol=dayDiff(endDate,visStart)}
startCol=Math.max(0,startCol);endCol=Math.min(colCnt,endCol);if(startCol<endCol){dayBind(renderCellOverlay(0,startCol,0,endCol-1))}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,slotLayer);return renderOverlay(rect,slotLayer)}
function renderSlotOverlay(overlayStart,overlayEnd){var dayStart=cloneDate(t.visStart);var dayEnd=addDays(cloneDate(dayStart),1);for(var i=0;i<colCnt;i++){var stretchStart=new Date(Math.max(dayStart,overlayStart));var stretchEnd=new Date(Math.min(dayEnd,overlayEnd));if(stretchStart<stretchEnd){var col=i*dis+dit;var rect=coordinateGrid.rect(0,col,0,col,slotContent);var top=timePosition(dayStart,stretchStart);var bottom=timePosition(dayStart,stretchEnd);rect.top=top;rect.height=bottom-top;slotBind(renderOverlay(rect,slotContent))}
addDays(dayStart,1);addDays(dayEnd,1)}}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;dayHeadCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n}
p=[n];cols[i]=p});p[1]=n+e.outerWidth();if(opt('allDaySlot')){e=allDayRow;n=e.offset().top;rows[0]=[n,n+e.outerHeight()]}
var slotTableTop=slotContent.offset().top;var slotScrollerTop=slotScroller.offset().top;var slotScrollerBottom=slotScrollerTop+slotScroller.outerHeight();function constrain(n){return Math.max(slotScrollerTop,Math.min(slotScrollerBottom,n))}
for(var i=0;i<slotCnt;i++){rows.push([constrain(slotTableTop+slotHeight*i),constrain(slotTableTop+slotHeight*(i+1))])}});hoverListener=new HoverListener(coordinateGrid);colContentPositions=new HorizontalPositionCache(function(col){return dayBodyCellInners.eq(col)});function colContentLeft(col){return colContentPositions.left(col)}
function colContentRight(col){return colContentPositions.right(col)}
function dateCell(date){return{row:Math.floor(dayDiff(date,t.visStart)/7),col:dayOfWeekCol(date.getDay())}}
function cellDate(cell){var d=colDate(cell.col);var slotIndex=cell.row;if(opt('allDaySlot')){slotIndex--}
if(slotIndex>=0){addMinutes(d,minMinute+slotIndex*opt('slotMinutes'))}
return d}
function colDate(col){return addDays(cloneDate(t.visStart),col*dis+dit)}
function cellIsAllDay(cell){return opt('allDaySlot')&&!cell.row}
function dayOfWeekCol(dayOfWeek){return((dayOfWeek-Math.max(firstDay,nwe)+colCnt)%colCnt)*dis+dit}
function timePosition(day,time){day=cloneDate(day,true);if(time<addMinutes(cloneDate(day),minMinute)){return 0}
if(time>=addMinutes(cloneDate(day),maxMinute)){return slotTable.height()}
var slotMinutes=opt('slotMinutes'),minutes=time.getHours()*60+time.getMinutes()-minMinute,slotI=Math.floor(minutes/slotMinutes),slotTop=slotTopCache[slotI];if(slotTop===undefined){slotTop=slotTopCache[slotI]=slotTable.find('tr:eq('+slotI+') td div')[0].offsetTop}
return Math.max(0,Math.round(slotTop-1+slotHeight*((minutes%slotMinutes)/slotMinutes)))}
function allDayBounds(){return{left:axisWidth,right:viewWidth-gutterWidth}}
function getAllDayRow(index){return allDayRow}
function defaultEventEnd(event){var start=cloneDate(event.start);if(event.allDay){return start}
return addMinutes(start,opt('defaultEventMinutes'))}
function defaultSelectionEnd(startDate,allDay){if(allDay){return cloneDate(startDate)}
return addMinutes(cloneDate(startDate),opt('slotMinutes'))}
function renderSelection(startDate,endDate,allDay){if(allDay){if(opt('allDaySlot')){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true)}}else{renderSlotSelection(startDate,endDate)}}
function renderSlotSelection(startDate,endDate){var helperOption=opt('selectHelper');coordinateGrid.build();if(helperOption){var col=dayDiff(startDate,t.visStart)*dis+dit;if(col>=0&&col<colCnt){var rect=coordinateGrid.rect(0,col,0,col,slotContent);var top=timePosition(startDate,startDate);var bottom=timePosition(startDate,endDate);if(bottom>top){rect.top=top;rect.height=bottom-top;rect.left+=2;rect.width-=5;if($.isFunction(helperOption)){var helperRes=helperOption(startDate,endDate);if(helperRes){rect.position='absolute';rect.zIndex=8;selectionHelper=$(helperRes).css(rect).appendTo(slotContent)}}else{rect.isStart=true;rect.isEnd=true;selectionHelper=$(slotSegHtml({title:'',start:startDate,end:endDate,className:['fc-select-helper'],editable:false},rect));selectionHelper.css('opacity',opt('dragOpacity'))}if(selectionHelper){slotBind(selectionHelper);slotContent.append(selectionHelper);setOuterWidth(selectionHelper,rect.width,true);setOuterHeight(selectionHelper,rect.height,true)}}}}else{renderSlotOverlay(startDate,endDate)}}
function clearSelection(){clearOverlays();if(selectionHelper){selectionHelper.remove();selectionHelper=null}}
function slotSelectionMousedown(ev){if(ev.which==1&&opt('selectable')){unselect(ev);var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cell.col==origCell.col&&!cellIsAllDay(cell)){var d1=cellDate(origCell);var d2=cellDate(cell);dates=[d1,addMinutes(cloneDate(d1),opt('slotMinutes')),d2,addMinutes(cloneDate(d2),opt('slotMinutes'))].sort(cmp);renderSlotSelection(dates[0],dates[3])}else{dates=null}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],false,ev)}
reportSelection(dates[0],dates[3],false,ev)}})}}
function reportDayClick(date,allDay,ev){trigger('dayClick',dayBodyCells[dayOfWeekCol(date.getDay())],date,allDay,ev)}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){if(cellIsAllDay(cell)){renderCellOverlay(cell.row,cell.col,cell.row,cell.col)}else{var d1=cellDate(cell);var d2=addMinutes(cloneDate(d1),opt('defaultEventMinutes'));renderSlotOverlay(d1,d2)}}},ev)}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){trigger('drop',_dragElement,cellDate(cell),cellIsAllDay(cell),ev,ui)}}}
function AgendaEventRenderer(){var t=this;t.renderEvents=renderEvents;t.compileDaySegs=compileDaySegs;t.clearEvents=clearEvents;t.slotSegHtml=slotSegHtml;t.bindDaySeg=bindDaySeg;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEvents=t.reportEvents;var reportEventClear=t.reportEventClear;var eventElementHandlers=t.eventElementHandlers;var setHeight=t.setHeight;var getDaySegmentContainer=t.getDaySegmentContainer;var getSlotSegmentContainer=t.getSlotSegmentContainer;var getHoverListener=t.getHoverListener;var getMaxMinute=t.getMaxMinute;var getMinMinute=t.getMinMinute;var timePosition=t.timePosition;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var renderDaySegs=t.renderDaySegs;var resizableDayEvent=t.resizableDayEvent;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var getSlotHeight=t.getSlotHeight;var getBodyContent=t.getBodyContent;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var calendar=t.calendar;var formatDate=calendar.formatDate;var formatDates=calendar.formatDates;function renderEvents(events,modifiedEventId){reportEvents(events);var i,len=events.length,dayEvents=[],slotEvents=[];for(i=0;i<len;i++){if(events[i].allDay){dayEvents.push(events[i])}else{slotEvents.push(events[i])}}
if(opt('allDaySlot')){renderDaySegs(compileDaySegs(dayEvents),modifiedEventId);setHeight()}
renderSlotSegs(compileSlotSegs(slotEvents),modifiedEventId)}
function clearEvents(){reportEventClear();getDaySegmentContainer().empty();getSlotSegmentContainer().empty()}
function compileDaySegs(events){var levels=stackSegs(sliceSegs(events,$.map(events,exclEndDay),t.visStart,t.visEnd)),i,levelCnt=levels.length,level,j,seg,segs=[];for(i=0;i<levelCnt;i++){level=levels[i];for(j=0;j<level.length;j++){seg=level[j];seg.row=0;seg.level=i;segs.push(seg)}}
return segs}
function compileSlotSegs(events){var colCnt=getColCnt(),minMinute=getMinMinute(),maxMinute=getMaxMinute(),d=addMinutes(cloneDate(t.visStart),minMinute),visEventEnds=$.map(events,slotEventEnd),i,col,j,level,k,seg,segs=[];for(i=0;i<colCnt;i++){col=stackSegs(sliceSegs(events,visEventEnds,d,addMinutes(cloneDate(d),maxMinute-minMinute)));countForwardSegs(col);for(j=0;j<col.length;j++){level=col[j];for(k=0;k<level.length;k++){seg=level[k];seg.col=i;seg.level=j;segs.push(seg)}}
addDays(d,1,true)}
return segs}
function slotEventEnd(event){if(event.end){return cloneDate(event.end)}else{return addMinutes(cloneDate(event.start),opt('defaultEventMinutes'))}}
function renderSlotSegs(segs,modifiedEventId){var i,segCnt=segs.length,seg,event,classes,top,bottom,colI,levelI,forward,leftmost,availWidth,outerWidth,left,html='',eventElements,eventElement,triggerRes,vsideCache={},hsideCache={},key,val,contentElement,height,slotSegmentContainer=getSlotSegmentContainer(),rtl,dis,dit,colCnt=getColCnt();if(rtl=opt('isRTL')){dis=-1;dit=colCnt-1}else{dis=1;dit=0}
for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;top=timePosition(seg.start,seg.start);bottom=timePosition(seg.start,seg.end);colI=seg.col;levelI=seg.level;forward=seg.forward||0;leftmost=colContentLeft(colI*dis+dit);availWidth=colContentRight(colI*dis+dit)-leftmost;availWidth=Math.min(availWidth-6,availWidth*.95);if(levelI){outerWidth=availWidth/(levelI+forward+1)}else{if(forward){outerWidth=((availWidth/(forward+1))-(12/2))*2}else{outerWidth=availWidth}}
left=leftmost+(availWidth/(levelI+forward+1)*levelI)*dis+(rtl?availWidth-outerWidth:0);seg.top=top;seg.left=left;seg.outerWidth=outerWidth;seg.outerHeight=bottom-top;html+=slotSegHtml(event,seg)}
slotSegmentContainer[0].innerHTML=html;eventElements=slotSegmentContainer.children();for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;eventElement=$(eventElements[i]);triggerRes=trigger('eventRender',event,event,eventElement);if(triggerRes===false){eventElement.remove()}else{if(triggerRes&&triggerRes!==true){eventElement.remove();eventElement=$(triggerRes).css({position:'absolute',top:seg.top,left:seg.left}).appendTo(slotSegmentContainer)}
seg.element=eventElement;if(event._id===modifiedEventId){bindSlotSeg(event,eventElement,seg)}else{eventElement[0]._fci=i}
reportEventElement(event,eventElement)}}
lazySegBind(slotSegmentContainer,segs,bindSlotSeg);for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){val=vsideCache[key=seg.key=cssKey(eventElement[0])];seg.vsides=val===undefined?(vsideCache[key]=vsides(eventElement,true)):val;val=hsideCache[key];seg.hsides=val===undefined?(hsideCache[key]=hsides(eventElement,true)):val;contentElement=eventElement.find('div.fc-event-content');if(contentElement.length){seg.contentTop=contentElement[0].offsetTop}}}
for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){eventElement[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+'px';height=Math.max(0,seg.outerHeight-seg.vsides);eventElement[0].style.height=height+'px';event=seg.event;if(seg.contentTop!==undefined&&height-seg.contentTop<10){eventElement.find('div.fc-event-time').text(formatDate(event.start,opt('timeFormat'))+' - '+event.title);eventElement.find('div.fc-event-title').remove()}
trigger('eventAfterRender',event,event,eventElement)}}}
function slotSegHtml(event,seg){var html="<";var url=event.url;var skinCss=getSkinCss(event,opt);var skinCssAttr=(skinCss?" style='"+skinCss+"'":'');var classes=['fc-event','fc-event-skin','fc-event-vert'];if(isEventDraggable(event)){classes.push('fc-event-draggable')}
if(seg.isStart){classes.push('fc-corner-top')}
if(seg.isEnd){classes.push('fc-corner-bottom')}
classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[])}
if(url){html+="a href='"+htmlEscape(event.url)+"'"}else{html+="div"}
html+=" class='"+classes.join(' ')+"' style='position:absolute;z-index:8;top:"+seg.top+"px;left:"+seg.left+"px;"+skinCss+"'><div class='fc-event-inner fc-event-skin'"+skinCssAttr+"><div class='fc-event-head fc-event-skin'"+skinCssAttr+"><div class='fc-event-time'>"+htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</div></div><div class='fc-event-content'><div class='fc-event-title'>"+htmlEscape(event.title)+"</div></div><div class='fc-event-bg'></div></div>";if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-s'>=</div>"}
html+="</"+(url?"a":"div");return html}
function bindDaySeg(event,eventElement,seg){if(isEventDraggable(event)){draggableDayEvent(event,eventElement,seg.isStart)}
if(seg.isEnd&&isEventResizable(event)){resizableDayEvent(event,eventElement,seg)}
eventElementHandlers(event,eventElement)}
function bindSlotSeg(event,eventElement,seg){var timeElement=eventElement.find('div.fc-event-time');if(isEventDraggable(event)){draggableSlotEvent(event,eventElement,timeElement)}
if(seg.isEnd&&isEventResizable(event)){resizableSlotEvent(event,eventElement,timeElement)}
eventElementHandlers(event,eventElement)}
function draggableDayEvent(event,eventElement,isStart){var origWidth;var revert;var allDay=true;var dayDelta;var dis=opt('isRTL')?-1:1;var hoverListener=getHoverListener();var colWidth=getColWidth();var slotHeight=getSlotHeight();var minMinute=getMinMinute();eventElement.draggable({zIndex:9,opacity:opt('dragOpacity','month'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);origWidth=eventElement.width();hoverListener.start(function(cell,origCell,rowDelta,colDelta){clearOverlays();if(cell){revert=false;dayDelta=colDelta*dis;if(!cell.row){renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));resetElement()}else{if(isStart){if(allDay){eventElement.width(colWidth-10);setOuterHeight(eventElement,slotHeight*Math.round((event.end?((event.end-event.start)/MINUTE_MS):opt('defaultEventMinutes'))/opt('slotMinutes')));eventElement.draggable('option','grid',[colWidth,1]);allDay=false}}else{revert=true}}
revert=revert||(allDay&&!dayDelta)}else{resetElement();revert=true}
eventElement.draggable('option','revert',revert)},ev,'drag')},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(revert){resetElement();eventElement.css('filter','');showEvents(event,eventElement)}else{var minuteDelta=0;if(!allDay){minuteDelta=Math.round((eventElement.offset().top-getBodyContent().offset().top)/slotHeight)*opt('slotMinutes')+minMinute-(event.start.getHours()*60+event.start.getMinutes())}
eventDrop(this,event,dayDelta,minuteDelta,allDay,ev,ui)}}});function resetElement(){if(!allDay){eventElement.width(origWidth).height('').draggable('option','grid',null);allDay=true}}}
function draggableSlotEvent(event,eventElement,timeElement){var origPosition;var allDay=false;var dayDelta;var minuteDelta;var prevMinuteDelta;var dis=opt('isRTL')?-1:1;var hoverListener=getHoverListener();var colCnt=getColCnt();var colWidth=getColWidth();var slotHeight=getSlotHeight();eventElement.draggable({zIndex:9,scroll:false,grid:[colWidth,slotHeight],axis:colCnt==1?'y':false,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);origPosition=eventElement.position();minuteDelta=prevMinuteDelta=0;hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable('option','revert',!cell);clearOverlays();if(cell){dayDelta=colDelta*dis;if(opt('allDaySlot')&&!cell.row){if(!allDay){allDay=true;timeElement.hide();eventElement.draggable('option','grid',null)}
renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta))}else{resetElement()}}},ev,'drag')},drag:function(ev,ui){minuteDelta=Math.round((ui.position.top-origPosition.top)/slotHeight)*opt('slotMinutes');if(minuteDelta!=prevMinuteDelta){if(!allDay){updateTimeText(minuteDelta)}
prevMinuteDelta=minuteDelta}},stop:function(ev,ui){var cell=hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(cell&&(dayDelta||minuteDelta||allDay)){eventDrop(this,event,dayDelta,allDay?0:minuteDelta,allDay,ev,ui)}else{resetElement();eventElement.css('filter','');eventElement.css(origPosition);updateTimeText(0);showEvents(event,eventElement)}}});function updateTimeText(minuteDelta){var newStart=addMinutes(cloneDate(event.start),minuteDelta);var newEnd;if(event.end){newEnd=addMinutes(cloneDate(event.end),minuteDelta)}
timeElement.text(formatDates(newStart,newEnd,opt('timeFormat')))}
function resetElement(){if(allDay){timeElement.css('display','');eventElement.draggable('option','grid',[colWidth,slotHeight]);allDay=false}}}
function resizableSlotEvent(event,eventElement,timeElement){var slotDelta,prevSlotDelta;var slotHeight=getSlotHeight();eventElement.resizable({handles:{s:'div.ui-resizable-s'},grid:slotHeight,start:function(ev,ui){slotDelta=prevSlotDelta=0;hideEvents(event,eventElement);eventElement.css('z-index',9);trigger('eventResizeStart',this,event,ev,ui)},resize:function(ev,ui){slotDelta=Math.round((Math.max(slotHeight,eventElement.height())-ui.originalSize.height)/slotHeight);if(slotDelta!=prevSlotDelta){timeElement.text(formatDates(event.start,(!slotDelta&&!event.end)?null:addMinutes(eventEnd(event),opt('slotMinutes')*slotDelta),opt('timeFormat')));prevSlotDelta=slotDelta}},stop:function(ev,ui){trigger('eventResizeStop',this,event,ev,ui);if(slotDelta){eventResize(this,event,0,opt('slotMinutes')*slotDelta,ev,ui)}else{eventElement.css('z-index',8);showEvents(event,eventElement)}}})}}
function countForwardSegs(levels){var i,j,k,level,segForward,segBack;for(i=levels.length-1;i>0;i--){level=levels[i];for(j=0;j<level.length;j++){segForward=level[j];for(k=0;k<levels[i-1].length;k++){segBack=levels[i-1][k];if(segsCollide(segForward,segBack)){segBack.forward=Math.max(segBack.forward||0,(segForward.forward||0)+1)}}}}}
function View(element,calendar,viewName){var t=this;t.element=element;t.calendar=calendar;t.name=viewName;t.opt=opt;t.trigger=trigger;t.isEventDraggable=isEventDraggable;t.isEventResizable=isEventResizable;t.reportEvents=reportEvents;t.eventEnd=eventEnd;t.reportEventElement=reportEventElement;t.reportEventClear=reportEventClear;t.eventElementHandlers=eventElementHandlers;t.showEvents=showEvents;t.hideEvents=hideEvents;t.eventDrop=eventDrop;t.eventResize=eventResize;var defaultEventEnd=t.defaultEventEnd;var normalizeEvent=calendar.normalizeEvent;var reportEventChange=calendar.reportEventChange;var eventsByID={};var eventElements=[];var eventElementsByID={};var options=calendar.options;function opt(name,viewNameOverride){var v=options[name];if(typeof v=='object'){return smartProperty(v,viewNameOverride||viewName)}
return v}
function trigger(name,thisObj){return calendar.trigger.apply(calendar,[name,thisObj||t].concat(Array.prototype.slice.call(arguments,2),[t]))}
function isEventDraggable(event){return isEventEditable(event)&&!opt('disableDragging')}
function isEventResizable(event){return isEventEditable(event)&&!opt('disableResizing')}
function isEventEditable(event){return firstDefined(event.editable,(event.source||{}).editable,opt('editable'))}
function reportEvents(events){eventsByID={};var i,len=events.length,event;for(i=0;i<len;i++){event=events[i];if(eventsByID[event._id]){eventsByID[event._id].push(event)}else{eventsByID[event._id]=[event]}}}
function eventEnd(event){return event.end?cloneDate(event.end):defaultEventEnd(event)}
function reportEventElement(event,element){eventElements.push(element);if(eventElementsByID[event._id]){eventElementsByID[event._id].push(element)}else{eventElementsByID[event._id]=[element]}}
function reportEventClear(){eventElements=[];eventElementsByID={}}
function eventElementHandlers(event,eventElement){eventElement.click(function(ev){if(!eventElement.hasClass('ui-draggable-dragging')&&!eventElement.hasClass('ui-resizable-resizing')){return trigger('eventClick',this,event,ev)}}).hover(function(ev){trigger('eventMouseover',this,event,ev)},function(ev){trigger('eventMouseout',this,event,ev)})}
function showEvents(event,exceptElement){eachEventElement(event,exceptElement,'show')}
function hideEvents(event,exceptElement){eachEventElement(event,exceptElement,'hide')}
function eachEventElement(event,exceptElement,funcName){var elements=eventElementsByID[event._id],i,len=elements.length;for(i=0;i<len;i++){if(!exceptElement||elements[i][0]!=exceptElement[0]){elements[i][funcName]()}}}
function eventDrop(e,event,dayDelta,minuteDelta,allDay,ev,ui){var oldAllDay=event.allDay;var eventId=event._id;moveEvents(eventsByID[eventId],dayDelta,minuteDelta,allDay);trigger('eventDrop',e,event,dayDelta,minuteDelta,allDay,function(){moveEvents(eventsByID[eventId],-dayDelta,-minuteDelta,oldAllDay);reportEventChange(eventId)},ev,ui);reportEventChange(eventId)}
function eventResize(e,event,dayDelta,minuteDelta,ev,ui){var eventId=event._id;elongateEvents(eventsByID[eventId],dayDelta,minuteDelta);trigger('eventResize',e,event,dayDelta,minuteDelta,function(){elongateEvents(eventsByID[eventId],-dayDelta,-minuteDelta);reportEventChange(eventId)},ev,ui);reportEventChange(eventId)}
function moveEvents(events,dayDelta,minuteDelta,allDay){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];if(allDay!==undefined){e.allDay=allDay}
addMinutes(addDays(e.start,dayDelta,true),minuteDelta);if(e.end){e.end=addMinutes(addDays(e.end,dayDelta,true),minuteDelta)}
normalizeEvent(e,options)}}
function elongateEvents(events,dayDelta,minuteDelta){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];e.end=addMinutes(addDays(eventEnd(e),dayDelta,true),minuteDelta);normalizeEvent(e,options)}}}
function DayEventRenderer(){var t=this;t.renderDaySegs=renderDaySegs;t.resizableDayEvent=resizableDayEvent;var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventResize=t.eventResize;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var allDayRow=t.allDayRow;var allDayBounds=t.allDayBounds;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var dayOfWeekCol=t.dayOfWeekCol;var dateCell=t.dateCell;var compileDaySegs=t.compileDaySegs;var getDaySegmentContainer=t.getDaySegmentContainer;var bindDaySeg=t.bindDaySeg;var formatDates=t.calendar.formatDates;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var clearSelection=t.clearSelection;function renderDaySegs(segs,modifiedEventId){var segmentContainer=getDaySegmentContainer();var rowDivs;var rowCnt=getRowCnt();var colCnt=getColCnt();var i=0;var rowI;var levelI;var colHeights;var j;var segCnt=segs.length;var seg;var top;var k;segmentContainer[0].innerHTML=daySegHTML(segs);daySegElementResolve(segs,segmentContainer.children());daySegElementReport(segs);daySegHandlers(segs,segmentContainer,modifiedEventId);daySegCalcHSides(segs);daySegSetWidths(segs);daySegCalcHeights(segs);rowDivs=getRowDivs();for(rowI=0;rowI<rowCnt;rowI++){levelI=0;colHeights=[];for(j=0;j<colCnt;j++){colHeights[j]=0}
while(i<segCnt&&(seg=segs[i]).row==rowI){top=arrayMax(colHeights.slice(seg.startCol,seg.endCol));seg.top=top;top+=seg.outerHeight;for(k=seg.startCol;k<seg.endCol;k++){colHeights[k]=top}
i++}
rowDivs[rowI].height(arrayMax(colHeights))}
daySegSetTops(segs,getRowTops(rowDivs))}
function renderTempDaySegs(segs,adjustRow,adjustTop){var tempContainer=$("<div/>");var elements;var segmentContainer=getDaySegmentContainer();var i;var segCnt=segs.length;var element;tempContainer[0].innerHTML=daySegHTML(segs);elements=tempContainer.children();segmentContainer.append(elements);daySegElementResolve(segs,elements);daySegCalcHSides(segs);daySegSetWidths(segs);daySegCalcHeights(segs);daySegSetTops(segs,getRowTops(getRowDivs()));elements=[];for(i=0;i<segCnt;i++){element=segs[i].element;if(element){if(segs[i].row===adjustRow){element.css('top',adjustTop)}
elements.push(element[0])}}
return $(elements)}
function daySegHTML(segs){var rtl=opt('isRTL');var i;var segCnt=segs.length;var seg;var event;var url;var classes;var bounds=allDayBounds();var minLeft=bounds.left;var maxLeft=bounds.right;var leftCol;var rightCol;var left;var right;var skinCss;var html='';for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;classes=['fc-event','fc-event-skin','fc-event-hori'];if(isEventDraggable(event)){classes.push('fc-event-draggable')}
if(rtl){if(seg.isStart){classes.push('fc-corner-right')}
if(seg.isEnd){classes.push('fc-corner-left')}
leftCol=dayOfWeekCol(seg.end.getDay()-1);rightCol=dayOfWeekCol(seg.start.getDay());left=seg.isEnd?colContentLeft(leftCol):minLeft;right=seg.isStart?colContentRight(rightCol):maxLeft}else{if(seg.isStart){classes.push('fc-corner-left')}
if(seg.isEnd){classes.push('fc-corner-right')}
leftCol=dayOfWeekCol(seg.start.getDay());rightCol=dayOfWeekCol(seg.end.getDay()-1);left=seg.isStart?colContentLeft(leftCol):minLeft;right=seg.isEnd?colContentRight(rightCol):maxLeft}
classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[])}
url=event.url;skinCss=getSkinCss(event,opt);if(url){html+="<a rel='nofollow' target='_blank' href='"+htmlEscape(url)+"'";html+=" class='"+classes.join(' ')+"' style='position:absolute;z-index:8;left:"+left+"px;text-align:center;'><div class='fc-event-inner fc-event-skin'"+(skinCss?" style='"+skinCss+"'":'')+">"}else{html+="<div";html+=" class='"+classes.join(' ')+"' style='position:absolute;z-index:8;left:"+left+"px;margin-top:-20px;text-align:right;'><div class='fc-event-inner fc-event-skin'"+(skinCss?" style='"+skinCss+"'":'')+">"}if(!event.allDay&&seg.isStart){html+="<span class='fc-event-time'>"+htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</span>"}
if(event._id.match(/[l|r]{0,1}cu_\d{4}-\d{1,2}-\d{1,2}/)){event._id=event._id.replace(/(^\s*)|(\s*$)/g,"").replace(/\ {2,}/," ");var eventIds=event._id.split(" ");var eventIdsCnt=eventIds.length;var iconCss='';var lastSpanCss='';for(var j=0;j<eventIdsCnt;j++){if(eventIds[j].match(/[l|r]{0,1}cu_\d{4}-\d{1,2}-\d{1,2}/)){iconCss=eventIds[j];continue}
if(j<eventIdsCnt-2){html+="<span class='"+htmlEscape(eventIds[j])+"'></span>"}else if(j==eventIdsCnt-2){if(iconCss!=''){html+="<span class='"+htmlEscape(eventIds[j])+"'></span>"}else{lastSpanCss=eventIds[j]}}else{lastSpanCss=eventIds[j]}}
html+="<span class='fc-event-title "+htmlEscape(lastSpanCss+" "+iconCss)+"'>"+htmlEscape(event.title)+"</span></div>"}else{html+="<span class='fc-event-title "+htmlEscape(event._id)+"'>"+htmlEscape(event.title)+"</span></div>"}if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-"+(rtl?'w':'e')+"'>&nbsp;&nbsp;&nbsp;</div>"}
html+="</"+(url?"a":"div")+">";seg.left=left;seg.outerWidth=right-left;seg.startCol=leftCol;seg.endCol=rightCol+1}
return html}
function daySegElementResolve(segs,elements){var i;var segCnt=segs.length;var seg;var event;var element;var triggerRes;for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;element=$(elements[i]);triggerRes=trigger('eventRender',event,event,element);if(triggerRes===false){element.remove()}else{if(triggerRes&&triggerRes!==true){triggerRes=$(triggerRes).css({position:'absolute',left:seg.left});element.replaceWith(triggerRes);element=triggerRes}
seg.element=element}}}
function daySegElementReport(segs){var i;var segCnt=segs.length;var seg;var element;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){reportEventElement(seg.event,element)}}}
function daySegHandlers(segs,segmentContainer,modifiedEventId){var i;var segCnt=segs.length;var seg;var element;var event;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){event=seg.event;if(event._id===modifiedEventId){bindDaySeg(event,element,seg)}else{element[0]._fci=i}}}
lazySegBind(segmentContainer,segs,bindDaySeg)}
function daySegCalcHSides(segs){var i;var segCnt=segs.length;var seg;var element;var key,val;var hsideCache={};for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){key=seg.key=cssKey(element[0]);val=hsideCache[key];if(val===undefined){val=hsideCache[key]=hsides(element,true)}
seg.hsides=val}}}
function daySegSetWidths(segs){var i;var segCnt=segs.length;var seg;var element;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){element[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+'px'}}}
function daySegCalcHeights(segs){var i;var segCnt=segs.length;var seg;var element;var key,val;var vmarginCache={};for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){key=seg.key;val=vmarginCache[key];if(val===undefined){val=vmarginCache[key]=vmargins(element)}
seg.outerHeight=element[0].offsetHeight+val}}}
function getRowDivs(){var i;var rowCnt=getRowCnt();var rowDivs=[];for(i=0;i<rowCnt;i++){rowDivs[i]=allDayRow(i).find('td:first div.fc-day-content > div')}
return rowDivs}
function getRowTops(rowDivs){var i;var rowCnt=rowDivs.length;var tops=[];for(i=0;i<rowCnt;i++){tops[i]=rowDivs[i][0].offsetTop}
return tops}
function daySegSetTops(segs,rowTops){var i;var segCnt=segs.length;var seg;var element;var event;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){element[0].style.top=rowTops[seg.row]+(seg.top||0)-15+'px';event=seg.event;trigger('eventAfterRender',event,event,element)}}}
function resizableDayEvent(event,element,seg){var rtl=opt('isRTL');var direction=rtl?'w':'e';var handle=element.find('div.ui-resizable-'+direction);var isResizing=false;disableTextSelection(element);element.mousedown(function(ev){ev.preventDefault()}).click(function(ev){if(isResizing){ev.preventDefault();ev.stopImmediatePropagation()}});handle.mousedown(function(ev){if(ev.which!=1){return}
isResizing=true;var hoverListener=t.getHoverListener();var rowCnt=getRowCnt();var colCnt=getColCnt();var dis=rtl?-1:1;var dit=rtl?colCnt-1:0;var elementTop=element.css('top');var dayDelta;var helpers;var eventCopy=$.extend({},event);var minCell=dateCell(event.start);clearSelection();$('body').css('cursor',direction+'-resize').one('mouseup',mouseup);trigger('eventResizeStart',this,event,ev);hoverListener.start(function(cell,origCell){if(cell){var r=Math.max(minCell.row,cell.row);var c=cell.col;if(rowCnt==1){r=0}
if(r==minCell.row){if(rtl){c=Math.min(minCell.col,c)}else{c=Math.max(minCell.col,c)}}
dayDelta=(r*7+c*dis+dit)-(origCell.row*7+origCell.col*dis+dit);var newEnd=addDays(eventEnd(event),dayDelta,true);if(dayDelta){eventCopy.end=newEnd;var oldHelpers=helpers;helpers=renderTempDaySegs(compileDaySegs([eventCopy]),seg.row,elementTop);helpers.find('*').css('cursor',direction+'-resize');if(oldHelpers){oldHelpers.remove()}
hideEvents(event)}else{if(helpers){showEvents(event);helpers.remove();helpers=null}}
clearOverlays();renderDayOverlay(event.start,addDays(cloneDate(newEnd),1))}},ev);function mouseup(ev){trigger('eventResizeStop',this,event,ev);$('body').css('cursor','');hoverListener.stop();clearOverlays();if(dayDelta){eventResize(this,event,dayDelta,0,ev)}
setTimeout(function(){isResizing=false},0)}})}}
function SelectionManager(){var t=this;t.select=select;t.unselect=unselect;t.reportSelection=reportSelection;t.daySelectionMousedown=daySelectionMousedown;var opt=t.opt;var trigger=t.trigger;var defaultSelectionEnd=t.defaultSelectionEnd;var renderSelection=t.renderSelection;var clearSelection=t.clearSelection;var selected=false;if(opt('selectable')&&opt('unselectAuto')){$(document).mousedown(function(ev){var ignore=opt('unselectCancel');if(ignore){if($(ev.target).parents(ignore).length){return}}
unselect(ev)})}
function select(startDate,endDate,allDay){unselect();if(!endDate){endDate=defaultSelectionEnd(startDate,allDay)}
renderSelection(startDate,endDate,allDay);reportSelection(startDate,endDate,allDay)}
function unselect(ev){if(selected){selected=false;clearSelection();trigger('unselect',null,ev)}}
function reportSelection(startDate,endDate,allDay,ev){selected=true;trigger('select',null,startDate,endDate,allDay,ev)}
function daySelectionMousedown(ev){var cellDate=t.cellDate;var cellIsAllDay=t.cellIsAllDay;var hoverListener=t.getHoverListener();var reportDayClick=t.reportDayClick;if(ev.which==1&&opt('selectable')){unselect(ev);var _mousedownElement=this;var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cellIsAllDay(cell)){dates=[cellDate(origCell),cellDate(cell)].sort(cmp);renderSelection(dates[0],dates[1],true)}else{dates=null}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],true,ev)}
reportSelection(dates[0],dates[1],true,ev)}})}}}
function OverlayManager(){var t=this;t.renderOverlay=renderOverlay;t.clearOverlays=clearOverlays;var usedOverlays=[];var unusedOverlays=[];function renderOverlay(rect,parent){var e=unusedOverlays.shift();if(!e){e=$("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>")}
if(e[0].parentNode!=parent[0]){e.appendTo(parent)}
usedOverlays.push(e.css(rect).show());return e}
function clearOverlays(){var e;while(e=usedOverlays.shift()){unusedOverlays.push(e.hide().unbind())}}}
function CoordinateGrid(buildFunc){var t=this;var rows;var cols;t.build=function(){rows=[];cols=[];buildFunc(rows,cols)};t.cell=function(x,y){var rowCnt=rows.length;var colCnt=cols.length;var i,r=-1,c=-1;for(i=0;i<rowCnt;i++){if(y>=rows[i][0]&&y<rows[i][1]){r=i;break}}
for(i=0;i<colCnt;i++){if(x>=cols[i][0]&&x<cols[i][1]){c=i;break}}
return(r>=0&&c>=0)?{row:r,col:c}:null};t.rect=function(row0,col0,row1,col1,originElement){var origin=originElement.offset();return{top:rows[row0][0]-origin.top,left:cols[col0][0]-origin.left,width:cols[col1][1]-cols[col0][0],height:rows[row1][1]-rows[row0][0]}}}
function HoverListener(coordinateGrid){var t=this;var bindType;var change;var firstCell;var cell;t.start=function(_change,ev,_bindType){change=_change;firstCell=cell=null;coordinateGrid.build();mouse(ev);bindType=_bindType||'mousemove';$(document).bind(bindType,mouse)};function mouse(ev){_fixUIEvent(ev);var newCell=coordinateGrid.cell(ev.pageX,ev.pageY);if(!newCell!=!cell||newCell&&(newCell.row!=cell.row||newCell.col!=cell.col)){if(newCell){if(!firstCell){firstCell=newCell}
change(newCell,firstCell,newCell.row-firstCell.row,newCell.col-firstCell.col)}else{change(newCell,firstCell)}
cell=newCell}}
t.stop=function(){$(document).unbind(bindType,mouse);return cell}}
function _fixUIEvent(event){if(event.pageX===undefined){event.pageX=event.originalEvent.pageX;event.pageY=event.originalEvent.pageY}}
function HorizontalPositionCache(getElement){var t=this,elements={},lefts={},rights={};function e(i){return elements[i]=elements[i]||getElement(i)}
t.left=function(i){return lefts[i]=lefts[i]===undefined?e(i).position().left:lefts[i]};t.right=function(i){return rights[i]=rights[i]===undefined?t.left(i)+e(i).width():rights[i]};t.clear=function(){elements={};lefts={};rights={}}}});;define('tour_amd/right_scroll_v7',['jquery'],function($){var exports={};var init;var tourPage={leftCat:function(){var lc=$("#leftcat").length,lcVal=$("#leftcat").val();if(lc){var catLoaded=false;$('.categorys').hover(function(){if(!catLoaded){catLoaded=true;$(".categorys").load('/header/'+lcVal+'');}});}},canlendarLoad:function(){if($("#hotel_page").length){return;}
var routeId=$("#route_id_tmp").val();var no_product_flag=$("#no_product").val();if(no_product_flag==1){routeId=1;}
$.ajax({datatype:"html",url:'/singleCalendar/routeId/'+routeId,success:function(data){$('#calendar').html(data);tabScroll();}});},noDate:function(){var no_date=$("#no_date").length;if(no_date){try{var arrPageSizes=___getPageSize();$('#noDate').css({top:parseInt($('#noDate').css("top"))-(arrPageSizes[3]/5)+(arrPageSizes[3]-parseInt($('#noDate').css("height")))/2-10});}catch(e){}}},__tourList:function(){var arry=new Array();for(var t=0;t<$(".tourList").children().length;t++){arry[t]=0;}
if($(".tourList").children().length>1){$(".tourList").find("li").each(function(i,n){var _this=$(n);_this.hover(function(){var _index=_this.index();var l_left=80*(_index)+30;$(".tourItem").eq(_index).find($(".mRec_con .arrow")).css("left",l_left);_this.addClass("xc_selected");var _src=_this.attr(("data-src"));showImg(_src,_index);changeCont(i);},function(){var temp=0;if(arry[i]==1){return false;}
for(var j=0;j<arry.length;j++){if(arry[j]==1){temp=j;}}
changeCont(temp);$(".tourList").find("li").siblings().removeClass("xc_selected").end().eq(temp).addClass("xc_selected");});});$(".tourList").find("li").each(function(i,n){var _ths=$(n);_ths.click(function(){_ths.siblings().removeClass("xc_selected").end().addClass("xc_selected");for(var j=0;j<arry.length;j++){if(i!=j){arry[j]=0;}else{arry[j]=1;$(".tourItem").eq(j).find($(".mRec_con .arrow")).css("left",80*j+30);}}});});function changeCont(tt){$(".tourSection_niuren_parent").children().siblings().hide().end().eq(tt).show();$('.more-dl-info').removeClass('tb-show');$('.deadline-table').hide();}}},__clearComparSelect:function(){if($(".comparison_btn").length){$(".del_btn").click(function(){$(".comparison_btn").removeClass("compar_select");});}},__commScroll:function(){if($(".right_scroll").length==0){var rightHtml='<div class="right_scroll"></div>';var winWidth=$(window).width(),comparison=parseInt((winWidth-1000),10)/2,winh=$(window).height();$(document.body).append(rightHtml);$(".right_scroll").css({top:258});}},__scrollPosition:function(obj){var st=$(window).scrollTop(),winh=$(window).height();if(!window.XMLHttpRequest){obj.css({"top":st+winh-winh/2,"background-attachment":"fixed","background-image":"url(about:blank)"});}},__onLineService:function(groupid){var st=$(window).scrollTop(),localTime=new Date().getHours().toLocaleString();var numTime=parseInt(localTime,10);var onLine=$('<li><a class="add_order" id="esq_live800" value="0"></a></li>'),offLine=$('<li><a class="add_order add_order_hide"></a></li>');var $backToTopEle;if(numTime>=7&&numTime<=21){addAttr(onLine,$backToTopEle);$backToTopEle=onLine;$(function(){$backToTopEle.show();});}else{return false;}
function addAttr(obj,fnshow){var treeObj=obj,fnobj=fnshow;var $backToTopTxt='在线客服';fnobj=treeObj.appendTo($(".right_scroll")).attr({title:$backToTopTxt});treeObj.find("a").attr({href:'javascript:Live800('+groupid+',560,480);'});}},__addBtnRight:function(){var st=$(window).scrollTop();var comparison_btn=$('<li data="加入对比"><a class="comparison_btn" onclick="com_pro_click();""></a></li>');addAttr(comparison_btn,comparison_btn);function addAttr(obj,fnshow){fnshow=obj.appendTo($(".right_scroll"));};$(function(){comparison_btn.show();$(".comparison_btn").click(function(){_gaq.push(['_trackEvent','[产品页]','[浮动层点击]','[加入对比]']);if($(".compared_prod").hasClass("hide")){$(".comparison_btn").removeClass("compar_select");}else{$(".comparison_btn").addClass("compar_select");}});});},__addStow:function(){var uId=$("#userId").val(),routeId=$("#route_id").val();var addStow=$('<li data="加入收藏"><a class="add_scroll"></a></li>');addAttr(addStow);function addAttr(obj,fnshow){fnshow=obj.appendTo($(".right_scroll"));}
addStow.click(function(){_gaq.push(['_trackEvent','[产品页]','[浮动层点击]','[加入收藏]']);var addbtn=$("#favorite_id");if(addbtn.hasClass("on")){addStow.addClass("addbtn");}
$(window).scrollTop(100,0);clickAddScroll();});},__backTop:function(){var backTop=$('<li data="返回顶部"><a class="backToTop"></a></li>');addAttr(backTop);function addAttr(obj,fnshow){fnshow=obj.appendTo($(".right_scroll"));}
backTop.click(function(){$(window).scrollTop(0,0);});},__addWeChat:function(s){var weChat=$('<li class="fashion_icon" data="扫码支付" id="Saoma"><a class="add_weChat"></a><div class="pop_weChart" id="weChat_pop"></div></li>');addAttr(weChat);function addAttr(obj,fnshow){if($(".right_scroll").find(".add_order").length>0){fnshow=obj.insertAfter($(".right_scroll li").eq(0));}else{fnshow=obj.insertBefore($(".right_scroll li").eq(0));}}
if(!$("#weChat_pop").find("img").length){$("#weChat_pop").append('<img src='+s+' alt="" /><p class="">微信扫码预订<br />点评多返5元</p>');}
tourPage.__showRightScrollPop();},__addOrderPhone:function(){if($("#Saoma").length>0){return false;}
var tuniuNum=$(".tuniu_400_num").html();var orderPhone=$('<li class="fashion_icon" data="电话预订"><a class="add_phone"></a><span class="pop_phone_p"><img class="pop_phone" src="http://img1.tuniucdn.com/img/20140423/common/pop_phone.png"/><span class="pop_phone_num">'+tuniuNum+'</span></span></li>');addAttr(orderPhone);function addAttr(obj,fnshow){if($(".right_scroll").find(".add_order").length>0){fnshow=obj.insertAfter($(".right_scroll li").eq(0));}else{fnshow=obj.insertBefore($(".right_scroll li").eq(0));}}
tourPage.__showRightScrollPop();},__clearComparSelect:function(){if($(".comparison_btn").length){$(".del_btn").click(function(){$(".comparison_btn").removeClass("compar_select");});}},__showRightScrollPop:function(){var fashion_icon=$(".right_scroll .fashion_icon");if(fashion_icon.length>0){fashion_icon.each(function(i,n){$(n).hover(function(){if($(n).find(".pop_phone_p").length>0){$(n).find(".pop_phone_p").find(".pop_phone").show();$(n).find(".pop_phone_p").find(".pop_phone_num").show();}
if($(n).find(".pop_weChart").length>0){$(n).find(".pop_weChart").show();}},function(){$(n).find(".pop_phone_p").find(".pop_phone").hide();$(n).find(".pop_phone_p").find(".pop_phone_num").hide();$(n).find(".pop_weChart").hide();});});}},__addErWeiMa:function(s,t){var wifiYouhui=$("#wifiYouhui");if(s){wifiYouhui.find("#wifiHasErWei").show().find("img").attr("src",t);}else{wifiYouhui.hide();}}}
var rightScrollChange={adjustScreen:function(){var time="";$(window).resize(function(){clearTimeout(time);time=setTimeout("rightScrollChange.rePosRightScroll()",200);});},rePosRightScroll:function(){var right_scroll=$(".right_scroll");if(right_scroll.length>0){var winWidth=$(window).width();if(winWidth>1100){$(".right_scroll").show();var comparison=parseInt((winWidth-1000),10)/2;var winh=$(window).height();$(".right_scroll").css({bottom:winh/2-80});}else{$(".right_scroll").hide();}};}}
var getAppData={getCookie:function(c_name){if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+"=")
if(c_start!=-1){c_start=c_start+c_name.length+1
c_end=document.cookie.indexOf(";",c_start)
if(c_end==-1)c_end=document.cookie.length
return unescape(document.cookie.substring(c_start,c_end))}}
return""},getRouteId:function(){var routeId_ProdType=[];var route_id=$("#route_id").val();var city_code=$("#city_code").val();var prodType="";if(route_id&&route_id!=""){routeId_ProdType[0]=route_id;}
if(city_code&&city_code!=""){routeId_ProdType[1]=city_code;}
if(prodType!=""){routeId_ProdType[2]=0;}
return routeId_ProdType;},insertInPage:function(data){var insertWhere=$("");insertWhere.html(data);},getTuniuApp:function(){var routeIdProdType=getAppData.getRouteId();var tn_url="http://dynamic.m.tuniu.com/webBanner/getBannerForProduct";var tn_data={"productId":routeIdProdType[0],"cityCode":routeIdProdType[1],"p":getAppData.getCookie("tuniu_partner"),"productType":routeIdProdType[2]}
var data={"success":false,"qRCodeUrl":""}
var isShowPhone=$("#phow_show");if(!isShowPhone.length){return false;}
var isShowPhoneVal=isShowPhone.val();if(isShowPhoneVal==1){tourPage.__addOrderPhone();}}};init=function(){tourPage.canlendarLoad();tourPage.noDate();tourPage.__tourList();};exports.init=init;return exports;});;define('tour_amd/tour_page_v3',['jquery','common_amd/thickbox3.1'],function($,thickbox_mod){var exports={};var tb_show=thickbox_mod.tb_show;function change_city(letter,domain){window.location.href='http://'+letter+'.tuniu.com/'+domain;}
function submitOrder(submitPlace){var begin_date=$('#plan_date').val();if(begin_date==""){alert("请选择日期！");return false;}
var tagType=$('#tagType').val();if(tagType==11){if(submitPlace=='calendar'){var adultNum=parseInt($("#select_adult_num .s_acon").html(),10),childNum=parseInt($("#select_child_num .s_ccon").html(),10);if(adultNum+childNum<1){alert("请选择出游人数!");return false;}}else if(submitPlace=='main'){if(parseInt($('#adultN').val(),10)+parseInt($('#childN').val(),10)<1){alert("请选择出游人数!");return false;}}}
$('#form_order').submit();}
function comment(){var host=document.domain;window.location.href="http://"+host+'/u/order';}
function powerFloatAsync(){var a,b,c;try{b=parseInt($("#beginCityCode").val());a=$("#isAbroad").val();switch(b){case 200:c="/bank/pay_account_bj.html";break;case 2500:if(a=="0"){c="/bank/pay_account_sh_gn.html"}else{c="/bank/pay_account_sh.html"}
break;case 1602:c="/bank/pay_account_nj.html";break;case 3402:c="/bank/pay_account_hz.html";break;case 1615:c="/bank/pay_account_sz.html";break;case 3000:c="/bank/pay_account_tj.html";break;case 619:c="/bank/pay_account_shz.html";break;case 2802:c="/bank/pay_account_cd.html";break;case 1402:c="/bank/pay_account_wh.html";break;case 1902:c="/bank/pay_account_sy.html";break;case 300:c="/bank/pay_account_cq.html";break;case 3415:c="/bank/pay_account_nb.html";break;case 2702:c="/bank/pay_account_xa.html";break;case 1502:c="/bank/pay_account_cs.html";break;case 3426:c="/bank/pay_account_wz.html";break;case 1619:c="/bank/pay_account_wx.html";break;case 1604:c="/bank/pay_account_cz.html";break;case 1906:c="/bank/pay_account_dl.html";break;case 414:c="/bank/pay_account_xm.html";break;case 2413:c="/bank/pay_account_qd.html";break;case 2402:c="/bank/pay_account_jn.html";break;case 1102:c="/bank/pay_account_heb.html";break;case 1502:c="/bank/pay_account_cs.html";break;case 1202:c="/bank/pay_account_zz.html";break;default:c="/bank/pay_account_err.html";break}}catch(d){c="/bank/pay_account_err.html"}
$(".remit_account").powerFloat({target:c,targetMode:"ajax"});}
function updateMethod(){$('.update_project').each(function(i,n){$(this).hover(function(){$('.update_con').eq(i).toggle(0,function(){$('.update_project').eq(i).toggleClass('update_project_hover');return false;});});});}
function dotb_id(){var id=document.getElementById("route_id").value;return parseInt(id);}
function dotb(title,url){if($('#plan_date').val()==""){alert("请选择日期！");return false;}else{var rep_check=$("#rep_check").val();if(rep_check==1){tb_show(title,url,null);}else{submitOrder();}}}
function stilldosu(route_id){$("#rep_check").val(2);tb_remove();submitOrder();}
function resetInput(){var defaultCity=$(".sel_start_city").find(".s_con").attr("data");$("#dep_city").val(defaultCity);if(!$("#plan_date").attr('force')){$("#plan_date").val("");}
if(!$("#begindate_page").attr('force')){$("#begindate_page").val("");}
$("#user_num_page").val(1);$("#children_count_page").val(0);}
function syncFormData(){$(".order_box .order_btn").mouseover(function(){var date=$(".order_box .s_con").text();$("#begindate_page").val(date);$("#plan_date").val(date);var user_num=$(".order_box .s_acon").text();var children_count=$(".order_box .s_ccon").text();$("#user_num_page").val(user_num);$("#children_count_page").val(children_count);});$("#order_mess .order_btn").mouseover(function(){var date=$("#selectDepartDate .select_result").attr("date");$("#begindate_page").val(date);$("#plan_date").val(date);var user_num=$("#order_mess #adultN").val();var children_count=$("#order_mess #childN").val();$("#user_num_page").val(user_num);$("#children_count_page").val(children_count);});}
var init=function(){resetInput();syncFormData();$("#toursPowerFloatAsync").one('mousemove',powerFloatAsync);};exports.init=init;window.comment=comment;window.submitOrder=submitOrder;return exports;});