define('tour_amd/tour_visa',['jquery','layer'],function($,layer){var visa={init:function(){var self=this;this.changeSpaceWidth();$('#qzcl .in-table:nth-child(1)').each(function(index,item){self.changeHeight($(item));});$('#qzcl .tab a').on('click',function(){self.changeContent($(this));});$('#qzcl .doc .img').on('click',function(){self.showImgView();});$('.more-dl-info').on('click',function(){var $this=$(this),el=$this.parent().siblings('.deadline-table');if($this.hasClass('tb-show')){el.slideUp();}else{el.slideDown();}
$this.toggleClass('tb-show');});$(window).resize(function(){self.changeSpaceWidth();})},changeHeight:function(obj){obj.parent().removeClass('over_scroll');var height=obj.height();if(height<474){obj.parent().height(height);}else{obj.parent().height(474);}
obj.parent().addClass('over_scroll');},changeContent:function(obj){obj.addClass('active');obj.parent('li').siblings().children('a').removeClass('active');var index=obj.parent('li').index();obj.parents('.list').find('.in-table').hide();var nextTable=obj.parents('.list').find('.in-table').eq(index);nextTable.show();this.changeHeight(nextTable);},changeSpaceWidth:function(){$('#qzcl').find('.list').each(function(index,item){var sumWidth=0;var obj=$(item).find('.tab .space');var _width=obj.parent().width();obj.siblings('li').each(function(c_index,c_item){sumWidth+=$(c_item).width()});obj.width(_width-sumWidth);})},showImgView:function(e){var loader=layer.msg('Мгдижа...',2,-1);var obj=$(e.currentTarget);var _src=obj.data('src'),_width,_height;var img=$('<img/>');img.load(function(){layer.close(loader);var imgWidth=img[0].width;var imgHeight=img[0].height;var imgRatio=imgWidth/imgHeight;var windowWidth=$(window).width();var windowHeight=$(window).height();var windowRatio=windowWidth/windowHeight;if(imgRatio<windowRatio){_height=windowHeight*0.6;_width=_height*imgRatio;}else{_width=windowWidth*0.6;_height=_width/imgRatio;}
img.width(_width);var _html=$('<div></div>').append(img).html();$.layer({type:1,title:false,closeBtn:[1,true],area:[_width,_height],page:{html:_html}})}).attr('src',_src);}};visa.init();return visa;});